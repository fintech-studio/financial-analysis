(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[725],{1192:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return a(7911)}])},7911:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>j});var s=a(7876),l=a(4232),r=a(2120),n=a(4395);let i={messageEnter:{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.3,ease:"easeOut"}},avatarScale:{initial:{scale:0},animate:{scale:1},transition:{delay:.1,type:"spring",stiffness:300}},buttonHover:{scale:1.05,transition:{duration:.1}},buttonTap:{scale:.95,transition:{duration:.1}}},o=l.memo(()=>(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})}));o.displayName="AttachIcon",l.memo(()=>(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})).displayName="ImageIcon";let c=l.memo(()=>(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}));c.displayName="FileIcon";let d=l.memo(()=>(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}));d.displayName="RemoveIcon",l.memo(()=>(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})).displayName="RefreshIcon";let m=l.memo(()=>(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}));m.displayName="SendIcon";let h=l.memo(()=>(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}));h.displayName="CopyIcon";let x=l.memo(()=>(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}));x.displayName="CheckIcon",l.memo(()=>(0,s.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})).displayName="SettingsIcon",l.memo(()=>(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})).displayName="ClearIcon";let u=l.memo(()=>(0,s.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}));u.displayName="BotIcon";let p=l.memo(()=>(0,s.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}));p.displayName="UserIcon";let g={Send:m,Copy:h,Check:x,Bot:u,User:p,Attach:o,File:c,Remove:d},b=l.memo(e=>{let{msg:t,index:a,onCopy:r,copiedIndex:o}=e,c="user"===t.role,d=(0,l.useCallback)(()=>r(a),[r,a]);return(0,s.jsxs)(n.P.div,{initial:i.messageEnter.initial,animate:i.messageEnter.animate,transition:i.messageEnter.transition,className:"flex gap-3 mb-6 items-end ".concat(c?"justify-end":"justify-start"),children:[!c&&(0,s.jsx)(n.P.div,{initial:i.avatarScale.initial,animate:i.avatarScale.animate,transition:i.avatarScale.transition,className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 text-white flex items-center justify-center shadow-lg",children:(0,s.jsx)(g.Bot,{})}),(0,s.jsxs)("div",{className:"max-w-[75%] flex flex-col ".concat(c?"items-end":"items-start"),children:[t.files&&t.files.length>0&&(0,s.jsx)("div",{className:"mb-2 ".concat(c?"mr-0":"ml-0"),children:t.files.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 mb-1",children:[(0,s.jsx)(g.File,{}),(0,s.jsx)("span",{className:"text-sm text-gray-700",children:e.name})]},t))}),t.images&&t.images.length>0&&(0,s.jsx)("div",{className:"mb-2 ".concat(c?"mr-0":"ml-0"),children:(0,s.jsx)("div",{className:"grid grid-cols-1 gap-2 max-w-xs",children:t.images.map((e,t)=>(0,s.jsx)("img",{src:"data:image/jpeg;base64,".concat(e),alt:"附件圖片 ".concat(t+1),className:"rounded-lg border border-gray-200 max-w-full h-auto",style:{maxHeight:"200px"}},t))})}),(0,s.jsx)(n.P.div,{initial:{opacity:0,x:c?20:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.1},className:"px-5 py-3 rounded-2xl text-sm whitespace-pre-wrap break-words leading-relaxed transition-all duration-200 shadow-md hover:shadow-lg ".concat(c?"bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-br-md":"bg-white text-gray-800 border border-gray-100 rounded-bl-md"),children:t.content}),(0,s.jsxs)(n.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"flex gap-3 items-center mt-2 px-1",children:[(0,s.jsx)("div",{className:"text-xs text-gray-400",children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,s.jsxs)(n.P.button,{whileHover:i.buttonHover,whileTap:i.buttonTap,"aria-label":"複製第 ".concat(a+1," 則訊息"),onClick:d,className:"flex items-center gap-1 text-xs text-gray-400 hover:text-gray-600 px-2 py-1 rounded-lg hover:bg-gray-100 transition-colors",children:[o===a?(0,s.jsx)(g.Check,{}):(0,s.jsx)(g.Copy,{}),(0,s.jsx)("span",{children:o===a?"已複製":"複製"})]})]})]}),c&&(0,s.jsx)(n.P.div,{initial:i.avatarScale.initial,animate:i.avatarScale.animate,transition:i.avatarScale.transition,className:"w-10 h-10 rounded-full bg-gradient-to-br from-green-500 to-blue-600 text-white flex items-center justify-center shadow-lg",children:(0,s.jsx)(g.User,{})})]},t.id)}),y=e=>{let{attachedFiles:t,attachedImages:a,removeAttachedFile:l,removeAttachedImage:r}=e;return 0===t.length&&0===a.length?null:(0,s.jsxs)(n.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mb-4 p-4 bg-gray-50 border border-gray-200 rounded-xl",children:[(0,s.jsx)("div",{className:"text-sm text-gray-600 mb-3 font-medium",children:"附加的檔案:"}),a.length>0&&(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:a.map((e,t)=>(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:"data:image/jpeg;base64,".concat(e),alt:"預覽 ".concat(t+1),className:"w-20 h-20 object-cover rounded-lg border border-gray-300"}),(0,s.jsx)("button",{onClick:()=>r(t),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors",children:(0,s.jsx)(g.Remove,{})})]},t))})}),t.length>0&&(0,s.jsx)("div",{className:"space-y-2",children:t.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between bg-white border border-gray-200 rounded-lg px-3 py-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(g.File,{}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-800",children:e.name}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.type})]})]}),(0,s.jsx)("button",{onClick:()=>l(t),className:"text-red-500 hover:text-red-700 p-1 rounded hover:bg-red-50 transition-colors",children:(0,s.jsx)(g.Remove,{})})]},t))})]})},f=e=>{let{input:t,setInput:a,textareaRef:l,fileInputRef:i,handleFileUpload:o,handleKeyDown:c,canSend:d,sendMessage:m,stopStreaming:h,loading:x,selectedModel:u,setSelectedModel:p,isSettingsOpen:b,setIsSettingsOpen:y,availableModels:f}=e;return(0,s.jsx)("div",{className:"flex gap-6",children:(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("input",{ref:i,type:"file",multiple:!0,accept:"image/*,text/*,.pdf,.doc,.docx,.json,.js,.ts,.jsx,.tsx,.py,.java,.cpp,.c,.h,.css,.html,.xml,.md,.csv,.xlsx,.xls",onChange:o,className:"hidden"}),(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)("div",{className:"flex items-center gap-3 bg-white border border-gray-200 rounded-2xl px-3 py-2 shadow-sm",children:[(0,s.jsx)(n.P.button,{type:"button",title:"添加附件",whileHover:{scale:x?1:1.05},whileTap:{scale:x?1:.95},onClick:()=>{var e;return null==(e=i.current)?void 0:e.click()},disabled:x,"aria-label":"添加附件",className:"flex items-center justify-center w-10 h-10 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:(0,s.jsx)(g.Attach,{})}),(0,s.jsx)("textarea",{ref:l,value:t,onChange:e=>a(e.target.value),onKeyDown:c,placeholder:"輸入您的訊息... (Shift+Enter 換行，Enter 送出)",rows:1,className:"flex-1 bg-transparent resize-none outline-none px-2 py-2 text-base hide-scrollbar",disabled:x,style:{minHeight:"56px",maxHeight:"200px"}}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)(n.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>y(e=>!e),className:"flex items-center gap-2 px-3 py-1 rounded-lg hover:bg-gray-100 transition-colors",type:"button",title:"切換模型",children:[(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"當前模型："}),(0,s.jsx)("span",{className:"font-medium text-blue-600 text-sm",children:u}),(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-500 transition-transform ".concat(b?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),(0,s.jsx)(r.N,{children:b&&(0,s.jsx)(n.P.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"absolute bottom-full right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 p-2 min-w-[200px] z-50",children:(0,s.jsx)("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:f.map(e=>(0,s.jsx)("button",{onClick:()=>{p(e),y(!1)},className:"w-full text-left px-3 py-2 rounded text-sm transition-colors ".concat(u===e?"bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100"),type:"button",children:e},e))})})})]})}),(0,s.jsx)(n.P.button,{type:"button",title:"停止回覆",whileHover:{scale:x?1.02:1},whileTap:{scale:x?.98:1},onClick:()=>h(),disabled:!x,"aria-label":"停止回覆",className:"flex items-center justify-center w-10 h-10 rounded-md text-white transition-all duration-200 mr-1 ".concat(x?"bg-red-500 hover:shadow-md":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:(0,s.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("rect",{x:"6",y:"6",width:"12",height:"12",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,s.jsx)(n.P.button,{type:"button",title:"傳送訊息",whileHover:{scale:d?1.05:1},whileTap:{scale:d?.95:1},onClick:()=>m(),disabled:!d,"aria-label":"傳送訊息",className:"flex items-center justify-center w-10 h-10 rounded-md text-white transition-all duration-200 ".concat(d?"bg-gradient-to-r from-blue-600 to-purple-600 hover:shadow-xl":"bg-gray-200 text-gray-500 cursor-not-allowed"),children:x?(0,s.jsx)("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}):(0,s.jsx)(g.Send,{})})]})})]})})};async function v(e){let{input:t,attachedFiles:a,attachedImages:s,messages:l,selectedModel:r,generateId:n,setMessages:i,setInput:o,setAttachedFiles:c,setAttachedImages:d,setLoading:m,setBannerError:h,replaceLastAssistantContent:x,abortControllerRef:u}=e;if(!t.trim()&&0===a.length&&0===s.length)return;h(null);let p=Date.now(),g={role:"user",content:t,timestamp:p,id:n(),images:s.length>0?s:void 0,files:a.length>0?a:void 0},b={role:"assistant",content:"",timestamp:p,id:n()};i(e=>[...e,g,b]),o(""),c([]),d([]),m(!0);let y=0,f=!1,v="";for(;y<=3&&!f;)try{let e=[...l,g].map(e=>{let t={role:e.role,content:e.content};if(e.images&&e.images.length>0&&(t.images=e.images),e.files&&e.files.length>0){let a=e.files.map(e=>{if(!(e.type.includes("text")||e.type.includes("json")||e.type.includes("javascript")||e.type.includes("typescript")||e.name.endsWith(".csv")||e.name.endsWith(".md")||e.name.endsWith(".txt")||e.type.includes("csv")))return"檔案：".concat(e.name," (").concat(e.type,")");try{let t=atob(e.content);return"檔案：".concat(e.name,"\n內容：\n").concat(t)}catch(t){return"檔案：".concat(e.name," (無法解析內容)")}}).join("\n\n");t.content=t.content?"".concat(t.content,"\n\n附加檔案：\n").concat(a):"附加檔案：\n".concat(a)}return t}),t=r||"gpt-oss",a=new AbortController;u.current=a;let s=await fetch("/api/ollama-proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:t,messages:e}),signal:a.signal});if(!s.body)throw Error("API 無回應 body");let n=s.body.getReader(),i=new TextDecoder,o="",c=!1,d="";for(;!c;){let{value:e,done:t}=await n.read();if(c=t,e){let t=(o+=i.decode(e,{stream:!0})).split("\n");for(let e of(o=t.pop()||"",t))try{var j,w,N,k,C;let t=JSON.parse(e),a=null!=(C=null==(j=t.message)?void 0:j.content)?C:null==(k=t.choices)||null==(N=k[0])||null==(w=N.message)?void 0:w.content;"string"==typeof a&&(d+=a,x(d))}catch(e){}}}v=d||"（無回應）",f=!0,u.current=null}catch(t){if((null==t?void 0:t.name)==="AbortError"){h("已停止"),x("（已停止）");break}if((y+=1)>3){let e=t instanceof Error?t.message||"發生錯誤":"未知錯誤";h("請求失敗：".concat(e," (嘗試 ").concat(y," 次)")),x("（回應失敗） ".concat(e));break}let e=500*Math.pow(2,y);await new Promise(t=>setTimeout(t,e))}f&&x(v),u.current=null,m(!1)}let j=()=>{let[e,t]=(0,l.useState)([]),[a,i]=(0,l.useState)(""),[o,c]=(0,l.useState)(!1),[d,m]=(0,l.useState)(null),[h,x]=(0,l.useState)(null),[u,p]=(0,l.useState)(null),[j,w]=(0,l.useState)(!0),[N,k]=(0,l.useState)("gpt-oss"),[C,L]=(0,l.useState)(!1),[S]=(0,l.useState)(["gpt-oss","gemma3:12b","deepseek-r1:8b","deepseek-r1:14b","llama3.2-vision:latest","llava:latest"]),[E,M]=(0,l.useState)([]),[I,P]=(0,l.useState)([]),H=(0,l.useRef)(null),T=(0,l.useRef)(null),B=(0,l.useRef)(null),W=(0,l.useRef)(null),R=(0,l.useRef)(null),z=(0,l.useCallback)(()=>Math.random().toString(36).slice(2,11),[]),A=(0,l.useCallback)(e=>e.map(e=>e.role).lastIndexOf("assistant"),[]),_=(0,l.useCallback)(e=>{t(t=>{let a=t.slice(),s=A(a);return s>=0&&(a[s]={...a[s],content:e}),a})},[A]);(0,l.useEffect)(()=>{var e;j&&(null==(e=H.current)||e.scrollIntoView({behavior:"smooth"}))},[e,j]),(0,l.useEffect)(()=>{var e;null==(e=T.current)||e.focus()},[]),(0,l.useEffect)(()=>{let e="hide-scrollbar-global-style";if("undefined"!=typeof document&&!document.getElementById(e)){let t=document.createElement("style");t.id=e,t.innerHTML="\n      .hide-scrollbar {\n        -ms-overflow-style: none; /* IE and Edge */\n        scrollbar-width: none; /* Firefox */\n      }\n      .hide-scrollbar::-webkit-scrollbar {\n        display: none; /* WebKit */\n      }\n    ",document.head.appendChild(t)}},[]);let F=(0,l.useCallback)(e=>{M(t=>t.filter((t,a)=>a!==e))},[]),O=(0,l.useCallback)(e=>{P(t=>t.filter((t,a)=>a!==e))},[]);(0,l.useEffect)(()=>{let e=T.current;if(!e)return;e.style.height="auto";let t=Math.min(200,e.scrollHeight);e.style.height="".concat(t,"px")},[a]),(0,l.useEffect)(()=>{if(!h)return;let e=setTimeout(()=>x(null),1600);return()=>clearTimeout(e)},[h]);let D=(0,l.useMemo)(()=>e.filter(e=>""!==e.content.trim()),[e]),V=(0,l.useCallback)(e=>{let t=e.target.files;t&&(Array.from(t).forEach(e=>{let t=new FileReader;t.onload=t=>{var a;let s=(null==(a=t.target)?void 0:a.result).split(",")[1];e.type.startsWith("image/")?P(e=>[...e,s]):M(t=>[...t,{name:e.name,type:e.type,content:s}])},t.readAsDataURL(e)}),e.target&&(e.target.value=""))},[]),U=(0,l.useCallback)(async()=>{await v({input:a,attachedFiles:E,attachedImages:I,messages:e,selectedModel:N,generateId:z,setMessages:t,setInput:i,setAttachedFiles:M,setAttachedImages:P,setLoading:c,setBannerError:m,replaceLastAssistantContent:_,abortControllerRef:R})},[a,E,I,e,N,z,t,i,M,P,c,m,_]),K=(0,l.useCallback)(()=>{R.current&&(R.current.abort(),R.current=null),c(!1)},[]),J=(0,l.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),U())},[U]);(0,l.useEffect)(()=>{let e=B.current;if(!e)return;let t=()=>{w(e.scrollHeight-e.scrollTop-e.clientHeight<80)};return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)},[]);let X=(0,l.useCallback)(async t=>{try{await navigator.clipboard.writeText(e[t].content),p(t),x("已複製到剪貼簿"),setTimeout(()=>p(null),1200)}catch(e){x("複製失敗")}},[e]),q=(0,l.useMemo)(()=>!o&&(a.trim().length>0||E.length>0||I.length>0),[o,a,E,I]);return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center p-4",children:[(0,s.jsx)("div",{className:"w-full max-w-7xl h-[90vh] bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-200 mt-20",children:(0,s.jsx)("div",{className:"flex h-full",children:(0,s.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 bg-gradient-to-b from-gray-50/50 to-white",ref:B,children:[(0,s.jsxs)(r.N,{children:[0===e.length&&(0,s.jsxs)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex flex-col items-center justify-center h-full text-center",children:[(0,s.jsx)("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center mb-6 shadow-lg text-white",children:(0,s.jsx)(g.Bot,{})}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-3",children:"開始與 AI 對話"}),(0,s.jsx)("p",{className:"text-gray-600 max-w-md leading-relaxed",children:"輸入任何問題或想法，AI 助手將會即時為您提供幫助和回答"}),(0,s.jsx)("div",{className:"mt-8 grid grid-cols-1 sm:grid-cols-2 gap-3 w-full max-w-md",children:["解釋一個複雜的概念","請幫我分析數據","創意寫作協助","程式碼問題解答"].map((e,t)=>(0,s.jsx)(n.P.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t+.3},whileHover:{scale:1.02,backgroundColor:"rgb(239 246 255)"},onClick:()=>i(e),className:"p-3 text-sm text-gray-600 bg-white border border-gray-200 rounded-xl hover:border-blue-300 transition-all duration-200 shadow-sm",children:e},t))})]}),D.map((e,t)=>(0,s.jsx)(b,{msg:e,index:t,onCopy:X,copiedIndex:u},e.id)),o&&(0,s.jsx)(n.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"flex justify-start mb-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-4 bg-white border border-gray-200 rounded-2xl rounded-bl-md px-5 py-3 shadow-md",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white",children:(0,s.jsx)(g.Bot,{})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"flex space-x-1",children:[0,1,2].map(e=>(0,s.jsx)(n.P.div,{animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{duration:1,repeat:1/0,delay:.2*e},className:"w-2 h-2 bg-blue-500 rounded-full"},e))}),(0,s.jsx)("span",{className:"text-sm text-gray-600 ml-2",children:"正在思考中..."})]})]})})]}),(0,s.jsx)("div",{ref:H})]}),(0,s.jsxs)("div",{className:"border-t border-gray-200 bg-white p-6",children:[d&&(0,s.jsx)(n.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-4 bg-red-50 border border-red-200 text-red-700 p-4 rounded-xl",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-sm",children:d}),(0,s.jsx)(n.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{let t=e.slice().reverse().find(e=>"user"===e.role);if(t){var a;i(t.content),m(null),null==(a=T.current)||a.focus()}},className:"text-sm px-3 py-1 bg-red-100 hover:bg-red-200 border border-red-300 rounded-lg transition-colors",children:"重試"})]})}),(0,s.jsx)(y,{attachedFiles:E,attachedImages:I,removeAttachedFile:F,removeAttachedImage:O}),(0,s.jsx)(f,{input:a,setInput:i,textareaRef:T,fileInputRef:W,handleFileUpload:V,handleKeyDown:J,canSend:q,sendMessage:U,stopStreaming:K,loading:o,selectedModel:N,setSelectedModel:k,isSettingsOpen:C,setIsSettingsOpen:L,availableModels:S})]})]})})}),(0,s.jsx)(r.N,{children:h&&(0,s.jsx)(n.P.div,{initial:{opacity:0,y:50,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:50,scale:.9},className:"fixed bottom-6 right-6 bg-gray-900 text-white px-4 py-3 rounded-xl shadow-lg z-50",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(g.Check,{}),(0,s.jsx)("span",{children:h})]})})})]})})}}},e=>{e.O(0,[636,593,792],()=>e(e.s=1192)),_N_E=e.O()}]);