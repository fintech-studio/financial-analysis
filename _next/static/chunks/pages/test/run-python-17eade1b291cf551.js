(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{228:(e,l,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/test/run-python",function(){return t(2135)}])},2135:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>o});var s=t(7876),a=t(4232);let r=e=>{let{loading:l,setSymbol:t,setSymbolDirect:a}=e,r=[{param:"--tw",label:"台股"},{param:"--us",label:"美股"},{param:"--etf",label:"ETF"},{param:"--index",label:"指數"},{param:"--forex",label:"外匯"},{param:"--crypto",label:"加密貨幣"},{param:"--futures",label:"期貨"}];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:r.map(e=>{let{param:a,label:n}=e;return(0,s.jsxs)("button",{type:"button",className:"px-3 py-1.5 rounded-lg bg-green-100 text-green-700 font-medium border border-green-300 hover:bg-green-200 transition text-xs shadow-sm focus:outline-none focus:ring-2 focus:ring-green-200",onClick:()=>{t(e=>{let l=r.map(e=>e.param),t=e.split(/\s+/).filter(e=>!l.includes(e)&&""!==e).join(" ");return t?t+" "+a:a})},disabled:l,children:[a," ",(0,s.jsxs)("span",{className:"text-[10px] text-green-400 ml-1",children:["(",n,")"]})]},a)})}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:[{param:"--help",label:"顯示說明"},{param:"--indicators-only",label:"重新計算技術指標"},{param:"--expand-history",label:"獲取歷史資料"},{param:"--pattern",label:"重新辨識 K 線型態-歷史"},{param:"--show-all-stats",label:"顯示統計資訊"}].map(e=>{let{param:t,label:r}=e;return(0,s.jsxs)("button",{type:"button",className:"px-3 py-1.5 rounded-lg bg-blue-100 text-blue-700 font-medium border border-blue-300 hover:bg-blue-200 transition text-xs shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-200",onClick:()=>a(t),disabled:l,children:[t," ",(0,s.jsxs)("span",{className:"text-[10px] text-blue-400 ml-1",children:["(",r,")"]})]},t)})})]})},n=a.forwardRef((e,l)=>{let{logs:t,error:a,loading:r,onCopy:n}=e;return(0,s.jsxs)("div",{ref:l,className:"bg-slate-900 rounded-2xl p-5 min-h-[320px] max-h-[600px] h-[600px] overflow-y-auto text-green-200 font-mono text-base whitespace-pre-wrap shadow-lg border-2 border-slate-700 outline-none relative scrollbar-hide",tabIndex:-1,style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[(0,s.jsx)("style",{children:".scrollbar-hide::-webkit-scrollbar { display: none; }"}),(0,s.jsx)("button",{className:"absolute right-4 top-4 px-2 py-1 text-xs bg-slate-800 text-slate-200 rounded hover:bg-slate-700 border border-slate-600 z-10",onClick:n,style:{opacity:t.length>0?1:.5},disabled:0===t.length,children:"複製全部"}),0===t.length&&!a&&!r&&(0,s.jsx)("span",{className:"text-slate-500",children:"輸出結果將顯示於此處..."}),t.map((e,l)=>(0,s.jsx)("div",{className:"break-all",children:e},l)),r&&(0,s.jsx)("div",{className:"absolute left-0 right-0 bottom-2 flex justify-center animate-pulse",children:(0,s.jsx)("span",{className:"text-blue-300 text-sm",children:"執行中，請稍候..."})}),a&&(0,s.jsxs)("details",{open:!0,className:"text-red-400 font-bold mt-2 animate-pulse bg-slate-800 rounded p-2",children:[(0,s.jsx)("summary",{children:"錯誤訊息 (點擊收合)"}),(0,s.jsx)("span",{className:"break-all",children:a}),(0,s.jsx)("button",{className:"ml-2 px-2 py-0.5 text-xs bg-red-700 text-white rounded hover:bg-red-600 border border-red-500",onClick:()=>{navigator.clipboard.writeText(a)},children:"複製錯誤"})]})]})});n.displayName="LogBox";let o=()=>{let[e,l]=(0,a.useState)(""),[t,o]=(0,a.useState)([]),[i,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(""),x=(0,a.useRef)(null),b=(0,a.useRef)(null),m=(0,a.useRef)(null),[h,p]=(0,a.useState)(!1),g=()=>{o([]),u(""),c(!0),x.current&&x.current.close();let l=new EventSource("/api/test/run-python?symbol=".concat(encodeURIComponent(e)));x.current=l,l.onmessage=e=>{o(l=>[...l,e.data])},l.onerror=()=>{u("串流連線錯誤或執行失敗"),c(!1),l.close()},l.addEventListener("end",e=>{o(l=>[...l,e.data]),c(!1),l.close()})},f=()=>{var e;l(""),u(""),c(!1),x.current&&x.current.close(),null==(e=m.current)||e.focus()};(0,a.useEffect)(()=>{b.current&&(b.current.scrollTop=b.current.scrollHeight)},[t,d,i]);let w=async()=>{var e;let t=await navigator.clipboard.readText();l(e=>e?e+" "+t:t),null==(e=m.current)||e.focus()};return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center pt-8 pb-20",children:(0,s.jsxs)("div",{className:"w-full max-w-6xl flex flex-col lg:flex-row gap-10 items-stretch",children:[(0,s.jsxs)("div",{className:"flex-1 w-full max-w-2xl bg-white rounded-2xl shadow-xl p-8 border border-blue-100 mb-8 lg:mb-0 min-h-[600px] h-[600px] flex flex-col",children:[(0,s.jsx)("h2",{className:"text-3xl font-extrabold text-blue-700 mb-2 text-center lg:text-left tracking-tight drop-shadow-sm",children:"金融數據手動獲取 / 更新"}),(0,s.jsxs)("p",{className:"text-blue-500 text-center lg:text-left mb-6 text-base font-medium",children:["抓取金融數據並存入 SQL SERVER。",(0,s.jsx)("a",{href:"https://github.com/HaoXun97/technical-indicators",className:"text-blue-600 underline hover:text-blue-800",target:"_blank",rel:"noopener noreferrer",children:"查看程式碼"})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-blue-700 font-semibold mb-1",htmlFor:"symbol-input",children:"輸入金融代號或參數"}),(0,s.jsxs)("div",{className:"relative flex items-center",children:[(0,s.jsx)("textarea",{ref:m,id:"symbol-input",value:e,onChange:e=>l(e.target.value),onKeyDown:l=>{"Enter"===l.key&&l.ctrlKey&&e&&!i&&g()},placeholder:"可輸入多個金融代號或參數，Enter換行，Ctrl+Enter執行",className:"w-full px-5 py-3 rounded-xl border-2 border-blue-200 focus:ring-4 focus:ring-blue-200 focus:outline-none text-lg bg-blue-50 placeholder-blue-300 text-blue-900 shadow-md pr-16 transition-all duration-200 resize-vertical min-h-[48px] max-h-[120px]",disabled:i,rows:2,spellCheck:!1,autoFocus:!0}),(0,s.jsx)("button",{type:"button",onClick:w,className:"absolute right-12 top-1/2 -translate-y-1/2 p-1.5 rounded-full hover:bg-blue-100 focus:outline-none",tabIndex:-1,"aria-label":"貼上",disabled:i,children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3a1 1 0 011-1h6a1 1 0 011 1v4m-9 4h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e&&!i&&(0,s.jsx)("button",{type:"button",onClick:f,className:"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 rounded-full hover:bg-blue-100 focus:outline-none",tabIndex:-1,"aria-label":"清除輸入",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 8.586l4.95-4.95a1 1 0 111.414 1.414L11.414 10l4.95 4.95a1 1 0 01-1.414 1.414L10 11.414l-4.95 4.95a1 1 0 01-1.414-1.414L8.586 10l-4.95-4.95A1 1 0 115.05 3.636L10 8.586z",clipRule:"evenodd"})})})]})]}),(0,s.jsxs)("div",{className:"mb-4 mt-4",children:[(0,s.jsx)("span",{className:"block text-xs text-slate-400 mb-1",children:"市場/參數選項"}),(0,s.jsx)(r,{loading:i,setSymbol:l,setSymbolDirect:l})]}),(0,s.jsxs)("div",{className:"flex gap-4 mt-auto",children:[(0,s.jsx)("button",{onClick:g,disabled:i||!e,className:"flex-1 px-7 py-3 rounded-xl font-bold text-white text-lg transition-all duration-200 shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-300 items-center ".concat(i||!e?"bg-blue-200 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:i?(0,s.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,s.jsxs)("svg",{className:"animate-spin h-5 w-5 text-white",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),"執行中..."]}):"執行"}),(0,s.jsx)("button",{onClick:f,disabled:i&&!e,className:"px-7 py-3 rounded-xl font-bold text-blue-700 border border-blue-300 bg-white hover:bg-blue-50 transition-all duration-200 shadow focus:outline-none focus:ring-2 focus:ring-blue-200",children:"清除"})]}),(0,s.jsx)("div",{className:"text-xs text-slate-400 mt-2",children:"Ctrl+Enter 執行，支援多行輸入"})]}),(0,s.jsxs)("div",{className:"w-full lg:w-[640px] flex-shrink-0 min-h-[600px] h-[600px]",children:[(0,s.jsx)(n,{ref:b,logs:t,error:d,loading:i,onCopy:()=>{navigator.clipboard.writeText(t.join("\n")),p(!0),setTimeout(()=>p(!1),1200)}}),h&&(0,s.jsx)("div",{className:"absolute right-8 top-8 bg-green-600 text-white px-3 py-1 rounded shadow text-xs animate-fade-in-out",children:"已複製"})]})]})})}}},e=>{var l=l=>e(e.s=l);e.O(0,[636,593,792],()=>l(228)),_N_E=e.O()}]);