(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{228:(e,l,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/test/run-python",function(){return t(1502)}])},1502:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>o});var a=t(7876),s=t(4232);let r=e=>{let{loading:l,mode:t,setSymbol:s,setSymbolDirect:r}=e,n=[{param:"--tw",label:"台股"},{param:"--us",label:"美股"},{param:"--etf",label:"ETF"},{param:"--index",label:"指數"},{param:"--forex",label:"外匯"},{param:"--crypto",label:"加密貨幣"},{param:"--futures",label:"期貨"}],o="fundamental"===t?[{param:"--tw",label:"台股"},{param:"--two",label:"台股上櫃"},{param:"--us",label:"美股"},{param:"--forex",label:"外匯"},{param:"--crypto",label:"加密貨幣"}]:n;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:o.map(e=>{let{param:t,label:r}=e;return(0,a.jsxs)("button",{type:"button",className:"px-3 py-1.5 rounded-lg bg-green-100 text-green-700 font-medium border border-green-300 hover:bg-green-200 transition text-xs shadow-sm focus:outline-none focus:ring-2 focus:ring-green-200",onClick:()=>{s(e=>{let l=n.map(e=>e.param),a=e.split(/\s+/).filter(e=>!l.includes(e)&&""!==e).join(" ");return a?a+" "+t:t})},disabled:l,children:[t," ",(0,a.jsxs)("span",{className:"text-[10px] text-green-400 ml-1",children:["(",r,")"]})]},t)})}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:("fundamental"===t?[{param:"--help",label:"顯示說明"},{param:"--nfp",label:"美國非農就業人數"},{param:"--cpi",label:"美國消費者物價指數"},{param:"--oil",label:"WTI原油價格"},{param:"--gold",label:"黃金期貨價格"}]:[{param:"--help",label:"顯示說明"},{param:"--indicators-only",label:"重新計算技術指標"},{param:"--expand-history",label:"獲取歷史資料"},{param:"--pattern",label:"重新辨識 K 線型態-歷史"},{param:"--show-all-stats",label:"顯示統計資訊"}]).map(e=>{let{param:t,label:s}=e;return(0,a.jsxs)("button",{type:"button",className:"px-3 py-1.5 rounded-lg bg-blue-100 text-blue-700 font-medium border border-blue-300 hover:bg-blue-200 transition text-xs shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-200",onClick:()=>r(t),disabled:l,children:[t," ",(0,a.jsxs)("span",{className:"text-[10px] text-blue-400 ml-1",children:["(",s,")"]})]},t)})}),"fundamental"===t&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:[{param:"--start_date",label:"起始日期"},{param:"--end_date",label:"結束日期"}].map(e=>{let{param:t,label:r}=e;return(0,a.jsxs)("button",{type:"button",className:"px-3 py-1.5 rounded-lg bg-pink-100 text-pink-700 font-medium border border-pink-300 hover:bg-pink-200 transition text-xs shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-200",onClick:()=>s(e=>e?e+" "+t:t),disabled:l,children:[t.split(" ")[0]," ",(0,a.jsxs)("span",{className:"text-[10px] text-pink-400 ml-1",children:["(",r,")"]})]},t)})})]})},n=s.forwardRef((e,l)=>{let{logs:t,error:s,loading:r,onCopy:n}=e;return(0,a.jsxs)("div",{ref:l,className:"bg-slate-900 rounded-2xl p-5 min-h-[320px] max-h-[600px] h-[600px] overflow-y-auto text-green-200 font-mono text-base whitespace-pre-wrap shadow-lg border-2 border-slate-700 outline-none relative scrollbar-hide",tabIndex:-1,style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[(0,a.jsx)("style",{children:".scrollbar-hide::-webkit-scrollbar { display: none; }"}),(0,a.jsx)("button",{className:"absolute right-4 top-4 px-2 py-1 text-xs bg-slate-800 text-slate-200 rounded hover:bg-slate-700 border border-slate-600 z-10",onClick:n,style:{opacity:t.length>0?1:.5},disabled:0===t.length,children:"複製全部"}),0===t.length&&!s&&!r&&(0,a.jsx)("span",{className:"text-slate-500",children:"輸出結果將顯示於此處..."}),t.map((e,l)=>(0,a.jsx)("div",{className:"break-all",children:e},l)),r&&(0,a.jsx)("div",{className:"absolute left-0 right-0 bottom-2 flex justify-center animate-pulse",children:(0,a.jsx)("span",{className:"text-blue-300 text-sm",children:"執行中，請稍候..."})}),s&&(0,a.jsxs)("details",{open:!0,className:"text-red-400 font-bold mt-2 animate-pulse bg-slate-800 rounded p-2",children:[(0,a.jsx)("summary",{children:"錯誤訊息 (點擊收合)"}),(0,a.jsx)("span",{className:"break-all",children:s}),(0,a.jsx)("button",{className:"ml-2 px-2 py-0.5 text-xs bg-red-700 text-white rounded hover:bg-red-600 border border-red-500",onClick:()=>{navigator.clipboard.writeText(s)},children:"複製錯誤"})]})]})});n.displayName="LogBox";let o=()=>{let[e,l]=(0,s.useState)(""),[t,o]=(0,s.useState)("technical"),[i,c]=(0,s.useState)([]),[d,u]=(0,s.useState)(!1),[x,b]=(0,s.useState)(""),m=(0,s.useRef)(null),p=(0,s.useRef)(null),h=(0,s.useRef)(null),[g,f]=(0,s.useState)(!1),w=()=>{c([]),b(""),u(!0),m.current&&m.current.close();let l=["symbol=".concat(encodeURIComponent(e)),"mode=".concat(t)].filter(Boolean).join("&"),a=new EventSource("/api/test/run-python?".concat(l));m.current=a,a.onmessage=e=>{c(l=>[...l,e.data])},a.onerror=()=>{b("串流連線錯誤或執行失敗"),u(!1),a.close()},a.addEventListener("end",e=>{c(l=>[...l,e.data]),u(!1),a.close()})},j=()=>{var e;l(""),b(""),u(!1),m.current&&m.current.close(),null==(e=h.current)||e.focus()};(0,s.useEffect)(()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)},[i,x,d]);let v=async()=>{var e;let t=await navigator.clipboard.readText();l(e=>e?e+" "+t:t),null==(e=h.current)||e.focus()};return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center pt-8 pb-20",children:(0,a.jsxs)("div",{className:"w-full max-w-6xl flex flex-col lg:flex-row gap-10 items-stretch",children:[(0,a.jsxs)("div",{className:"flex-1 w-full max-w-4xl bg-white rounded-2xl shadow-xl p-8 border border-blue-100 mb-8 lg:mb-0 min-h-[670px] h-[670px] flex flex-col",children:[(0,a.jsx)("h2",{className:"text-3xl font-extrabold text-blue-700 mb-2 text-center lg:text-left tracking-tight drop-shadow-sm",children:"金融數據手動獲取 / 更新"}),(0,a.jsxs)("p",{className:"text-blue-500 text-center lg:text-left mb-6 text-base font-medium",children:["抓取金融數據並存入 SQL SERVER。",(0,a.jsx)("a",{href:"https://github.com/HaoXun97/technical-indicators",className:"text-blue-600 underline hover:text-blue-800",target:"_blank",rel:"noopener noreferrer",children:"查看程式碼"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-blue-700 font-semibold mb-2",children:"選擇模式"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>o("technical"),className:"px-4 py-2 rounded-lg font-medium transition ".concat("technical"===t?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),disabled:d,children:"技術指標模式"}),(0,a.jsx)("button",{onClick:()=>o("fundamental"),className:"px-4 py-2 rounded-lg font-medium transition ".concat("fundamental"===t?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),disabled:d,children:"基本面模式"})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-blue-700 font-semibold mb-1",htmlFor:"symbol-input",children:"輸入金融代號或參數"}),(0,a.jsxs)("div",{className:"relative flex items-center",children:[(0,a.jsx)("textarea",{ref:h,id:"symbol-input",value:e,onChange:e=>l(e.target.value),onKeyDown:l=>{"Enter"===l.key&&l.ctrlKey&&e&&!d&&w()},placeholder:"fundamental"===t?"基本面模式：輸入股票代號和市場參數，例：2330 --tw 或 AAPL --us":"技術指標模式：可輸入多個金融代號或參數，Enter換行，Ctrl+Enter執行",className:"w-full px-5 py-3 rounded-xl border-2 border-blue-200 focus:ring-4 focus:ring-blue-200 focus:outline-none text-lg bg-blue-50 placeholder-blue-300 text-blue-900 shadow-md pr-16 transition-all duration-200 resize-vertical min-h-[48px] max-h-[120px]",disabled:d,rows:2,spellCheck:!1,autoFocus:!0}),(0,a.jsx)("button",{type:"button",onClick:v,className:"absolute right-12 top-1/2 -translate-y-1/2 p-1.5 rounded-full hover:bg-blue-100 focus:outline-none",tabIndex:-1,"aria-label":"貼上",disabled:d,children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3a1 1 0 011-1h6a1 1 0 011 1v4m-9 4h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e&&!d&&(0,a.jsx)("button",{type:"button",onClick:j,className:"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 rounded-full hover:bg-blue-100 focus:outline-none",tabIndex:-1,"aria-label":"清除輸入",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 8.586l4.95-4.95a1 1 0 111.414 1.414L11.414 10l4.95 4.95a1 1 0 01-1.414 1.414L10 11.414l-4.95 4.95a1 1 0 01-1.414-1.414L8.586 10l-4.95-4.95A1 1 0 115.05 3.636L10 8.586z",clipRule:"evenodd"})})})]})]}),(0,a.jsxs)("div",{className:"mb-4 mt-4",children:[(0,a.jsx)("span",{className:"block text-xs text-slate-400 mb-1",children:"市場/參數選項"}),(0,a.jsx)(r,{loading:d,mode:t,setSymbol:l,setSymbolDirect:l})]}),(0,a.jsxs)("div",{className:"flex gap-4 mt-auto",children:[(0,a.jsx)("button",{onClick:w,disabled:d||!e,className:"flex-1 px-7 py-3 rounded-xl font-bold text-white text-lg transition-all duration-200 shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-300 items-center ".concat(d||!e?"bg-blue-200 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:d?(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 text-white",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),"執行中..."]}):"執行"}),(0,a.jsx)("button",{onClick:j,disabled:d&&!e,className:"px-7 py-3 rounded-xl font-bold text-blue-700 border border-blue-300 bg-white hover:bg-blue-50 transition-all duration-200 shadow focus:outline-none focus:ring-2 focus:ring-blue-200",children:"清除"})]}),(0,a.jsx)("div",{className:"text-xs text-slate-400 mt-2",children:"Ctrl+Enter 執行，支援多行輸入"})]}),(0,a.jsxs)("div",{className:"w-full lg:w-[640px] flex-shrink-0 min-h-[600px] h-[600px]",children:[(0,a.jsx)(n,{ref:p,logs:i,error:x,loading:d,onCopy:()=>{navigator.clipboard.writeText(i.join("\n")),f(!0),setTimeout(()=>f(!1),1200)}}),g&&(0,a.jsx)("div",{className:"absolute right-8 top-8 bg-green-600 text-white px-3 py-1 rounded shadow text-xs animate-fade-in-out",children:"已複製"})]})]})})}}},e=>{e.O(0,[636,593,792],()=>e(e.s=228)),_N_E=e.O()}]);