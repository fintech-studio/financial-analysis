(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[672],{3956:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/test/stock-query",function(){return n(6045)}])},6045:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>eR});var l=n(7876),r=n(4232),a=n(2579),i=n(7212),o=n(3362),s=n(1151),c=n(5395),d=n(9694);let m=[{value:"market_stock_tw",label:"台股",color:"bg-blue-100 text-blue-700 border-blue-200"},{value:"market_stock_us",label:"美股",color:"bg-red-100 text-red-700 border-red-200"},{value:"market_etf",label:"ETF",color:"bg-green-100 text-green-700 border-green-200"},{value:"market_index",label:"指數",color:"bg-orange-100 text-orange-700 border-orange-200"},{value:"market_forex",label:"外匯",color:"bg-purple-100 text-purple-700 border-purple-200"},{value:"market_crypto",label:"加密貨幣",color:"bg-yellow-100 text-yellow-700 border-yellow-200"},{value:"market_futures",label:"期貨",color:"bg-pink-100 text-pink-700 border-pink-200"}],h=[{symbol:"2330",name:"台積電",type:"上市",market:"market_stock_tw"},{symbol:"9950",name:"萬國通",type:"上櫃",market:"market_stock_tw"},{symbol:"AAPL",name:"Apple",type:"US",market:"market_stock_us"},{symbol:"TSLA",name:"Tesla",type:"US",market:"market_stock_us"},{symbol:"000001.SS",name:"上證綜合指數",type:"CN",market:"market_index"},{symbol:"^DJI",name:"道瓊工業指數",type:"US",market:"market_index"},{symbol:"^GSPC",name:"標普500指數",type:"US",market:"market_index"},{symbol:"^N225",name:"日經225指數",type:"JP",market:"market_index"},{symbol:"^TWII",name:"台灣加權指數",type:"TW",market:"market_index"},{symbol:"^TWOII",name:"台灣櫃買指數",type:"TWO",market:"market_index"},{symbol:"0050",name:"元大台灣50",type:"ETF",market:"market_etf"},{symbol:"00878",name:"國泰永續高股息",type:"ETF",market:"market_etf"},{symbol:"TWD=X",name:"美元/台幣",type:"外匯",market:"market_forex"},{symbol:"JPYTWD=X",name:"日圓/台幣",type:"外匯",market:"market_forex"},{symbol:"CL=F",name:"原油",type:"期貨",market:"market_futures"},{symbol:"GC=F",name:"黃金",type:"期貨",market:"market_futures"},{symbol:"BTC-USD",name:"比特幣",type:"Crypto",market:"market_crypto"},{symbol:"ETH-USD",name:"以太坊",type:"Crypto",market:"market_crypto"},{symbol:"SOL-USD",name:"索拉納",type:"Crypto",market:"market_crypto"}],u={market_stock_tw:"market_stock_tw",market_stock_us:"market_stock_us",market_etf:"market_etf",market_index:"market_index",market_forex:"market_forex",market_crypto:"market_crypto",market_futures:"market_futures",台股:"market_stock_tw",美股:"market_stock_us",ETF:"market_etf",指數:"market_index",外匯:"market_forex",加密貨幣:"market_crypto",期貨:"market_futures"},g=e=>{let{symbol:t,onSymbolChange:n,timeframe:g,onTimeframeChange:x,loading:p=!1,market:y,onMarketChange:b,onSymbolAndMarketChange:f}=e,[v,N]=(0,r.useState)(!1),[w,k]=(0,r.useState)(!1),[j,M]=(0,r.useState)(-1),[C,E]=(0,r.useState)(t),{suggestions:T,fetching:R}=function(e){let[t,n]=(0,r.useState)([]),[l,a]=(0,r.useState)(!1),i=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(!e.trim())return void n([]);a(!0),i.current&&i.current.abort();let t=new AbortController;return i.current=t,fetch("/api/market_data?q=".concat(encodeURIComponent(e)),{signal:t.signal}).then(e=>e.json()).then(e=>{n(Array.isArray(e)?e.slice(0,50):[])}).catch(e=>{"AbortError"!==e.name&&n([])}).finally(()=>a(!1)),()=>t.abort()},[e]),{suggestions:t,fetching:l}}(function(e,t){let[n,l]=(0,r.useState)(e);return(0,r.useEffect)(()=>{let t=setTimeout(()=>l(e),300);return()=>clearTimeout(t)},[e,300]),n}(C,300)),D=(0,r.useMemo)(()=>m,[]),A=(0,r.useMemo)(()=>h,[]);(0,r.useEffect)(()=>{E(t)},[t]);let S=(0,r.useCallback)(async()=>{if(C.trim())try{let e=await fetch("/api/market_data?q=".concat(encodeURIComponent(C))),t=await e.json();if(Array.isArray(t)&&t.length>0){let e=u[t[0].market_category];e&&e!==y&&b(e)}}catch(e){}finally{n(C)}},[C,y,b,n]),_=(0,r.useCallback)((e,t)=>{if(E(e),t){let e=u[t];e&&e!==y&&b(e)}n(e),k(!1),M(-1)},[y,b,n]),O=(0,r.useCallback)(e=>{let t=e.target.value.toUpperCase();E(t),k(!!t.trim()),M(-1)},[]),I=(0,r.useCallback)(e=>{if(!w||0===T.length){"Enter"===e.key&&(e.preventDefault(),!p&&C.trim()&&S());return}if("ArrowDown"===e.key)e.preventDefault(),M(e=>e<T.length-1?e+1:0);else if("ArrowUp"===e.key)e.preventDefault(),M(e=>e>0?e-1:T.length-1);else if("Enter"===e.key)if(e.preventDefault(),j>=0){let e=T[j];_(e.symbol,e.market_type)}else!p&&C.trim()&&(n(C),k(!1));else"Escape"===e.key&&(k(!1),M(-1))},[w,T,j,p,C,S,_,n]),L=(0,r.useCallback)(e=>{let t=e.market_type||e.market_category,l=t&&u[t];f&&l?f(e.symbol,l):(l&&l!==y&&b(l),n(e.symbol)),E(e.symbol),k(!1),M(-1)},[y,b,n,f]),P=(0,r.useCallback)(()=>{N(!0),C.trim()&&T.length>0&&k(!0)},[C,T]),U=(0,r.useCallback)(()=>{N(!1),setTimeout(()=>k(!1),150)},[]),W=(0,r.useCallback)(e=>{E(e)},[]),V=(0,r.useCallback)(e=>{var t;return(0,l.jsxs)("span",{className:"ml-2 px-2 py-1 text-xs bg-blue-50 text-blue-700 border border-blue-200 rounded",children:[e.market_category,e.market_type&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"mx-1 text-gray-400",children:"-"}),(0,l.jsx)("span",{className:"text-xs text-blue-700",children:(null==(t=D.find(t=>t.value===e.market_type))?void 0:t.label)||e.market_type})]})]})},[D]);return(0,l.jsx)("div",{className:"w-full",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mt-4",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-6 xl:flex-row xl:gap-4 xl:items-end",children:[(0,l.jsxs)("div",{className:"flex-1 min-w-[220px]",children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,l.jsx)(o.A,{className:"w-4 h-4 inline mr-1"}),"金融代號"]}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("input",{type:"text",value:C,onChange:O,onKeyDown:I,onFocus:P,onBlur:U,placeholder:"輸入金融代號 (例: 2330, AAPL, 0050, CL=F)",className:"w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-gray-900 focus:border-gray-900 transition-colors",disabled:p,"aria-autocomplete":"list","aria-controls":"stock-suggestions","aria-activedescendant":j>=0?"suggestion-".concat(j):void 0}),(p||R)&&(0,l.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,l.jsx)(s.A,{className:"w-5 h-5 text-gray-500 animate-spin"})}),(0,l.jsx)(i.N,{children:w&&T.length>0&&(0,l.jsx)(a.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute z-20 left-0 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto",id:"stock-suggestions",role:"listbox",children:T.map((e,t)=>(0,l.jsxs)("button",{id:"suggestion-".concat(t),onClick:()=>L(e),className:"w-full px-4 py-3 text-left hover:bg-gray-50 focus:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0 ".concat(t===j?"bg-gray-50":""),role:"option","aria-selected":t===j,children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 font-medium text-gray-900",children:[(0,l.jsx)("span",{children:e.symbol}),V(e)]}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:e.name})]},e.symbol+(e.market_type||"")))})})]})]}),(0,l.jsx)("div",{className:"max-w-[320px] flex flex-col items-start",children:(0,l.jsxs)("div",{className:"flex flex-wrap w-full",children:[(0,l.jsx)("div",{className:"flex w-full gap-2 mb-2",children:D.slice(0,4).map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>b(e.value),className:"flex-1 flex items-center gap-1 px-3 py-1 rounded-md font-medium text-sm border transition-all duration-150\n                    ".concat(y===e.value?"".concat(e.color," shadow"):"bg-white text-gray-600 border-gray-300 hover:bg-gray-50","\n                  "),disabled:p,"aria-pressed":y===e.value,children:e.label},e.value))}),(0,l.jsx)("div",{className:"flex w-full gap-2",children:D.slice(4).map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>b(e.value),className:"flex-1 flex items-center gap-1 px-3 py-1 rounded-md font-medium text-sm border transition-all duration-150\n                    ".concat(y===e.value?"".concat(e.color," shadow"):"bg-white text-gray-600 border-gray-300 hover:bg-gray-50","\n                  "),disabled:p,"aria-pressed":y===e.value,children:e.label},e.value))})]})}),(0,l.jsxs)("div",{className:"min-w-[140px] flex flex-col items-start",children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,l.jsx)(c.A,{className:"w-4 h-4 inline mr-1"}),"時間週期"]}),(0,l.jsx)("div",{className:"flex bg-gray-100 p-1 rounded-md w-full",children:[{value:"1d",label:"日線"},{value:"1h",label:"小時線"}].map(e=>(0,l.jsx)("button",{onClick:()=>x(e.value),className:"flex-1 px-3 py-2 text-sm font-medium rounded transition-all duration-200 ".concat(g===e.value?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),type:"button",children:e.label},e.value))})]}),(0,l.jsx)("div",{className:"w-[120px] flex flex-col items-end justify-end",children:(0,l.jsx)(a.P.button,{whileHover:{scale:p?1:1.02},whileTap:{scale:p?1:.98},onClick:S,disabled:p||!C.trim(),className:"px-4 py-3 bg-gray-900 text-white rounded-md hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium w-full",type:"button",children:p?(0,l.jsxs)("div",{className:"flex items-center justify-center",children:[(0,l.jsx)(s.A,{className:"w-4 h-4 mr-2 animate-spin"}),"查詢中"]}):"查詢"})})]}),(0,l.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[(0,l.jsxs)("p",{className:"text-sm text-gray-600 mb-3 flex items-center",children:[(0,l.jsx)(d.A,{className:"w-4 h-4 mr-1"}),"熱門股票"]}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:A.map(e=>(0,l.jsxs)(a.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onMouseDown:()=>W(e.symbol),onClick:()=>_(e.symbol,e.market),className:"px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md transition-colors flex items-center gap-1",type:"button",children:[(0,l.jsx)("span",{className:"font-medium",children:e.symbol}),(0,l.jsx)("span",{className:"text-gray-500",children:e.name}),(0,l.jsx)("span",{className:"px-1 py-0.5 text-xs bg-gray-200 text-gray-600 rounded",children:e.type})]},e.symbol))})]})]})})};var x=n(5364),p=n(365);let y=e=>{let{symbol:t,stats:n,timeframe:r}=e,a=e=>e?e.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","):"--",i=n.change>=0;return(0,l.jsxs)("div",{className:"bg-white rounded-lg border border-gray-100 p-6 shadow-sm hover:shadow-lg transition-shadow duration-200",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("div",{className:"p-3 bg-gray-50 rounded-xl flex items-center justify-center",children:(0,l.jsx)(x.A,{className:"h-7 w-7 text-gray-500"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-extrabold text-gray-900 tracking-tight leading-tight mb-1",children:t}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-gray-500",children:[(0,l.jsx)("span",{className:"font-medium",children:"1d"===r?"日線":"小時線"}),(0,l.jsx)("span",{className:"hidden sm:inline",children:"|"}),(0,l.jsxs)("span",{children:["最後更新：",(e=>{if(!e)return"--";try{let t=new Date(e);if(isNaN(t.getTime())){let n=e.replace("T"," ").replace("Z","");t=new Date(n)}if(isNaN(t.getTime()))return e;let n=t.getUTCFullYear(),l=String(t.getUTCMonth()+1).padStart(2,"0"),a=String(t.getUTCDate()).padStart(2,"0");if("1d"===r)return"".concat(n,"/").concat(l,"/").concat(a);{let e=String(t.getUTCHours()).padStart(2,"0"),r=String(t.getUTCMinutes()).padStart(2,"0");return"".concat(n,"/").concat(l,"/").concat(a," ").concat(e,":").concat(r)}}catch(t){return e}})(n.datetime)]})]})]})]}),(0,l.jsxs)("div",{className:"text-right min-w-[120px] flex flex-col items-end justify-center",children:[(0,l.jsx)("div",{className:"text-3xl font-extrabold mb-1 ".concat(i?"text-red-600":"text-green-600"),children:a(n.latest)}),(0,l.jsxs)("div",{className:"flex items-center text-base font-semibold ".concat(i?"text-red-600":"text-green-600"),children:[i?(0,l.jsx)(x.A,{className:"h-4 w-4 mr-1"}):(0,l.jsx)(p.A,{className:"h-4 w-4 mr-1"}),i?"+":"",n.change?n.change.toFixed(2):"0.00"," (",i?"+":"",n.changePercent?n.changePercent.toFixed(2):"0.00","% )"]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,l.jsxs)("div",{className:"flex flex-col items-center p-3 bg-gray-50 rounded-xl",children:[(0,l.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"開盤 (O)"}),(0,l.jsx)("span",{className:"text-lg font-bold text-gray-900",children:a(n.open_price||n.open)})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center p-3 bg-gray-50 rounded-xl",children:[(0,l.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"最高 (H)"}),(0,l.jsx)("span",{className:"text-lg font-bold text-gray-900",children:a(n.high)})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center p-3 bg-gray-50 rounded-xl",children:[(0,l.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"最低 (L)"}),(0,l.jsx)("span",{className:"text-lg font-bold text-gray-900",children:a(n.low)})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center p-3 bg-gray-50 rounded-xl",children:[(0,l.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"收盤 (C)"}),(0,l.jsx)("span",{className:"text-lg font-bold ".concat(i?"text-red-600":"text-green-600"),children:a(n.latest)})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center p-3 bg-gray-50 rounded-xl",children:[(0,l.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"成交量 (V)"}),(0,l.jsx)("span",{className:"text-lg font-bold text-gray-900",children:(e=>e?e>=1e9?"".concat((e/1e9).toFixed(1),"B"):e>=1e6?"".concat((e/1e6).toFixed(1),"M"):e>=1e3?"".concat((e/1e3).toFixed(1),"K"):e.toLocaleString():"N/A")(n.volume)})]})]})]})};var b=n(7178),f=n(9252),v=n(3394),N=n(8621);let w=e=>{var t;let{data:n,technicalData:o,title:s="K線圖",height:c=500,showVolume:d=!0,theme:m="light",timeframe:h="1d"}=e,u=(0,r.useRef)(null),g=(0,r.useRef)(null),x=(0,r.useRef)(null),p=(0,r.useRef)(null),y=(0,r.useRef)(new Map),[w,k]=(0,r.useState)(!1),[j,M]=(0,r.useState)(!1),[C,E]=(0,r.useState)("移動平均"),[T,R]=(0,r.useState)(null),[D,A]=(0,r.useState)(null),S=(0,r.useMemo)(()=>[{key:"ma5",name:"MA5",color:"#3b82f6",enabled:!0,lineWidth:2,category:"移動平均",description:"5日移動平均線",overlay:!0},{key:"ma10",name:"MA10",color:"#f59e0b",enabled:!0,lineWidth:2,category:"移動平均",description:"10日移動平均線",overlay:!0},{key:"ma20",name:"MA20",color:"#ef4444",enabled:!1,lineWidth:2,category:"移動平均",description:"20日移動平均線",overlay:!0},{key:"ma60",name:"MA60",color:"#8b5cf6",enabled:!1,lineWidth:2,category:"移動平均",description:"60日移動平均線",overlay:!0},{key:"ema12",name:"EMA12",color:"#06b6d4",enabled:!1,lineWidth:2,category:"移動平均",description:"12日指數移動平均",overlay:!0},{key:"ema26",name:"EMA26",color:"#84cc16",enabled:!1,lineWidth:2,category:"移動平均",description:"26日指數移動平均",overlay:!0},{key:"bb_upper",name:"布林上軌",color:"#f87171",enabled:!1,lineWidth:1,category:"布林通道",description:"布林帶上軌",overlay:!0},{key:"bb_middle",name:"布林中軌",color:"#fbbf24",enabled:!1,lineWidth:2,category:"布林通道",description:"布林帶中軌",overlay:!0},{key:"bb_lower",name:"布林下軌",color:"#34d399",enabled:!1,lineWidth:1,category:"布林通道",description:"布林帶下軌",overlay:!0},{key:"rsi_5",name:"RSI(5)",color:"#ef4444",enabled:!1,lineWidth:2,category:"震盪指標",description:"5日相對強弱指標",overlay:!1},{key:"rsi_7",name:"RSI(7)",color:"#f59e0b",enabled:!1,lineWidth:2,category:"震盪指標",description:"7日相對強弱指標",overlay:!1},{key:"rsi_14",name:"RSI(14)",color:"#8b5cf6",enabled:!1,lineWidth:2,category:"震盪指標",description:"14日相對強弱指標",overlay:!1},{key:"rsi_21",name:"RSI(21)",color:"#06b6d4",enabled:!1,lineWidth:2,category:"震盪指標",description:"21日相對強弱指標",overlay:!1},{key:"macd",name:"MACD",color:"#3b82f6",enabled:!1,lineWidth:2,category:"趨勢指標",description:"MACD快線",overlay:!1},{key:"dif",name:"DIF",color:"#ef4444",enabled:!1,lineWidth:2,category:"趨勢指標",description:"MACD慢線",overlay:!1},{key:"k_value",name:"K值",color:"#3b82f6",enabled:!1,lineWidth:2,category:"隨機指標",description:"隨機指標K值",overlay:!1},{key:"d_value",name:"D值",color:"#ef4444",enabled:!1,lineWidth:2,category:"隨機指標",description:"隨機指標D值",overlay:!1},{key:"j_value",name:"J值",color:"#f59e0b",enabled:!1,lineWidth:2,category:"隨機指標",description:"隨機指標J值",overlay:!1},{key:"atr",name:"ATR",color:"#84cc16",enabled:!1,lineWidth:2,category:"其他指標",description:"平均真實波幅",overlay:!1},{key:"cci",name:"CCI",color:"#06b6d4",enabled:!1,lineWidth:2,category:"其他指標",description:"順勢指標",overlay:!1},{key:"willr",name:"WillR",color:"#8b5cf6",enabled:!1,lineWidth:2,category:"其他指標",description:"威廉指標",overlay:!1},{key:"mom",name:"MOM",color:"#f87171",enabled:!1,lineWidth:2,category:"其他指標",description:"動量指標",overlay:!1}],[]),[_,O]=(0,r.useState)(S),I=(0,r.useMemo)(()=>{let e={};return _.forEach(t=>{e[t.category]||(e[t.category]=[]),e[t.category].push(t)}),e},[_]),L=(0,r.useMemo)(()=>{if(!(null==n?void 0:n.length))return null;try{let e=n.map(e=>({time:Math.floor(new Date(e.date).getTime()/1e3),open:Number(e.open)||0,high:Number(e.high)||0,low:Number(e.low)||0,close:Number(e.close)||0})).filter(e=>e.open>0&&e.high>0&&e.low>0&&e.close>0),t=n.filter(e=>e.volume&&Number(e.volume)>0).map(e=>({time:Math.floor(new Date(e.date).getTime()/1e3),value:Number(e.volume),color:e.close>=e.open?"#ef444460":"#10b98160"}));return{candleData:e,volumeData:t}}catch(e){return console.error("Chart data conversion error:",e),null}},[n]),P=(0,r.useMemo)(()=>{if(!o||!(null==n?void 0:n.length))return{overlay:{},separate:{}};let e={},t={};return _.filter(e=>e.enabled).forEach(l=>{let r=o[l.key];if(!(null==r?void 0:r.length))return void console.warn("No data found for indicator: ".concat(l.key));let a=[],i=n.length,s=r.length;for(let e=0;e<i;e++){let t=e-(i-s),l=t>=0?r[t]:null,o=n[e];if(null!=l&&!isNaN(Number(l))&&o&&o.date){let e=Math.floor(new Date(o.date).getTime()/1e3);a.push({time:e,value:Number(l)})}}a.sort((e,t)=>e.time-t.time),a.length>0?l.overlay?(e[l.key]=a,console.log("Added overlay indicator: ".concat(l.key,", data points: ").concat(a.length))):(t[l.key]=a,console.log("Added separate indicator: ".concat(l.key,", data points: ").concat(a.length))):console.warn("No valid data points for indicator: ".concat(l.key))}),{overlay:e,separate:t}},[o,n,_]);(0,r.useMemo)(()=>{if(!(null==n?void 0:n.length))return null;try{let e=n[n.length-1],t=n.length>1?n[n.length-2]:e,l=Number(e.close)-Number(t.close),r=l/Number(t.close)*100;return{latest:e,change:l,changePercent:r,isRising:l>=0,high:Math.max(...n.map(e=>Number(e.high))),low:Math.min(...n.map(e=>Number(e.low)))}}catch(e){return console.error("Stats calculation error:",e),null}},[n]),(0,r.useEffect)(()=>{if(!u.current||!L)return;let e="dark"===m;try{g.current&&g.current.remove(),y.current.clear();let t=(0,b.R9)(u.current,{layout:{background:{type:b.mE.Solid,color:e?"#1f2937":"#ffffff"},textColor:e?"#e5e7eb":"#374151"},width:u.current.clientWidth,height:w?window.innerHeight-200:c,grid:{vertLines:{color:e?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},horzLines:{color:e?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}},crosshair:{mode:1},rightPriceScale:{borderColor:e?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)",scaleMargins:{top:.1,bottom:d?.3:.1}},timeScale:{borderColor:e?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)",timeVisible:"1h"===h,secondsVisible:!1},localization:{locale:"zh-TW"}});g.current=t;let l=t.addCandlestickSeries({upColor:"#ef4444",downColor:"#10b981",borderUpColor:"#dc2626",borderDownColor:"#059669",wickUpColor:"#dc2626",wickDownColor:"#059669",priceLineVisible:!0,lastValueVisible:!0});if(x.current=l,l.setData(L.candleData),d&&L.volumeData.length>0){let e=t.addHistogramSeries({color:"#26a69a",priceFormat:{type:"volume"},priceScaleId:"volume"});t.priceScale("volume").applyOptions({scaleMargins:{top:.8,bottom:0},borderVisible:!1}),p.current=e,e.setData(L.volumeData)}let r=Object.keys(P.overlay);if(r.length>0){let e=new Map;r.forEach(n=>{let l=P.overlay[n],r=_.find(e=>e.key===n);if(r&&l&&l.length>0){console.log("Creating overlay series for ".concat(r.name," with ").concat(l.length," data points"));let a=t.addLineSeries({color:r.color,lineWidth:r.lineWidth||2,title:r.name,priceLineVisible:!1,lastValueVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4});try{a.setData(l),e.set(n,a),console.log("Successfully added overlay indicator: ".concat(r.name))}catch(e){console.error("Error setting data for overlay indicator ".concat(r.name,":"),e)}}}),y.current=e}let a=Object.keys(P.separate);a.length>0&&a.forEach(e=>{let n=P.separate[e],l=_.find(t=>t.key===e);if(l&&n&&n.length>0){console.log("Creating separate indicator series for ".concat(l.name," with ").concat(n.length," data points"));let r="indicator_".concat(e),a=t.addLineSeries({color:l.color,lineWidth:l.lineWidth||2,title:l.name,priceLineVisible:!1,lastValueVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,priceScaleId:r});t.priceScale(r).applyOptions({scaleMargins:{top:.7,bottom:.1},borderVisible:!1});try{a.setData(n),y.current||(y.current=new Map),y.current.set(e,a),console.log("Successfully added separate indicator: ".concat(l.name))}catch(e){console.error("Error setting data for separate indicator ".concat(l.name,":"),e)}}}),t.subscribeCrosshairMove(e=>{if(e&&e.time&&e.point)if(L.candleData.find(t=>t.time===e.time)){let t=n[L.candleData.findIndex(t=>t.time===e.time)];R(t||null),A({x:e.point.x,y:e.point.y})}else R(null),A(null);else R(null),A(null)}),console.log("Chart initialized with ".concat(r.length," overlay and ").concat(a.length," separate indicators"))}catch(e){console.error("Chart initialization error:",e)}return()=>{g.current&&(g.current.remove(),g.current=null),x.current=null,p.current=null,y.current.clear()}},[L,P,d,m,c,w,h,_]),(0,r.useEffect)(()=>{w&&window.scrollTo({top:0,behavior:"smooth"})},[w]),(0,r.useEffect)(()=>{let e=()=>{g.current&&u.current&&g.current.applyOptions({width:u.current.clientWidth,height:w?window.innerHeight-180:c})};if(w)return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[w,c]);let U=(0,r.useCallback)(e=>{O(t=>t.map(t=>t.key===e?{...t,enabled:!t.enabled}:t))},[]),W=(0,r.useCallback)(e=>{let t={基礎分析:["ma5","ma10","ma20"],短線交易:["ma5","ma10","rsi_14","k_value","d_value"],趨勢分析:["ma20","ma60","macd","dif","bb_upper","bb_middle","bb_lower"],全面分析:["ma5","ma10","ma20","rsi_14","macd","k_value","d_value"]}[e]||[];O(e=>e.map(e=>({...e,enabled:t.includes(e.key)})))},[]),V=(0,r.useCallback)(()=>{O(e=>e.map(e=>({...e,enabled:!1})))},[]);return L?(0,l.jsxs)("div",{className:"relative bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden ".concat(w?"fixed inset-0 z-[9999] m-0 rounded-none shadow-lg":""),children:[(0,l.jsx)("div",{className:"bg-gray-50 border-b border-gray-200 px-6 py-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)("div",{className:"p-2 bg-gray-100 rounded-lg",children:(0,l.jsx)(f.A,{className:"h-5 w-5 text-gray-600"})}),(0,l.jsx)("h3",{className:"pt-2 text-2xl font-semibold text-gray-900",children:s}),(0,l.jsxs)("span",{className:"text-sm text-gray-500",children:["1d"===h?"日線":"小時線"," • ",n.length," 筆數據 •"," ",(e=>{if(!e||0===e.length)return"--";let t=e=>{if(!e)return"--";let t=new Date(e.datetime||e.date);if(isNaN(t.getTime()))return"--";let n=t.getUTCFullYear(),l=String(t.getUTCMonth()+1).padStart(2,"0"),r=String(t.getUTCDate()).padStart(2,"0");if("1d"===h)return"".concat(n,"-").concat(l,"-").concat(r);{let e=String(t.getUTCHours()).padStart(2,"0"),a=String(t.getUTCMinutes()).padStart(2,"0");return"".concat(n,"-").concat(l,"-").concat(r," ").concat(e,":").concat(a)}};return"".concat(t(e[0])," ~ ").concat(t(e[e.length-1]))})(n)]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("button",{onClick:()=>M(!j),className:"px-3 py-2 text-sm font-medium rounded-md transition-colors ".concat(j?"bg-gray-900 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"技術指標設定"}),(0,l.jsx)("button",{onClick:()=>k(!w),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors",title:w?"退出全屏":"進入全屏",children:w?(0,l.jsx)(v.A,{className:"h-4 w-4"}):(0,l.jsx)(N.A,{className:"h-4 w-4"})})]})]})}),(0,l.jsx)(i.N,{children:j&&(0,l.jsx)(a.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"border-b border-gray-200 bg-white",children:(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"快速設定:"}),["基礎分析","短線交易","趨勢分析","全面分析"].map(e=>(0,l.jsx)("button",{onClick:()=>W(e),className:"px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md transition-colors",children:e},e)),(0,l.jsx)("button",{onClick:V,className:"px-3 py-1 text-xs bg-red-100 hover:bg-red-200 text-red-700 rounded-md transition-colors",children:"全部關閉"})]})}),(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)("div",{className:"flex gap-2",children:Object.keys(I).map(e=>(0,l.jsx)("button",{onClick:()=>E(e),className:"px-3 py-1 text-sm rounded-md transition-colors ".concat(C===e?"bg-gray-900 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e},e))})}),(0,l.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:null==(t=I[C])?void 0:t.map(e=>(0,l.jsxs)("label",{className:"flex flex-col items-start p-3 rounded-md border cursor-pointer transition-colors ".concat(e.enabled?"border-gray-900 bg-gray-50":"border-gray-200 bg-white hover:border-gray-300"),children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:e.enabled,onChange:()=>U(e.key),className:"sr-only"}),(0,l.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),(0,l.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.name})]}),e.description&&(0,l.jsx)("span",{className:"mt-1 text-xs text-gray-500",children:e.description})]},e.key))})]})})}),(0,l.jsxs)("div",{className:"p-4 relative",children:[T&&D&&(0,l.jsxs)("div",{className:"absolute z-10 bg-white/90 border border-gray-200 rounded shadow px-4 py-2 text-xs text-gray-800 pointer-events-none min-w-[140px]",style:{left:"calc(".concat(D.x,"px + 24px)"),top:"calc(".concat(D.y,"px + 12px)"),maxWidth:"220px"},children:[(0,l.jsxs)("div",{children:["日期: ",function(e,t){let n=new Date(e);if(isNaN(n.getTime()))return e;let l=e=>e.toString().padStart(2,"0"),r=n.getFullYear(),a=l(n.getMonth()+1),i=l(n.getDate());if("1d"===t)return"".concat(r,"-").concat(a,"-").concat(i);{let e=l(n.getHours()),t=l(n.getMinutes()),o=l(n.getSeconds());return"".concat(r,"-").concat(a,"-").concat(i," ").concat(e,":").concat(t,":").concat(o)}}(T.date,h)]}),(0,l.jsxs)("div",{children:["開盤: ",T.open]}),(0,l.jsxs)("div",{children:["最高: ",T.high]}),(0,l.jsxs)("div",{children:["最低: ",T.low]}),(0,l.jsxs)("div",{children:["收盤: ",T.close]}),void 0!==T.volume&&(0,l.jsxs)("div",{children:["成交量: ",T.volume]}),o&&_.filter(e=>e.enabled).length>0&&(0,l.jsxs)("div",{className:"mt-2 border-t pt-1 border-gray-200",children:[(0,l.jsx)("div",{className:"font-semibold text-gray-700 mb-1",children:"技術指標"}),(()=>{let e=n.findIndex(e=>e.date===T.date);return _.filter(e=>e.enabled).map(t=>{var r;let a=o[t.key],i=e-(n.length-(null!=(r=null==a?void 0:a.length)?r:0)),s=i>=0&&a?a[i]:void 0;return(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{className:"inline-block w-2 h-2 rounded-full",style:{background:t.color}}),(0,l.jsxs)("span",{children:[t.name,":"]}),(0,l.jsx)("span",{children:void 0!==s?Number(s).toFixed(2):"--"})]},t.key)})})()]})]}),(0,l.jsx)("div",{ref:u,style:{height:w?"calc(100vh - 150px)":"".concat(c,"px"),width:"100%"},className:"bg-white rounded border border-gray-100"})]}),(0,l.jsx)("div",{className:"bg-gray-50 px-6 py-2 border-t border-gray-200",children:(0,l.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,l.jsxs)("span",{children:["數據點: ",n.length," | 週期:"," ","1d"===h?"日線":"小時線"]}),(0,l.jsx)("div",{className:"text-center text-[12px] select-none",children:"Charting By TradingView Lightweight Charts"}),_.filter(e=>e.enabled).length>0&&(0,l.jsxs)("span",{children:["啟用指標:"," ",_.filter(e=>e.enabled).length]})]})})]}):(0,l.jsx)("div",{className:"flex items-center justify-center bg-white rounded-lg border border-gray-200 shadow-sm",style:{height:"".concat(c,"px")},children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(f.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-700 mb-1",children:"暫無圖表數據"}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:"請提供有效的價格數據"})]})})},k=e=>{let{data:t,technicalData:n,symbol:r,timeframe:a}=e;return(0,l.jsx)(w,{data:t,technicalData:n,title:"".concat(r),height:600,showVolume:!0,timeframe:a,theme:"light"})};var j=n(2988),M=n(4717),C=n(2719),E=n(2077),T=n(3680);let R=[{key:"datetime",name:"時間",type:"datetime",width:"w-40"},{key:"open_price",name:"開盤",type:"price",width:"w-24"},{key:"high_price",name:"最高",type:"price_high",width:"w-24"},{key:"low_price",name:"最低",type:"price_low",width:"w-24"},{key:"close_price",name:"收盤",type:"price_close",width:"w-24"},{key:"volume",name:"成交量",type:"volume",width:"w-32"},{key:"rsi_5",name:"RSI(5)",type:"indicator",width:"w-20"},{key:"rsi_7",name:"RSI(7)",type:"indicator",width:"w-20"},{key:"rsi_10",name:"RSI(10)",type:"indicator",width:"w-20"},{key:"rsi_14",name:"RSI(14)",type:"indicator",width:"w-20"},{key:"rsi_21",name:"RSI(21)",type:"indicator",width:"w-20"},{key:"dif",name:"DIF",type:"indicator",width:"w-20"},{key:"macd",name:"MACD",type:"indicator",width:"w-20"},{key:"macd_histogram",name:"MACD Histogram",type:"indicator",width:"w-20"},{key:"rsv",name:"RSV",type:"indicator",width:"w-20"},{key:"k_value",name:"K值",type:"indicator",width:"w-20"},{key:"d_value",name:"D值",type:"indicator",width:"w-20"},{key:"j_value",name:"J值",type:"indicator",width:"w-20"},{key:"ma5",name:"MA5",type:"indicator",width:"w-20"},{key:"ma10",name:"MA10",type:"indicator",width:"w-20"},{key:"ma20",name:"MA20",type:"indicator",width:"w-20"},{key:"ma60",name:"MA60",type:"indicator",width:"w-20"},{key:"ema12",name:"EMA12",type:"indicator",width:"w-20"},{key:"ema26",name:"EMA26",type:"indicator",width:"w-20"},{key:"bb_upper",name:"布林上軌",type:"indicator",width:"w-20"},{key:"bb_middle",name:"布林中軌",type:"indicator",width:"w-20"},{key:"bb_lower",name:"布林下軌",type:"indicator",width:"w-20"},{key:"atr",name:"ATR平均真實波幅",type:"indicator",width:"w-20"},{key:"cci",name:"CCI商品通道指標",type:"indicator",width:"w-20"},{key:"willr",name:"威廉指標",type:"indicator",width:"w-20"},{key:"mom",name:"動量指標",type:"indicator",width:"w-20"}],D=e=>{let{data:t,timeframe:n,symbol:o}=e,[s,c]=(0,r.useState)("datetime"),[d,m]=(0,r.useState)("desc"),[h,u]=(0,r.useState)(1),[g,x]=(0,r.useState)(20),[p,y]=(0,r.useState)(!1),[b,f]=(0,r.useState)(["datetime","open_price","high_price","low_price","close_price","volume","rsi_14","ma5","macd","k_value","d_value"]),v=(e,t)=>{if(null==e||""===e)return"—";switch(t.type){case"datetime":return N(e);case"volume":return w(e);case"price":case"price_high":case"price_low":case"price_close":return Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",");case"indicator":return Number(e).toFixed(3).replace(/\B(?=(\d{3})+(?!\d))/g,",");default:return String(e)}},N=e=>{try{let t=new Date(e);if(isNaN(t.getTime()))return e;let l=t.getUTCFullYear(),r=String(t.getUTCMonth()+1).padStart(2,"0"),a=String(t.getUTCDate()).padStart(2,"0"),i=String(t.getUTCHours()).padStart(2,"0"),o=String(t.getUTCMinutes()).padStart(2,"0");return"1h"===n?"".concat(l,"/").concat(r,"/").concat(a," ").concat(i,":").concat(o):"".concat(l,"/").concat(r,"/").concat(a)}catch(t){return e}},w=e=>{let t=Number(e);return isNaN(t)?"—":t>=1e9?"".concat((t/1e9).toFixed(1),"B"):t>=1e6?"".concat((t/1e6).toFixed(1),"M"):t>=1e3?"".concat((t/1e3).toFixed(1),"K"):t.toLocaleString()},k=(0,r.useMemo)(()=>[...t].sort((e,t)=>{let n=e[s],l=t[s];if(null==n)return 1;if(null==l)return -1;let r=n>l?1:-1;return"asc"===d?r:-r}),[t,s,d]),D=(0,r.useMemo)(()=>{let e=(h-1)*g;return k.slice(e,e+g)},[k,h,g]),A=Math.ceil(k.length/g),S=e=>{s===e?m("asc"===d?"desc":"asc"):(c(e),m("desc")),u(1)},_=e=>{f(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},O=e=>{if(null==e)return"";let t=String(e);return/[",\n]/.test(t)?'"'+t.replace(/"/g,'""')+'"':t};return t&&0!==t.length?(0,l.jsxs)(a.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden",children:[(0,l.jsxs)("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"p-2 bg-gray-100 rounded-lg",children:(0,l.jsx)(j.A,{className:"h-5 w-5 text-gray-600"})}),(0,l.jsx)("h3",{className:"pt-2 text-2xl font-semibold text-gray-900",children:o}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:["1d"===n?"日線":"小時線"," • ",t.length," 筆數據 •"," ",N(t[t.length-1].datetime)," ~"," ",N(t[0].datetime)]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("button",{onClick:()=>y(!p),className:"p-2 rounded-lg transition-all duration-200 flex items-center ".concat(p?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-500 hover:bg-gray-200"),title:"顯示/隱藏篩選器",children:[(0,l.jsx)(M.A,{className:"h-4 w-4 mr-1"}),(0,l.jsx)("span",{className:"text-sm font-normal",children:"篩選"})]}),(0,l.jsxs)("button",{onClick:()=>{let e=R.filter(e=>b.includes(e.key)).map(e=>O(e.name)).join(","),t=k.map(e=>R.filter(e=>b.includes(e.key)).map(t=>O(v(e[t.key],t))).join(",")).join("\n"),n=new Blob(["\uFEFF".concat(e,"\n").concat(t)],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(n),r=document.createElement("a");r.href=l,r.download="stock_data_".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l)},className:"p-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200 transition-all duration-200 flex items-center",title:"匯出 CSV",children:[(0,l.jsx)(C.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"text-sm font-normal",children:"下載 CSV"})]})]})]}),(0,l.jsx)(i.N,{children:p&&(0,l.jsx)(a.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 pt-4 border-t border-gray-200",children:(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"每頁顯示:"}),(0,l.jsxs)("select",{value:g,onChange:e=>{x(Number(e.target.value)),u(1)},className:"px-3 py-1 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,l.jsx)("option",{value:10,children:"10"}),(0,l.jsx)("option",{value:20,children:"20"}),(0,l.jsx)("option",{value:50,children:"50"}),(0,l.jsx)("option",{value:100,children:"100"})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"顯示欄位:"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:R.map(e=>(0,l.jsx)("button",{onClick:()=>_(e.key),className:"px-2 py-1 text-xs rounded transition-colors ".concat(b.includes(e.key)?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-500"),children:e.name},e.key))})]})]})})})]}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full",children:[(0,l.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,l.jsx)("tr",{children:R.filter(e=>b.includes(e.key)).map(e=>(0,l.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors ".concat(e.width||""),onClick:()=>S(e.key),children:(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{children:e.name}),s===e.key&&(0,l.jsx)(a.P.div,{initial:{scale:0},animate:{scale:1},className:"text-blue-500",children:"asc"===d?(0,l.jsx)(E.A,{className:"h-3 w-3"}):(0,l.jsx)(T.A,{className:"h-3 w-3"})})]})},e.key))})}),(0,l.jsx)("tbody",{className:"bg-white divide-y divide-gray-100",children:D.map((e,t)=>(0,l.jsx)(a.P.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.02*t},className:"hover:bg-blue-50 transition-colors",children:R.filter(e=>b.includes(e.key)).map(t=>(0,l.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm ".concat("datetime"===t.type?"text-gray-700 font-medium":"indicator"===t.type?"text-blue-600 font-mono":"text-gray-700"),children:v(e[t.key],t)},t.key))},t))})]})}),A>1&&(0,l.jsx)("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:["顯示 ",(h-1)*g+1," -"," ",Math.min(h*g,k.length)," 筆， 共"," ",k.length," 筆記錄"]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{onClick:()=>u(1),disabled:1===h,className:"px-3 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:"首頁"}),(0,l.jsx)("button",{onClick:()=>u(Math.max(1,h-1)),disabled:1===h,className:"px-3 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:"上一頁"}),(0,l.jsxs)("span",{className:"px-3 py-1 text-sm",children:["第 ",h," / ",A," 頁"]}),(0,l.jsx)("button",{onClick:()=>u(Math.min(A,h+1)),disabled:h===A,className:"px-3 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:"下一頁"}),(0,l.jsx)("button",{onClick:()=>u(A),disabled:h===A,className:"px-3 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:"末頁"})]})]})})]}):(0,l.jsx)(a.P.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-8",children:(0,l.jsxs)("div",{className:"text-center py-20",children:[(0,l.jsx)(j.A,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-500 mb-2",children:"無可顯示的數據"}),(0,l.jsx)("p",{className:"text-gray-400",children:"請先查詢股票數據"})]})})},A=()=>(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"w-12 h-12 border-3 border-gray-300 border-t-gray-900 rounded-full animate-spin mx-auto mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"正在載入數據"}),(0,l.jsx)("p",{className:"text-gray-500",children:"請稍候，正在處理股票資訊..."})]})});var S=n(3294),_=n(3532);let O=[{symbol:"2330",name:"台積電"},{symbol:"2454",name:"聯發科"},{symbol:"2317",name:"鴻海"},{symbol:"AAPL",name:"Apple"},{symbol:"TSLA",name:"Tesla"},{symbol:"NVDA",name:"NVIDIA"}],I=e=>{let{onQuickSelect:t}=e;return(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:(0,l.jsxs)("div",{className:"px-8 py-16 text-center",children:[(0,l.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,l.jsx)(S.A,{className:"h-8 w-8 text-gray-600"})}),(0,l.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 mb-3",children:"開始股票分析"}),(0,l.jsx)("p",{className:"text-gray-600 mb-8 max-w-md mx-auto",children:"輸入股票代號，獲得專業的技術分析和投資建議"}),(0,l.jsxs)("div",{className:"max-w-lg mx-auto",children:[(0,l.jsx)("p",{className:"text-sm text-gray-700 mb-4",children:"熱門股票："}),(0,l.jsx)("div",{className:"flex flex-wrap justify-center gap-2",children:O.map(e=>(0,l.jsxs)("button",{onClick:()=>t(e.symbol),className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md text-sm transition-colors",children:[e.symbol," ",e.name]},e.symbol))})]})]})})},L=e=>{let{error:t,onRetry:n,onClear:r}=e;return(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:(0,l.jsx)("div",{className:"p-8",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,l.jsx)(_.A,{className:"h-8 w-8 text-red-500"})}),(0,l.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"查詢遇到問題"}),(0,l.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6 max-w-md mx-auto",children:(0,l.jsx)("p",{className:"text-red-700 text-sm",children:t})}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,l.jsx)("button",{onClick:n,className:"px-6 py-3 bg-gray-900 hover:bg-gray-800 text-white font-medium rounded-lg transition-colors",children:"重新查詢"}),(0,l.jsx)("button",{onClick:r,className:"px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg transition-colors",children:"清除錯誤"})]})]})})})},P={"1d":{name:"日線",table:"stock_data_1d"},"1h":{name:"時線",table:"stock_data_1h"}},U=(e,t,n)=>{let[l,a]=(0,r.useState)([]),[i,o]=(0,r.useState)(!1),[s,c]=(0,r.useState)(null),d=(0,r.useRef)(e);(0,r.useEffect)(()=>{d.current=e},[e]);let m=(0,r.useMemo)(()=>({database:n}),[n]),h=(0,r.useCallback)(async()=>{if(!e.trim())return;o(!0),c(null);let l=P[t].table,r="\n      SELECT\n        symbol, datetime, open_price, high_price, low_price, close_price, volume,\n        rsi_5, rsi_7, rsi_10, rsi_14, rsi_21,\n        dif, macd, macd_histogram,\n        rsv, k_value, d_value, j_value,\n        ma5, ma10, ma20, ma60, ema12, ema26,\n        bb_upper, bb_middle, bb_lower,\n        atr, cci, willr, mom\n      FROM [".concat(n,"].[dbo].[").concat(l,"]\n      WHERE symbol = @symbol\n      ORDER BY datetime DESC\n    ");try{let t=await fetch("/api/database/execute-query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:m,query:r.trim(),params:{symbol:e.toUpperCase()}})});if(d.current!==e)return;if(!t.ok)throw Error("查詢失敗: ".concat(t.status));let n=await t.json();if(n.success)a(n.data||[]),n.data&&0!==n.data.length||c("查無資料");else throw a([]),Error(n.error||"查詢失敗")}catch(t){if(d.current!==e)return;a([]),c(t instanceof Error?t.message:"未知錯誤")}finally{d.current===e&&o(!1)}},[e,t,n,m]),u=(0,r.useMemo)(()=>l.length?l.slice().reverse().filter(e=>void 0!==e.open_price&&void 0!==e.high_price&&void 0!==e.low_price&&void 0!==e.close_price&&e.datetime).map(e=>({date:e.datetime,open:Number(e.open_price),high:Number(e.high_price),low:Number(e.low_price),close:Number(e.close_price),volume:e.volume?Number(e.volume):void 0})):[],[l]),g=(0,r.useMemo)(()=>{if(!l.length)return;let e=l.slice().reverse(),t={};return["rsi_5","rsi_7","rsi_10","rsi_14","rsi_21","dif","macd","macd_histogram","k_value","d_value","j_value","ma5","ma10","ma20","ma60","ema12","ema26","bb_upper","bb_middle","bb_lower","atr","cci","willr","mom"].forEach(n=>{let l=e.map(e=>{let t=e[n];return null==t||isNaN(Number(t))?null:Number(t)}).filter(e=>null!==e);l.length>0&&(t[n]=l)}),t},[l]),x=(0,r.useMemo)(()=>{if(!u.length||!l.length)return null;let e=u[u.length-1],t=l[0],n=u.length>1?u[u.length-2]:e,r=e.close-n.close,a=r/n.close*100;return{latest:e.close,change:r,changePercent:a,isRising:r>=0,high:e.high,low:e.low,volume:e.volume,open_price:e.open,open:e.open,datetime:(null==t?void 0:t.datetime)||e.date}},[u,l]),p=(0,r.useCallback)(()=>{h()},[h]),y=(0,r.useCallback)(()=>{c(null)},[]);return(0,r.useEffect)(()=>{h()},[h]),(0,r.useEffect)(()=>{a([]),c(null)},[e,t]),{data:l,loading:i,error:s,stats:x,candlestickData:u,technicalData:g,refetch:p,clearError:y}};var W=n(2418);let V=e=>Array.isArray(e)&&e.length>0?e[e.length-1]:void 0,z=e=>"number"!=typeof e?{tag:"-",tagColor:"bg-gray-100 text-gray-400",signal:"-",signalColor:"text-gray-400"}:e>70?{tag:"超買",tagColor:"bg-orange-200 text-orange-700",signal:"偏空",signalColor:"text-red-500"}:e>60?{tag:"接近超買",tagColor:"bg-yellow-200 text-yellow-800",signal:"中性",signalColor:"text-gray-400"}:e<30?{tag:"超賣",tagColor:"bg-blue-200 text-blue-700",signal:"偏多",signalColor:"text-green-500"}:e<40?{tag:"接近超賣",tagColor:"bg-gray-100 text-gray-400",signal:"中性",signalColor:"text-gray-400"}:{tag:"正常",tagColor:"bg-gray-100 text-gray-400",signal:"中性",signalColor:"text-gray-400"},K=e=>"number"!=typeof e?{tag:"-",tagColor:"bg-gray-100 text-gray-400",signal:"-",signalColor:"text-gray-400"}:e>0?{tag:"看漲信號",tagColor:"bg-green-100 text-green-700",signal:"偏多",signalColor:"text-green-500"}:e<0?{tag:"看跌信號",tagColor:"bg-red-100 text-red-700",signal:"偏空",signalColor:"text-red-500"}:{tag:"無信號",tagColor:"bg-gray-100 text-gray-400",signal:"中性",signalColor:"text-gray-400"},B=e=>{let{technicalData:t,symbol:n,timeframe:a,open_price:i,high_price:o,low_price:s,close_price:c,volume:d,loading:m=!1,candlestickData:h}=e;if(m)return(0,l.jsx)("div",{className:"bg-white rounded-lg p-4 shadow text-gray-500 text-center mt-2 animate-pulse",children:"技術指標載入中..."});if(!t||0===Object.keys(t).length)return(0,l.jsx)("div",{className:"bg-white rounded-lg p-4 shadow text-gray-500 text-center mt-2",children:"無技術指標資料"});let u=(0,r.useMemo)(()=>({RSI:()=>V(t.rsi_14),MACD:()=>V(t.macd),DIF:()=>V(t.dif),DEA:()=>{let e=V(t.dif),n=V(t.macd_histogram);return void 0!==e&&void 0!==n?e-n:void 0},MACDHist:()=>V(t.macd_histogram),K:()=>V(t.k_value),D:()=>V(t.d_value),J:()=>V(t.j_value),MA5:()=>V(t.ma5),MA10:()=>V(t.ma10),MA20:()=>V(t.ma20),MA60:()=>V(t.ma60),BollUpper:()=>V(t.bb_upper),BollMiddle:()=>V(t.bb_middle),BollLower:()=>V(t.bb_lower),Close:()=>"number"==typeof c?c:void 0,Volume:()=>"number"==typeof d?d:void 0,AvgVol:()=>{if(Array.isArray(h)&&h.length>0){let e=h.map(e=>e.volume).filter(e=>"number"==typeof e);if(e.length>=20)return e.slice(-20).reduce((e,t)=>e+t,0)/20}},VolRatio:()=>{if(Array.isArray(h)&&h.length>0){let e=h.map(e=>e.volume).filter(e=>"number"==typeof e),t=e.length>0?e[e.length-1]:void 0,n=e.length>=20?e.slice(-20).reduce((e,t)=>e+t,0)/20:void 0;if("number"==typeof t&&"number"==typeof n&&0!==n)return t/n}},WILLR:()=>V(t.willr),ATR:()=>V(t.atr),CCI:()=>V(t.cci),MOM:()=>V(t.mom),Support:()=>{let e;if(Array.isArray(h)&&h.length>0){let e=h.map(e=>e.low).filter(e=>"number"==typeof e);if(e.length>0)return Math.min(...e.slice(-20))}for(let n of["low","lows","low_price","Low","lowPrices"])if(Array.isArray(t[n])){e=t[n];break}if(e&&0!==e.length)return Math.min(...e.slice(-20))},Resistance:()=>{let e;if(Array.isArray(h)&&h.length>0){let e=h.map(e=>e.high).filter(e=>"number"==typeof e);if(e.length>0)return Math.max(...e.slice(-20))}for(let n of["high","highs","high_price","High","highPrices"])if(Array.isArray(t[n])){e=t[n];break}if(e&&0!==e.length)return Math.max(...e.slice(-20))}}),[t,c,h]),g=(0,r.useMemo)(()=>{let e=u.RSI(),n=u.MACD(),l=u.DIF(),r=u.DEA(),a=u.MACDHist(),i=u.K(),o=u.D(),s=u.J(),c=u.MA5(),d=u.MA10(),m=u.MA20(),h=u.MA60(),g=u.BollUpper(),x=u.BollMiddle(),p=u.BollLower(),y=u.Close(),b=u.WILLR(),f=u.ATR(),v=u.CCI(),N=u.MOM();return u.Support(),u.Resistance(),[{key:"RSI",title:"RSI (14)",value:"number"==typeof e?F(e,2):"-",valueUnit:"",...z(e),desc:"標準區間: 30-70 \n 超買線: 70+ | 超賣線: 30-"},{key:"MACD",title:"MACD",value:"number"==typeof n?F(n,2):"-",valueUnit:"",...K(n),desc:"DIF: ".concat("number"==typeof l?F(l,1):"-"," | DEA: ").concat("number"==typeof r?F(r,1):"-","\n柱狀圖: ").concat("number"==typeof a?F(a,1):"-")},{key:"KD",title:"KD指標",value:"number"==typeof i&&"number"==typeof o?"K:".concat(F(i,0)," D:").concat(F(o,0)):"-",valueUnit:"",tag:"number"==typeof i&&"number"==typeof o?i>80&&o>80?"超買":i<20&&o<20?"超賣":i>o?"黃金交叉":"死亡交叉":"-",tagColor:"number"==typeof i&&"number"==typeof o?i>80&&o>80?"bg-orange-100 text-orange-700":i<20&&o<20?"bg-blue-100 text-blue-700":i>o?"bg-green-100 text-green-700":"bg-red-100 text-red-700":"bg-gray-100 text-gray-400",signal:"number"==typeof i&&"number"==typeof o?i>o?"偏多":"偏空":"中性",signalColor:"number"==typeof i&&"number"==typeof o?i>o?"text-green-500":"text-red-500":"text-gray-400",desc:"K值: ".concat("number"==typeof i?F(i,1):"-"," | D值: ").concat("number"==typeof o?F(o,1):"-"," \nJ值: ").concat("number"==typeof s?F(s,1):"-")},{key:"MA20",title:"移動平均線 (20日)",value:"number"==typeof m?F(m,2):"-",valueUnit:"",tag:"number"==typeof m&&"number"==typeof h&&m>h?"站上均線":"number"==typeof m&&"number"==typeof h&&m<h?"跌破均線":"number"==typeof m&&"number"==typeof h?"無信號":"-",tagColor:"number"==typeof m&&"number"==typeof h&&m>h?"bg-green-100 text-green-700":"number"==typeof m&&"number"==typeof h&&m<h?"bg-red-100 text-red-700":"bg-gray-100 text-gray-400",signal:"number"==typeof m&&"number"==typeof h?m>h?"偏多":"偏空":"中性",signalColor:"number"==typeof m&&"number"==typeof h?m>h?"text-green-500":"text-red-500":"text-gray-400",desc:"5日: ".concat("number"==typeof c?F(c,0):"-"," | 10日: ").concat("number"==typeof d?F(d,0):"-","\n60日: ").concat("number"==typeof h?F(h,0):"-")},{key:"BOLL",title:"布林通道",value:"number"==typeof g&&"number"==typeof x&&"number"==typeof p?"上軌: ".concat(F(g,2)):"-",valueUnit:"",tag:(()=>{if("number"!=typeof y||"number"!=typeof g||"number"!=typeof p||"number"!=typeof x)return"-";let e=g-p;if(0===e)return"頻道收斂";if(e<0)return"資料異常";let t=Math.abs(y-g)/e,n=Math.abs(y-p)/e;return y>g?"突破上軌":y<p?"跌破下軌":t<.02?"靠近上軌":n<.02?"靠近下軌":y>x?"站上中軌":y<x?"跌破中軌":"區間內"})(),tagColor:(()=>{if("number"!=typeof y||"number"!=typeof g||"number"!=typeof p||"number"!=typeof x)return"bg-gray-100 text-gray-400";let e=g-p;return 0===e?"bg-yellow-100 text-yellow-700":y>g?"bg-orange-200 text-orange-700":y<p?"bg-blue-200 text-blue-700":Math.abs(y-g)/e<.02?"bg-orange-100 text-orange-700":Math.abs(y-p)/e<.02?"bg-blue-100 text-blue-700":y>x?"bg-green-100 text-green-700":y<x?"bg-red-100 text-red-700":"bg-gray-100 text-gray-400"})(),signal:(()=>{if("number"!=typeof y||"number"!=typeof g||"number"!=typeof p||"number"!=typeof x)return"-";let e=g-p;return 0===e?"觀望":y>g?"偏多":y<p?"偏空":Math.abs(y-g)/e<.02?"偏多":Math.abs(y-p)/e<.02?"偏空":y>x?"偏多":y<x?"偏空":"中性"})(),signalColor:(()=>{if("number"!=typeof y||"number"!=typeof g||"number"!=typeof p||"number"!=typeof x)return"text-gray-400";let e=g-p;return 0===e?"text-yellow-500":y>g?"text-orange-500":y<p?"text-blue-500":Math.abs(y-g)/e<.02?"text-orange-400":Math.abs(y-p)/e<.02?"text-blue-400":y>x?"text-green-500":y<x?"text-red-500":"text-gray-400"})(),desc:(()=>{if("number"!=typeof g||"number"!=typeof x||"number"!=typeof p)return"-";let e=g-p,t=e>=0?F(e,2):"-",n=e<2?"收斂":e>10?"擴張":"正常";return"中軌: ".concat(F(x,2)," | 下軌: ").concat(F(p,2),"\n頻道寬度: ").concat(t," (").concat(n,")")})()},{key:"WILLR",title:"威廉指標 (W%R)",value:"number"==typeof b?F(b,2):"-",valueUnit:"",tag:"number"!=typeof b?"-":b<-80?"超賣":b>-20?"超買":"正常",tagColor:"number"!=typeof b?"bg-gray-100 text-gray-400":b<-80?"bg-blue-100 text-blue-700":b>-20?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-400",signal:"number"!=typeof b?"-":b<-80?"偏多":b>-20?"偏空":"中性",signalColor:"number"!=typeof b?"text-gray-400":b<-80?"text-green-500":b>-20?"text-red-500":"text-gray-400",desc:"超賣區: -80以下 \n 超買區: -20以上"},{key:"ATR",title:"ATR (平均真實波幅)",value:"number"==typeof f?F(f,2):"-",valueUnit:"",tag:"number"!=typeof f?"-":f>2?"波動大":f<1?"波動小":"正常",tagColor:"number"!=typeof f?"bg-gray-100 text-gray-400":f>2?"bg-orange-100 text-orange-700":f<1?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-400",signal:"number"!=typeof f?"-":f>2?"高波動":f<1?"低波動":"中性",signalColor:"number"!=typeof f?"text-gray-400":f>2?"text-orange-500":f<1?"text-blue-500":"text-gray-400",desc:"ATR數值越大代表波動越大 \n 常用於風險管理。"},{key:"CCI",title:"CCI (順勢指標)",value:"number"==typeof v?F(v,2):"-",valueUnit:"",tag:"number"!=typeof v?"-":v>100?"超買":v<-100?"超賣":"正常",tagColor:"number"!=typeof v?"bg-gray-100 text-gray-400":v>100?"bg-orange-100 text-orange-700":v<-100?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-400",signal:"number"!=typeof v?"-":v>100?"偏空":v<-100?"偏多":"中性",signalColor:"number"!=typeof v?"text-gray-400":v>100?"text-red-500":v<-100?"text-green-500":"text-gray-400",desc:"CCI>100超買，<-100超賣 \n 常用於判斷趨勢強弱。"},{key:"MOM",title:"MOM (動量指標)",value:"number"==typeof N?F(N,2):"-",valueUnit:"",tag:"number"!=typeof N?"-":N>0?"動能上升":N<0?"動能下降":"持平",tagColor:"number"!=typeof N?"bg-gray-100 text-gray-400":N>0?"bg-green-100 text-green-700":N<0?"bg-red-100 text-red-700":"bg-gray-100 text-gray-400",signal:"number"!=typeof N?"-":N>0?"偏多":N<0?"偏空":"中性",signalColor:"number"!=typeof N?"text-gray-400":N>0?"text-green-500":N<0?"text-red-500":"text-gray-400",desc:"動量>0為上升趨勢，<0為下降趨勢 \n 常用於捕捉趨勢轉折。"},{key:"EMA26",title:"EMA (26日)",value:(()=>{let e=V(t.ema26);return"number"==typeof e?F(e,2):"-"})(),valueUnit:"",tag:(()=>{let e=V(t.ema26),n=u.Close();return"number"!=typeof e||"number"!=typeof n?"-":n>e?"站上EMA26":n<e?"跌破EMA26":"持平"})(),tagColor:(()=>{let e=V(t.ema26),n=u.Close();return"number"!=typeof e||"number"!=typeof n?"bg-gray-100 text-gray-400":n>e?"bg-green-100 text-green-700":n<e?"bg-red-100 text-red-700":"bg-gray-100 text-gray-400"})(),signal:(()=>{let e=V(t.ema26),n=u.Close();return"number"!=typeof e||"number"!=typeof n?"-":n>e?"偏多":n<e?"偏空":"中性"})(),signalColor:(()=>{let e=V(t.ema26),n=u.Close();return"number"!=typeof e||"number"!=typeof n?"text-gray-400":n>e?"text-green-500":n<e?"text-red-500":"text-gray-400"})(),desc:"EMA26加權移動平均線 \n 常用於確認趨勢方向。"},{key:"Support",title:"支撐位 (近20日低點)",value:(()=>{let e=u.Support();return"number"==typeof e?F(e,2):"-"})(),valueUnit:"",tag:"支撐",tagColor:"bg-blue-100 text-blue-700",signal:"",signalColor:"text-blue-500",desc:"近20日最低價 \n 常用於判斷下檔支撐區。"},{key:"Resistance",title:"阻力位 (近20日高點)",value:(()=>{let e=u.Resistance();return"number"==typeof e?F(e,2):"-"})(),valueUnit:"",tag:"阻力",tagColor:"bg-orange-100 text-orange-700",signal:"",signalColor:"text-orange-500",desc:"近20日最高價 \n 常用於判斷上檔壓力區。"},{key:"Volume",title:"成交量",value:(()=>{let e=u.Volume();return"number"==typeof e?Z(e):"-"})(),valueUnit:"",tag:(()=>{let e=u.VolRatio();return"number"!=typeof e?"-":e>1.5?"爆量":e<.7?"量縮":"正常"})(),tagColor:(()=>{let e=u.VolRatio();return"number"!=typeof e?"bg-gray-100 text-gray-400":e>1.5?"bg-orange-100 text-orange-700":e<.7?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-400"})(),signal:(()=>{let e=u.VolRatio();return"number"!=typeof e?"-":e>1.5?"偏多":e<.7?"偏空":"中性"})(),signalColor:(()=>{let e=u.VolRatio();return"number"!=typeof e?"text-gray-400":e>1.5?"text-orange-500":e<.7?"text-blue-500":"text-gray-400"})(),desc:(()=>{let e=u.AvgVol(),t=u.VolRatio();return"20日均量: ".concat("number"==typeof e?Z(e):"-","\n量能比: ").concat("number"==typeof t?F(t,2):"-")})()}]},[u]),x=[],p=0;for(;p<g.length;)if(g.length-p==4){x.push(g.slice(p,p+4));break}else x.push(g.slice(p,p+3)),p+=3;return(0,l.jsxs)("div",{className:"flex flex-col gap-4 mt-4",children:[(0,l.jsxs)("div",{className:"flex items-center text-xl font-semibold text-gray-800 mt-2 mb-2",children:[(0,l.jsx)(f.A,{className:"inline-block w-6 h-6 mr-1 text-gray-500"}),n," 技術分析 -"," ","1d"===a?"日線":"1h"===a?"小時線":"",(0,l.jsx)("span",{className:"text-gray-400 text-sm font-normal ml-2",children:"- Sparkline only shows last 20 data points."})]}),x.map((e,n)=>(0,l.jsx)("div",{className:3===n?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2":"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(e=>(0,l.jsxs)("div",{className:"bg-white rounded-2xl p-5 shadow-lg hover:shadow-2xl transition-shadow duration-200 border border-gray-100 flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsxs)("div",{className:"text-xs font-semibold uppercase text-gray-500 tracking-wider",children:[e.title," ","1d"===a?"(日線)":"1h"===a?"(小時線)":"",(0,l.jsx)("span",{className:"ml-3 text-xs ".concat(e.signalColor," font-bold"),children:e.signal})]}),(0,l.jsx)("div",{className:"px-2.5 py-0.5 rounded-full text-xs font-semibold flex items-center ".concat(e.tagColor),children:e.tag})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2 w-full",children:[(0,l.jsxs)("div",{className:"flex items-baseline",children:[(0,l.jsx)("span",{className:"text-2xl font-extrabold text-gray-800",children:e.value}),e.valueUnit&&(0,l.jsx)("span",{className:"text-sm font-medium text-gray-400 ml-1",children:e.valueUnit})]}),(0,l.jsx)("div",{className:"h-8 w-32 flex-shrink-0 flex items-center justify-end",children:(0,l.jsx)(W.Sparklines,{data:(()=>{if("Support"===e.key&&Array.isArray(h))return h.map(e=>e.low).filter(e=>"number"==typeof e).slice(-20);if("Resistance"===e.key&&Array.isArray(h))return h.map(e=>e.high).filter(e=>"number"==typeof e).slice(-20);if("Volume"===e.key&&Array.isArray(h))return h.map(e=>e.volume).filter(e=>"number"==typeof e).slice(-20);let n={RSI:"rsi_14",MACD:"macd",KD:"k_value",MA20:"ma20",BOLL:"bb_middle",WILLR:"willr",ATR:"atr",CCI:"cci",MOM:"mom",EMA26:"ema26"}[e.key];return n&&t&&Array.isArray(t[n])?t[n].slice(-20):[]})(),svgHeight:32,svgWidth:120,children:(0,l.jsx)(W.SparklinesLine,{color:"text-green-500"===e.signalColor?"green":"text-red-500"===e.signalColor?"red":"text-blue-500"===e.signalColor||"text-blue-400"===e.signalColor?"blue":"text-purple-500"===e.signalColor?"purple":"text-orange-500"===e.signalColor?"orange":"text-yellow-500"===e.signalColor?"yellow":"gray",style:{fill:"none"}})})})]}),(0,l.jsx)("div",{className:"text-xs text-gray-500 whitespace-pre-line line-clamp-2",children:e.desc})]},e.key))},n))]})},F=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"number"!=typeof e||isNaN(e)?"-":e.toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t})},Z=e=>"number"!=typeof e||isNaN(e)?"-":e>=1e9?(e/1e9).toLocaleString("en-US",{maximumFractionDigits:3})+"B":e>=1e6?(e/1e6).toLocaleString("en-US",{maximumFractionDigits:3})+"M":e>=1e3?(e/1e3).toLocaleString("en-US",{maximumFractionDigits:3})+"K":e.toLocaleString("en-US");var H=function(e){return e.WEAK="weak",e.MODERATE="moderate",e.STRONG="strong",e.VERY_STRONG="very_strong",e}({}),G=function(e){return e.REVERSAL="reversal",e.CONTINUATION="continuation",e.INDECISION="indecision",e.BREAKOUT="breakout",e}({}),Y=function(e){return e.UPTREND="uptrend",e.DOWNTREND="downtrend",e.SIDEWAYS="sideways",e.UNKNOWN="unknown",e}({});let $={smallBodyRatio:.25,largeBodyRatio:.7,shadowRatio:2,dojiBodyRatio:.08,volumeThreshold:1.5,trendPeriod:10,trendThreshold:.02,extremeZoneRatio:.03,minPatternConfidence:.7};class J{static standardDeviation(e){if(0===e.length)return 0;let t=e.reduce((e,t)=>e+t,0)/e.length;return Math.sqrt(e.reduce((e,n)=>e+Math.pow(n-t,2),0)/e.length)}static coefficientOfVariation(e){let t=e.reduce((e,t)=>e+t,0)/e.length,n=this.standardDeviation(e);return 0===t?0:n/Math.abs(t)}static movingAverage(e,t){if(e.length<t)return[];let n=[];for(let l=t-1;l<e.length;l++){let r=e.slice(l-t+1,l+1).reduce((e,t)=>e+t,0);n.push(r/t)}return n}static exponentialMovingAverage(e,t){if(0===e.length)return[];let n=2/(t+1),l=[e[0]];for(let t=1;t<e.length;t++)l.push(e[t]*n+l[t-1]*(1-n));return l}static pearsonCorrelation(e,t){if(e.length!==t.length||0===e.length)return 0;let n=e.length,l=e.reduce((e,t)=>e+t,0),r=t.reduce((e,t)=>e+t,0),a=e.reduce((e,n,l)=>e+n*t[l],0),i=e.reduce((e,t)=>e+t*t,0),o=Math.sqrt((n*i-l*l)*(n*t.reduce((e,t)=>e+t*t,0)-r*r));return 0===o?0:(n*a-l*r)/o}}let q=e=>Math.abs(e.close-e.open),X=e=>e.high-Math.max(e.open,e.close),Q=e=>Math.min(e.open,e.close)-e.low,ee=e=>e.high-e.low,et=e=>e.close<e.open,en=e=>e.close>e.open,el=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$;return q(e)>ee(e)*t.largeBodyRatio},er=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$;return q(e)<ee(e)*t.smallBodyRatio},ea=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$,n=q(e),l=ee(e);return n<l*t.dojiBodyRatio&&l>0},ei=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$,n=q(e);return X(e)>=n*t.shadowRatio},eo=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$,n=q(e);return Q(e)>=n*t.shadowRatio},es=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t=q(e);return X(e)<=.3*t},ec=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t=q(e);return Q(e)<=.3*t},ed=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$;if(!e.volume||0===t.length)return!1;let l=t.slice(-n.trendPeriod).map(e=>e.volume||0).filter(e=>e>0);if(0===l.length)return!1;let r=l.reduce((e,t)=>e+t,0)/l.length;return e.volume>r*n.volumeThreshold},em=new Map,eh=(e,t,n,l)=>[e,"".concat(t.open,"-").concat(t.high,"-").concat(t.low,"-").concat(t.close),n?"".concat(n.open,"-").concat(n.high,"-").concat(n.low,"-").concat(n.close):"",l?"".concat(l.open,"-").concat(l.high,"-").concat(l.low,"-").concat(l.close):""].join("|"),eu=(e,t,n)=>{let l=Date.now();for(let[e,t]of em.entries())l-t.timestamp>3e5&&em.delete(e);if(em.size>=2e3){let e=em.keys().next().value;e&&em.delete(e)}return em.set(e,{result:t,timestamp:l,confidence:n}),t};class eg{static analyzeTrend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$;if(e.length<t)return"unknown";let l=e.slice(-t).map(e=>(e.high+e.low+e.close)/3),r=Array.from({length:l.length},(e,t)=>t),a=J.pearsonCorrelation(r,l);return Math.abs(a)<n.trendThreshold?"sideways":a>0?"uptrend":"downtrend"}static calculateTrendStrength(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(e.length<t)return 0;let n=e.slice(-t).map(e=>(e.high+e.low+e.close)/3),l=Array.from({length:n.length},(e,t)=>t);return Math.abs(J.pearsonCorrelation(l,n))}static findSupportResistance(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1],e.length<10)return{support:null,resistance:null};let t=e.map(e=>e.high),n=e.map(e=>e.low),l=ex.findLocalMaxima(e,3),r=ex.findLocalMinima(e,3),a=l.length>0?l[l.length-1].value:Math.max(...t);return{support:r.length>0?r[r.length-1].value:Math.min(...n),resistance:a}}static isInExtremeZone(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"high";if(t.length<n.trendPeriod)return!1;let r=t.slice(-n.trendPeriod),a="high"===l?r.map(e=>e.high):r.map(e=>e.low),i="high"===l?Math.max(...a):Math.min(...a),o="high"===l?e.high:e.low,s="high"===l?i*(1-n.extremeZoneRatio):i*(1+n.extremeZoneRatio);return"high"===l?o>s:o<s}}let ex={getBodySize:q,getUpperShadow:X,getLowerShadow:Q,getTotalRange:ee,isRed:et,isGreen:en,isBig:el,isSmall:er,isDoji:ea,hasLongUpperShadow:ei,hasLongLowerShadow:eo,hasShortUpperShadow:es,hasShortLowerShadow:ec,isVolumeExpansion:ed,checkPatternWithCache:(e,t,n,l,r)=>{let a=eh(e,n,l,r),i=em.get(a);if(void 0!==i){if(Date.now()-i.timestamp<=3e5)return i.result;em.delete(a)}return eu(a,t())},clearPatternCache:()=>em.clear(),getCacheSize:()=>em.size,createMarketContext:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$;if(0===e.length)return{trend:"unknown",volatility:0,volume:0,support:null,resistance:null};let n=e[e.length-1],l=eg.analyzeTrend(e,t.trendPeriod,t),r=e.slice(-t.trendPeriod).map(e=>(e.high+e.low+e.close)/3),a=J.standardDeviation(r),{support:i,resistance:o}=eg.findSupportResistance(e);return{trend:l,volatility:a,volume:n.volume||0,support:i,resistance:o}},calculateSlope:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e)||e.length<2)return 0;let t=e.map(e=>(e.high+e.low+e.close)/3),n=Array.from({length:t.length},(e,t)=>t);return J.pearsonCorrelation(n,t)},calculateTrend:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(!Array.isArray(e)||e.length<3)return 0;let n=e.map(e=>"high"===t?e.high:e.low),l=Array.from({length:n.length},(e,t)=>t);return J.pearsonCorrelation(l,n)},isConsolidating:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.05;if(!Array.isArray(e)||e.length<3)return!1;let n=e.map(e=>(e.high+e.low+e.close)/3);return J.coefficientOfVariation(n)<t},hasVolumeDecrease:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e)||e.length<6)return!1;let t=e.map(e=>e.volume||0).filter(e=>e>0);if(t.length<4)return!1;let n=Math.floor(t.length/2),l=t.slice(0,n),r=t.slice(n),a=l.reduce((e,t)=>e+t,0)/l.length;return r.reduce((e,t)=>e+t,0)/r.length<.8*a},findLocalMinima:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!Array.isArray(e)||e.length<2*t+1)return[];let n=[];for(let l=t;l<e.length-t;l++){let r=e[l].low,a=!0;for(let n=l-t;n<=l+t;n++)if(n!==l&&e[n].low<=r){a=!1;break}a&&n.push({index:l,value:r})}return n},findLocalMaxima:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!Array.isArray(e)||e.length<2*t+1)return[];let n=[];for(let l=t;l<e.length-t;l++){let r=e[l].high,a=!0;for(let n=l-t;n<=l+t;n++)if(n!==l&&e[n].high>=r){a=!1;break}a&&n.push({index:l,value:r})}return n},isDoublePattern:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.03;if(!Array.isArray(e)||e.length<2)return!1;let[n,l]=e.slice(-2),r=Math.abs(n.value-l.value)/Math.min(n.value,l.value),a=l.index-n.index;return r<t&&a>=5&&a<=25},isHeadAndShoulders:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e)||e.length<3)return!1;let[t,n,l]=e.slice(-3),r=n.value>t.value&&n.value>l.value,a=Math.abs(t.value-l.value)/Math.min(t.value,l.value)<.05,i=n.index-t.index>=3&&l.index-n.index>=3;return r&&a&&i},isInverseHeadAndShoulders:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e)||e.length<3)return!1;let[t,n,l]=e.slice(-3),r=n.value<t.value&&n.value<l.value,a=Math.abs(t.value-l.value)/Math.max(t.value,l.value)<.05,i=n.index-t.index>=3&&l.index-n.index>=3;return r&&a&&i},validatePattern:function(e,t,n,l,r){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:$,i=[],o=0;if(!e.check(t,n,l,r,a))return{isValid:!1,confidence:0,reasons:["基本型態條件不滿足"]};if(o+=.4,i.push("基本型態條件滿足"),r&&ed(t,r,a)&&(o+=.2,i.push("成交量放大")),r&&r.length>a.trendPeriod){let t=ex.createMarketContext(r,a);"reversal"===e.type&&eg.calculateTrendStrength(r,a.trendPeriod)>.5&&(o+=.2,i.push("強趨勢中的反轉型態")),(null!==t.support||null!==t.resistance)&&(o+=.1,i.push("位於關鍵支撐/阻力位"))}return e.confidence&&(o=Math.max(o,e.confidence(t,n,l,r,a))),{isValid:o>=a.minPatternConfidence,confidence:Math.min(o,1),reasons:i}}},ep=[{name:"十字星",enName:"Doji",type:G.INDECISION,strength:H.MODERATE,bullish:null,description:"開盤價與收盤價幾乎相等，表示買賣雙方力量均衡",detail:"十字星代表市場猶豫不決，通常出現在趨勢轉換點。在上升趨勢中可能預示頂部，在下降趨勢中可能預示底部。",riskLevel:"medium",marketConditions:["trending","volatile"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;return arguments.length>5&&arguments[5],!!ea(e,r)&&(!l||!(l.length>=r.trendPeriod)||eg.isInExtremeZone(e,l,r,"high")||eg.isInExtremeZone(e,l,r,"low"))},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=.5,i=q(e),o=ee(e),s=i/o;return s<.5*r.dojiBodyRatio?a+=.3:s<r.dojiBodyRatio&&(a+=.2),Math.abs(X(e)-Q(e))/o<.2&&(a+=.2),l&&ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"錘子線",enName:"Hammer",type:G.REVERSAL,strength:H.STRONG,bullish:!0,description:"小實體配上長下影線，通常出現在下降趨勢末期",detail:"錘子線表示賣方力量衰竭，買方開始介入。下影線長度至少是實體的兩倍，且上影線很短或沒有。",riskLevel:"low",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;return!!eo(e,r)&&!!es(e,r)&&!(q(e)>ee(e)*r.smallBodyRatio*1.2)&&(!a||a.trend===Y.DOWNTREND||a.trend===Y.UNKNOWN)&&(!l||!(l.length>=r.trendPeriod)||eg.isInExtremeZone(e,l,r,"low"))},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=.6,i=q(e),o=Q(e),s=X(e),c=o/i;return c>4?a+=.2:c>3?a+=.15:c>2.5&&(a+=.1),s<.2*i&&(a+=.1),l&&l.length>=5&&eg.analyzeTrend(l,5,r)===Y.DOWNTREND&&(a+=.15),l&&ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"上吊線",enName:"Hanging Man",type:G.REVERSAL,strength:H.MODERATE,bullish:!1,description:"小實體配上長下影線，出現在上升趨勢中",detail:"上吊線與錘子線形狀相似，但出現在上升趨勢中，暗示可能的頂部反轉。需要後續K線確認。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;return!!eo(e,r)&&!!es(e,r)&&!(q(e)>ee(e)*r.smallBodyRatio*1.2)&&(!a||a.trend===Y.UPTREND)&&(!l||!(l.length>=r.trendPeriod)||eg.isInExtremeZone(e,l,r,"high"))},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=.5,i=q(e),o=Q(e),s=X(e),c=o/i;return c>4?a+=.15:c>3?a+=.1:c>2.5&&(a+=.05),s<.2*i&&(a+=.1),l&&l.length>=5&&eg.analyzeTrend(l,5,r)===Y.UPTREND&&(a+=.15),et(e)&&(a+=.05),l&&ed(e,l,r)&&(a+=.15),Math.min(a,1)}},{name:"射擊之星",enName:"Shooting Star",type:G.REVERSAL,strength:H.MODERATE,bullish:!1,description:"小實體配上長上影線，出現在上升趨勢頂部",detail:"射擊之星表示多方推高後遇到阻力，空方力量增強。上影線長度至少是實體的兩倍。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;return!!ei(e,r)&&!!ec(e,r)&&!(q(e)>ee(e)*r.smallBodyRatio*1.2)&&(!a||a.trend===Y.UPTREND)&&(!l||!(l.length>=r.trendPeriod)||eg.isInExtremeZone(e,l,r,"high"))},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=.5,i=q(e),o=X(e),s=Q(e),c=o/i;return c>4?a+=.15:c>3?a+=.1:c>2.5&&(a+=.05),s<.2*i&&(a+=.1),l&&l.length>=5&&eg.analyzeTrend(l,5,r)===Y.UPTREND&&(a+=.15),et(e)&&(a+=.05),l&&ed(e,l,r)&&(a+=.15),Math.min(a,1)}},{name:"倒錘子線",enName:"Inverted Hammer",type:G.REVERSAL,strength:H.MODERATE,bullish:!0,description:"小實體配上長上影線，出現在下降趨勢底部",detail:"倒錘子線顯示空方力量減弱，雖然多方未能完全控制，但已顯示反彈跡象。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;return!!ei(e,r)&&!!ec(e,r)&&!(q(e)>ee(e)*r.smallBodyRatio*1.2)&&(!a||a.trend===Y.DOWNTREND||a.trend===Y.UNKNOWN)&&(!l||!(l.length>=r.trendPeriod)||eg.isInExtremeZone(e,l,r,"low"))},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=.4,i=q(e),o=X(e)/i;return o>4?a+=.15:o>3?a+=.1:o>2.5&&(a+=.05),l&&l.length>=5&&eg.analyzeTrend(l,5,r)===Y.DOWNTREND&&(a+=.2),en(e)&&(a+=.05),t&&en(t)&&t.close>e.close&&(a+=.2),l&&ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"大陽線",enName:"Big Green Candle",type:G.CONTINUATION,strength:H.STRONG,bullish:!0,description:"實體很大的陽線，表示強烈的看漲情緒",detail:"大陽線代表買方力量強勁，推動價格大幅上漲。通常預示上升趨勢將繼續。",riskLevel:"low",marketConditions:["trending","volatile"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(arguments.length>5&&arguments[5],!en(e))return!1;let a=q(e),i=ee(e),o=X(e),s=Q(e);return!(a/i<r.largeBodyRatio)&&!((o+s)/i>.3)&&(!l||!!ed(e,l,r))},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=.7,i=q(e)/ee(e);return i>.9?a+=.2:i>.8&&(a+=.1),t&&en(t)&&(a+=.05),l&&l.length>=5&&eg.analyzeTrend(l,5,r)===Y.UPTREND&&(a+=.1),Math.min(a,1)}},{name:"大陰線",enName:"Big Red Candle",type:G.CONTINUATION,strength:H.STRONG,bullish:!1,description:"實體很大的陰線，表示強烈的看跌情緒",detail:"大陰線代表賣方力量強勁，推動價格大幅下跌。通常預示下降趨勢將繼續。",riskLevel:"low",marketConditions:["trending","volatile"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(arguments.length>5&&arguments[5],!et(e))return!1;let a=q(e),i=ee(e),o=X(e),s=Q(e);return!(a/i<r.largeBodyRatio)&&!((o+s)/i>.3)&&(!l||!!ed(e,l,r))},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=.7,i=q(e)/ee(e);return i>.9?a+=.2:i>.8&&(a+=.1),t&&et(t)&&(a+=.05),l&&l.length>=5&&eg.analyzeTrend(l,5,r)===Y.DOWNTREND&&(a+=.1),Math.min(a,1)}},{name:"看漲吞噬",enName:"Bullish Engulfing",type:G.REVERSAL,strength:H.STRONG,bullish:!0,description:"大陽線完全包覆前一根陰線",detail:"看漲吞噬型態表示買方力量壓倒賣方，是強烈的反轉信號。",riskLevel:"low",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;return!!t&&!!et(t)&&!!en(e)&&!(e.open>=t.close)&&!(e.close<=t.open)&&!(q(e)<=1.1*q(t))&&(!a||a.trend!==Y.UPTREND)&&(!l||!(l.length>=r.trendPeriod)||eg.isInExtremeZone(e,l,r,"low"))},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!t)return 0;let a=.7,i=q(e)/q(t);return i>2?a+=.2:i>1.5&&(a+=.1),l&&l.length>=5&&eg.analyzeTrend(l.slice(0,-1),5,r)===Y.DOWNTREND&&(a+=.15),l&&ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"看跌吞噬",enName:"Bearish Engulfing",type:G.REVERSAL,strength:H.STRONG,bullish:!1,description:"大陰線完全包覆前一根陽線",detail:"看跌吞噬型態表示賣方力量壓倒買方，是強烈的反轉信號。",riskLevel:"low",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;return!!t&&!!en(t)&&!!et(e)&&!(e.open<=t.close)&&!(e.close>=t.open)&&!(q(e)<=1.1*q(t))&&(!a||a.trend!==Y.DOWNTREND)&&(!l||!(l.length>=r.trendPeriod)||eg.isInExtremeZone(e,l,r,"high"))},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!t)return 0;let a=.7,i=q(e)/q(t);return i>2?a+=.2:i>1.5&&(a+=.1),l&&l.length>=5&&eg.analyzeTrend(l.slice(0,-1),5,r)===Y.UPTREND&&(a+=.15),l&&ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"紡錘線",enName:"Spinning Top",type:G.INDECISION,strength:H.WEAK,bullish:null,description:"小實體配上上下影線，表示市場猶豫",detail:"紡錘線顯示買賣雙方力量相當，市場處於猶豫狀態。通常需要結合其他技術指標來判斷後續走勢。",riskLevel:"high",marketConditions:["ranging","volatile"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;arguments.length>5&&arguments[5];let a=q(e),i=X(e),o=Q(e),s=ee(e);return!(a>s*r.smallBodyRatio)&&!(i<a)&&!(o<a)&&!(s<=0)},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=.3,i=q(e),o=X(e),s=Q(e),c=ee(e),d=i/c;d<.1?a+=.2:d<.15&&(a+=.1);let m=Math.abs(o-s)/c;return m<.2?a+=.2:m<.3&&(a+=.1),l&&l.length>=r.trendPeriod&&(eg.isInExtremeZone(e,l,r,"high")||eg.isInExtremeZone(e,l,r,"low"))&&(a+=.2),Math.min(a,1)}}],ey=[{name:"早晨之星",enName:"Morning Star",type:G.REVERSAL,strength:H.STRONG,bullish:!0,description:"三根K線組成的看漲反轉型態",detail:"早晨之星由大陰線、小實體K線（通常是十字星）和大陽線組成。第三根陽線收盤價需要超過第一根陰線實體的中點。",riskLevel:"low",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;if(!t||!n)return!1;let i=et(n)&&el(n,r),o=er(t,r)||ea(t,r),s=en(e)&&q(e)>.6*q(n),c=(n.open+n.close)/2,d=e.close>c;t.high,n.low;let m=e.open>t.close||e.close>t.high;return(!a||a.trend===Y.DOWNTREND||a.trend===Y.UNKNOWN)&&(!l||!(l.length>=r.trendPeriod)||!!eg.isInExtremeZone(e,l,r,"low"))&&i&&o&&s&&d&&m},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!t||!n)return 0;let a=.7,i=(n.open+n.close)/2,o=(e.close-i)/q(n);return o>.6?a+=.15:o>.4&&(a+=.1),ea(t,r)&&(a+=.1),t.high<n.low&&(n.low-t.high)/n.close>.02&&(a+=.1),q(e)/ee(e)>.8&&(a+=.1),l&&l.length>=5&&eg.analyzeTrend(l.slice(0,-2),5,r)===Y.DOWNTREND&&(a+=.1),l&&ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"黃昏之星",enName:"Evening Star",type:G.REVERSAL,strength:H.STRONG,bullish:!1,description:"三根K線組成的看跌反轉型態",detail:"黃昏之星由大陽線、小實體K線（通常是十字星）和大陰線組成。第三根陰線收盤價需要低於第一根陽線實體的中點。",riskLevel:"low",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;if(!t||!n)return!1;let i=en(n)&&el(n,r),o=er(t,r)||ea(t,r),s=et(e)&&q(e)>.6*q(n),c=(n.open+n.close)/2,d=e.close<c;t.low,n.high;let m=e.open<t.close||e.close<t.low;return(!a||a.trend===Y.UPTREND)&&(!l||!(l.length>=r.trendPeriod)||!!eg.isInExtremeZone(e,l,r,"high"))&&i&&o&&s&&d&&m},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!t||!n)return 0;let a=.7,i=((n.open+n.close)/2-e.close)/q(n);return i>.6?a+=.15:i>.4&&(a+=.1),ea(t,r)&&(a+=.1),t.low>n.high&&(t.low-n.high)/n.close>.02&&(a+=.1),q(e)/ee(e)>.8&&(a+=.1),l&&l.length>=5&&eg.analyzeTrend(l.slice(0,-2),5,r)===Y.UPTREND&&(a+=.1),l&&ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"白色三兵",enName:"Three White Soldiers",type:G.REVERSAL,strength:H.STRONG,bullish:!0,description:"連續三根陽線，每根都比前一根收盤更高",detail:"白色三兵是強烈的看漲反轉信號，通常出現在下跌趨勢後。三根陽線連續上漲，每根的收盤價都比前一根高，且開盤價在前一根實體內。",riskLevel:"low",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;if(!t||!n||!(en(n)&&en(t)&&en(e))||!(n.close<t.close&&t.close<e.close)||!(!er(n,r)&&!er(t,r)&&!er(e,r)))return!1;let i=t.open>=Math.min(n.open,n.close)&&t.open<=Math.max(n.open,n.close),o=e.open>=Math.min(t.open,t.close)&&e.open<=Math.max(t.open,t.close),s=es(n,r)&&es(t,r)&&es(e,r);return(!a||a.trend!==Y.UPTREND)&&(!l||!(l.length>=r.trendPeriod)||!!eg.isInExtremeZone(n,l.slice(0,-2),r,"low"))&&i&&o&&s},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!t||!n)return 0;let a=.75,i=(e.close-n.open)/n.open;i>.06?a+=.1:i>.04&&(a+=.05);let o=q(n),s=q(t),c=q(e),d=(o+s+c)/3;a+=.1*(1-(Math.abs(o-d)+Math.abs(s-d)+Math.abs(c-d))/(3*d));let m=Math.abs(t.open-n.close)/n.close,h=Math.abs(e.open-t.close)/t.close;return m<.01&&h<.01&&(a+=.1),l&&l.length>=8&&eg.analyzeTrend(l.slice(0,-3),5,r)===Y.DOWNTREND&&(a+=.1),n.volume&&t.volume&&e.volume&&n.volume<t.volume&&t.volume<e.volume&&(a+=.1),Math.min(a,1)}},{name:"黑三鴉",enName:"Three Black Crows",type:G.REVERSAL,strength:H.STRONG,bullish:!1,description:"連續三根陰線，每根都比前一根收盤更低",detail:"黑三鴉是強烈的看跌反轉信號，通常出現在上升趨勢後。三根陰線連續下跌，每根的收盤價都比前一根低，且開盤價在前一根實體內。",riskLevel:"low",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;if(!t||!n||!(et(n)&&et(t)&&et(e))||!(n.close>t.close&&t.close>e.close)||!(!er(n,r)&&!er(t,r)&&!er(e,r)))return!1;let i=t.open>=Math.min(n.open,n.close)&&t.open<=Math.max(n.open,n.close),o=e.open>=Math.min(t.open,t.close)&&e.open<=Math.max(t.open,t.close),s=ec(n,r)&&ec(t,r)&&ec(e,r);return(!a||a.trend!==Y.DOWNTREND)&&(!l||!(l.length>=r.trendPeriod)||!!eg.isInExtremeZone(n,l.slice(0,-2),r,"high"))&&i&&o&&s},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!t||!n)return 0;let a=.75,i=(n.open-e.close)/n.open;i>.06?a+=.1:i>.04&&(a+=.05);let o=q(n),s=q(t),c=q(e),d=(o+s+c)/3;a+=.1*(1-(Math.abs(o-d)+Math.abs(s-d)+Math.abs(c-d))/(3*d));let m=Math.abs(t.open-n.close)/n.close,h=Math.abs(e.open-t.close)/t.close;return m<.01&&h<.01&&(a+=.1),l&&l.length>=8&&eg.analyzeTrend(l.slice(0,-3),5,r)===Y.UPTREND&&(a+=.1),n.volume&&t.volume&&e.volume&&n.volume<t.volume&&t.volume<e.volume&&(a+=.1),Math.min(a,1)}},{name:"上升三法",enName:"Rising Three Methods",type:G.CONTINUATION,strength:H.MODERATE,bullish:!0,description:"大陽線後出現小陰線整理，再以大陽線突破",detail:"上升三法是看漲延續型態。第一根大陽線後，出現2-3根小陰線在第一根陽線範圍內整理，最後一根大陽線突破新高。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;return!!t&&!!n&&!!(en(n)&&el(n,r))&&!!(et(t)&&er(t,r))&&!!(en(e)&&q(e)>.7*q(n))&&!!(t.high<=n.high&&t.low>=n.low)&&!!(e.close>n.high)&&(!a||a.trend===Y.UPTREND||a.trend===Y.UNKNOWN)&&(!l||!(l.length>=6)||eg.analyzeTrend(l.slice(0,-2),4,r)===Y.UPTREND)&&!0},confidence:function(e,t,n,l){if(arguments.length>4&&void 0!==arguments[4]&&arguments[4],!t||!n)return 0;let r=.6,a=(e.close-n.high)/n.high;if(a>.02?r+=.15:a>.01&&(r+=.1),(t.high-t.low)/(n.high-n.low)<.5&&(r+=.1),q(e)/ee(e)>.8&&(r+=.1),l&&l.length>=6&&eg.calculateTrendStrength(l.slice(0,-2),5)>.6&&(r+=.1),n.volume&&t.volume&&e.volume){let a=n.volume>(l?l.slice(-5,-2).reduce((e,t)=>e+(t.volume||0),0)/3:n.volume),i=t.volume<.7*n.volume,o=e.volume>1.2*t.volume;a&&i&&o&&(r+=.15)}return Math.min(r,1)}},{name:"下降三法",enName:"Falling Three Methods",type:G.CONTINUATION,strength:H.MODERATE,bullish:!1,description:"大陰線後出現小陽線整理，再以大陰線跌破",detail:"下降三法是看跌延續型態。第一根大陰線後，出現2-3根小陽線在第一根陰線範圍內整理，最後一根大陰線跌破新低。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;return!!t&&!!n&&!!(et(n)&&el(n,r))&&!!(en(t)&&er(t,r))&&!!(et(e)&&q(e)>.7*q(n))&&!!(t.high<=n.high&&t.low>=n.low)&&!!(e.close<n.low)&&(!a||a.trend===Y.DOWNTREND||a.trend===Y.UNKNOWN)&&(!l||!(l.length>=6)||eg.analyzeTrend(l.slice(0,-2),4,r)===Y.DOWNTREND)&&!0},confidence:function(e,t,n,l){if(arguments.length>4&&void 0!==arguments[4]&&arguments[4],!t||!n)return 0;let r=.6,a=(n.low-e.close)/n.low;if(a>.02?r+=.15:a>.01&&(r+=.1),(t.high-t.low)/(n.high-n.low)<.5&&(r+=.1),q(e)/ee(e)>.8&&(r+=.1),l&&l.length>=6&&eg.calculateTrendStrength(l.slice(0,-2),5)>.6&&(r+=.1),n.volume&&t.volume&&e.volume){let a=n.volume>(l?l.slice(-5,-2).reduce((e,t)=>e+(t.volume||0),0)/3:n.volume),i=t.volume<.7*n.volume,o=e.volume>1.2*t.volume;a&&i&&o&&(r+=.15)}return Math.min(r,1)}},{name:"刺透型態",enName:"Piercing Pattern",type:G.REVERSAL,strength:H.MODERATE,bullish:!0,description:"陰線後出現陽線，收盤價刺透陰線實體中點以上",detail:"刺透型態是看漲反轉信號。第二根陽線低開但強勢收高，收盤價需要超過第一根陰線實體的中點，顯示買方力量增強。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;if(!t)return!1;let i=et(t)&&!er(t,r),o=en(e)&&!er(e,r);e.open,t.close;let s=(t.open+t.close)/2,c=e.close>s&&e.close<t.open;return(!a||a.trend===Y.DOWNTREND||a.trend===Y.UNKNOWN)&&(!l||!(l.length>=r.trendPeriod)||!!eg.isInExtremeZone(e,l,r,"low"))&&i&&o&&c},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!t)return 0;let a=.6,i=(t.open+t.close)/2,o=(e.close-i)/q(t);o>.8?a+=.2:o>.6?a+=.15:o>.4&&(a+=.1);let s=(t.close-e.open)/t.close;return s>.03?a+=.1:s>.01&&(a+=.05),q(e)/ee(e)>.7&&(a+=.1),l&&l.length>=5&&eg.analyzeTrend(l.slice(0,-1),5,r)===Y.DOWNTREND&&(a+=.1),l&&ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"烏雲蓋頂",enName:"Dark Cloud Cover",type:G.REVERSAL,strength:H.MODERATE,bullish:!1,description:"陽線後出現陰線，收盤價跌破陽線實體中點以下",detail:"烏雲蓋頂是看跌反轉信號。第二根陰線高開但弱勢收低，收盤價需要低於第一根陽線實體的中點，顯示賣方力量增強。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;if(!t)return!1;let i=en(t)&&!er(t,r),o=et(e)&&!er(e,r);e.open,t.close;let s=(t.open+t.close)/2,c=e.close<s&&e.close>t.open;return(!a||a.trend===Y.UPTREND||a.trend===Y.UNKNOWN)&&(!l||!(l.length>=r.trendPeriod)||!!eg.isInExtremeZone(e,l,r,"high"))&&i&&o&&c},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!t)return 0;let a=.6,i=((t.open+t.close)/2-e.close)/q(t);i>.8?a+=.2:i>.6?a+=.15:i>.4&&(a+=.1);let o=(e.open-t.close)/t.close;return o>.03?a+=.1:o>.01&&(a+=.05),q(e)/ee(e)>.7&&(a+=.1),l&&l.length>=5&&eg.analyzeTrend(l.slice(0,-1),5,r)===Y.UPTREND&&(a+=.1),l&&ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"孕育線",enName:"Harami",type:G.REVERSAL,strength:H.WEAK,bullish:null,description:"大K線後出現完全包含在其中的小K線",detail:"孕育線表示趨勢可能轉變。第二根K線的實體完全包含在第一根K線的實體內，顯示動能減弱，需要後續確認。",riskLevel:"high",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;if(!t)return!1;let i=el(t,r),o=er(e,r),s=Math.max(t.open,t.close),c=Math.min(t.open,t.close),d=Math.max(e.open,e.close),m=Math.min(e.open,e.close);et(t)&&en(e)||en(t)&&et(e);let h=q(e)/q(t);return(!a||a.trend!==Y.SIDEWAYS)&&i&&o&&d<=s&&m>=c&&h<.5},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!t)return 0;let a=.4,i=q(t),o=q(e)/i;if(o<.25?a+=.15:o<.4&&(a+=.1),(et(t)&&en(e)||en(t)&&et(e))&&(a+=.1),l&&l.length>=r.trendPeriod){let t=eg.isInExtremeZone(e,l,r,"high"),n=eg.isInExtremeZone(e,l,r,"low");(t||n)&&(a+=.15)}return l&&l.length>=5&&eg.analyzeTrend(l.slice(0,-1),5,r)!==Y.SIDEWAYS&&(a+=.1),q(t)/ee(t)>.7&&(a+=.1),Math.min(a,.8)}},{name:"十字孕育線",enName:"Harami Cross",type:G.REVERSAL,strength:H.MODERATE,bullish:null,description:"大K線後出現十字星，完全包含其中",detail:"十字孕育線比普通孕育線更強的反轉信號。第二根十字星顯示極度猶豫，通常預示趨勢即將反轉。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;if(!t)return!1;let i=el(t,r),o=ea(e,r),s=Math.max(t.open,t.close),c=Math.min(t.open,t.close),d=e.high<=s&&e.low>=c;return(!a||a.trend!==Y.SIDEWAYS)&&i&&o&&d},confidence:function(e,t,n,l){let r,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!t)return 0;r=.6+.2*(1-q(e)/ee(e));let i=q(t);if(i/ee(t)>.7&&(r+=.1),l&&l.length>=a.trendPeriod){let t=eg.isInExtremeZone(e,l,a,"high"),n=eg.isInExtremeZone(e,l,a,"low");(t||n)&&(r+=.15)}return l&&l.length>=5&&eg.analyzeTrend(l.slice(0,-1),5,a)!==Y.SIDEWAYS&&(r+=.1),q(t)/ee(t)>.8&&(r+=.1),(ei(e,a)||eo(e,a))&&(r+=.05),Math.min(r,1)}}],eb=[{name:"捉腰帶線",enName:"Belt Hold",type:G.REVERSAL,strength:H.MODERATE,bullish:null,description:"開盤即為最高價或最低價的長實體K線",detail:"捉腰帶線顯示單邊力量強勁。看漲捉腰帶開盤即最低價，看跌捉腰帶開盤即最高價，都預示可能的趨勢反轉。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0,i=q(e),o=ee(e);if(!(i>.7*o))return!1;let s=Q(e),c=X(e),d=en(e)&&Math.abs(e.open-e.low)<.01*o&&s<.02*o,m=et(e)&&Math.abs(e.open-e.high)<.01*o&&c<.02*o;if(!(d||m)||a&&(d&&a.trend===Y.UPTREND||m&&a.trend===Y.DOWNTREND))return!1;if(l&&l.length>=r.trendPeriod&&(d&&!eg.isInExtremeZone(e,l,r,"low")||m&&!eg.isInExtremeZone(e,l,r,"high")))return!1;return!0},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=.6,i=q(e),o=ee(e),s=i/o;s>.85?a+=.15:s>.75&&(a+=.1);let c=(X(e)+Q(e))/o;if(c<.05?a+=.1:c<.1&&(a+=.05),l&&l.length>=5){let t=eg.analyzeTrend(l.slice(0,-1),5,r),n=en(e),i=et(e);(n&&t===Y.DOWNTREND||i&&t===Y.UPTREND)&&(a+=.1)}return l&&ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"鑷子頂部",enName:"Tweezers Top",type:G.REVERSAL,strength:H.WEAK,bullish:!1,description:"兩根K線的高點幾乎相等，形成阻力",detail:"鑷子頂部顯示在相同價位遇到阻力。兩根K線的最高價相近，第二根通常是看跌型態，預示上升動能衰竭。",riskLevel:"high",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;if(!t||!(Math.abs(e.high-t.high)/t.high<.01))return!1;let i=q(e)/(q(t)+1e-6);return!!(i>.5&&i<2)&&!!en(t)&&!!(et(e)||X(e)>1.2*q(e))&&(!a||a.trend===Y.UPTREND||a.trend===Y.UNKNOWN)&&(!l||!(l.length>=r.trendPeriod)||!!eg.isInExtremeZone(e,l,r,"high"))&&!0},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!t)return 0;let a=.4,i=Math.abs(e.high-t.high)/t.high;i<.005?a+=.15:i<.008&&(a+=.1),et(e)&&(a+=.1);let o=X(e)/ee(e);return o>.4?a+=.15:o>.3&&(a+=.1),l&&l.length>=5&&eg.analyzeTrend(l.slice(0,-1),5,r)===Y.UPTREND&&(a+=.1),l&&l.length>=r.trendPeriod&&eg.isInExtremeZone(e,l,r,"high")&&(a+=.1),Math.min(a,.8)}},{name:"鑷子底部",enName:"Tweezers Bottom",type:G.REVERSAL,strength:H.WEAK,bullish:!0,description:"兩根K線的低點幾乎相等，形成支撐",detail:"鑷子底部顯示在相同價位獲得支撐。兩根K線的最低價相近，第二根通常是看漲型態，預示下跌動能衰竭。",riskLevel:"high",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0;if(!t||!(Math.abs(e.low-t.low)/t.low<.01))return!1;let i=q(e)/(q(t)+1e-6);return!!(i>.5&&i<2)&&!!et(t)&&!!(en(e)||Q(e)>1.2*q(e))&&(!a||a.trend===Y.DOWNTREND||a.trend===Y.UNKNOWN)&&(!l||!(l.length>=r.trendPeriod)||!!eg.isInExtremeZone(e,l,r,"low"))&&!0},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!t)return 0;let a=.4,i=Math.abs(e.low-t.low)/t.low;i<.005?a+=.15:i<.008&&(a+=.1),en(e)&&(a+=.1);let o=Q(e)/ee(e);return o>.4?a+=.15:o>.3&&(a+=.1),l&&l.length>=5&&eg.analyzeTrend(l.slice(0,-1),5,r)===Y.DOWNTREND&&(a+=.1),l&&l.length>=r.trendPeriod&&eg.isInExtremeZone(e,l,r,"low")&&(a+=.1),Math.min(a,.8)}},{name:"上升旗型",enName:"Bull Flag",type:G.CONTINUATION,strength:H.MODERATE,bullish:!0,description:"強勢上漲後的短期下傾整理，預示繼續上漲",detail:"上升旗型出現在強勢上漲後，由一根強勢陽線（旗桿）和隨後的下傾整理（旗面）組成。整理期間成交量縮減，突破後成交量放大，目標價位為旗桿長度加上突破點。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){arguments.length>4&&void 0!==arguments[4]&&arguments[4];let r=arguments.length>5?arguments[5]:void 0;if(!t||!n||!l||l.length<10||r&&r.trend!==Y.UPTREND)return!1;let a=l.slice(-10),i=Math.min(4,a.length-4),o=a.slice(0,i);if(o[o.length-1].close/o[0].close-1<.04||o.filter(e=>en(e)).length<.7*o.length)return!1;let s=a.length-1,c=a.slice(i,s);if(c.length<3||!ex.isConsolidating(c,.08))return!1;let d=ex.calculateTrend(c,"high");if((d+ex.calculateTrend(c,"low"))/2>0)return!1;let m=Math.max(...o.map(e=>e.high))-Math.min(...o.map(e=>e.low));if(Math.max(...c.map(e=>e.high))-Math.min(...c.map(e=>e.low))>.6*m)return!1;let h=Math.max(...c.map(e=>e.high));return e.close>h},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!l||l.length<10)return 0;let a=.6,i=l.slice(-10),o=Math.min(4,i.length-4),s=i.slice(0,o),c=i.slice(o,-1),d=s[s.length-1].close/s[0].close-1;d>.08?a+=.15:d>.06&&(a+=.1),1-(Math.max(...c.map(e=>e.high))-Math.min(...c.map(e=>e.low)))/(Math.max(...s.map(e=>e.high))-Math.min(...s.map(e=>e.low)))>.7&&(a+=.1),c.length>2&&ex.hasVolumeDecrease(c)&&(a+=.1);let m=Math.max(...c.map(e=>e.high));return(e.close-m)/m>.02&&(a+=.1),ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"下降旗型",enName:"Bear Flag",type:G.CONTINUATION,strength:H.MODERATE,bullish:!1,description:"強勢下跌後的短期上傾整理，預示繼續下跌",detail:"下降旗型出現在強勢下跌後，由一根強勢陰線（旗桿）和隨後的上傾整理（旗面）組成。整理期間成交量縮減，跌破後成交量放大，目標價位為旗桿長度從跌破點向下測量。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){arguments.length>4&&void 0!==arguments[4]&&arguments[4];let r=arguments.length>5?arguments[5]:void 0;if(!t||!n||!l||l.length<10||r&&r.trend!==Y.DOWNTREND)return!1;let a=l.slice(-10),i=Math.min(4,a.length-4),o=a.slice(0,i);if(1-o[o.length-1].close/o[0].close<.04||o.filter(e=>et(e)).length<.7*o.length)return!1;let s=a.length-1,c=a.slice(i,s);if(c.length<3||!ex.isConsolidating(c,.08))return!1;let d=ex.calculateTrend(c,"high");if((d+ex.calculateTrend(c,"low"))/2<0)return!1;let m=Math.max(...o.map(e=>e.high))-Math.min(...o.map(e=>e.low));if(Math.max(...c.map(e=>e.high))-Math.min(...c.map(e=>e.low))>.6*m)return!1;let h=Math.min(...c.map(e=>e.low));return e.close<h},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!l||l.length<10)return 0;let a=.6,i=l.slice(-10),o=Math.min(4,i.length-4),s=i.slice(0,o),c=i.slice(o,-1),d=1-s[s.length-1].close/s[0].close;d>.08?a+=.15:d>.06&&(a+=.1),1-(Math.max(...c.map(e=>e.high))-Math.min(...c.map(e=>e.low)))/(Math.max(...s.map(e=>e.high))-Math.min(...s.map(e=>e.low)))>.7&&(a+=.1),c.length>2&&ex.hasVolumeDecrease(c)&&(a+=.1);let m=Math.min(...c.map(e=>e.low));return(m-e.close)/m>.02&&(a+=.1),ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"上升三角旗",enName:"Ascending Pennant",type:G.CONTINUATION,strength:H.MODERATE,bullish:!0,description:"上升趨勢中的三角形整理，高點持平，低點抬升",detail:"上升三角旗是看漲延續型態，出現在上升趨勢中。特徵是高點連線水平，低點連線上升，形成三角形收斂。通常在三角形頂部附近向上突破。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){arguments.length>4&&void 0!==arguments[4]&&arguments[4];let r=arguments.length>5?arguments[5]:void 0;if(!t||!n||!l||l.length<8||r&&r.trend!==Y.UPTREND)return!1;let a=l.slice(-8),i=a.map(e=>e.high),o=a.map(e=>e.low);if(!(Math.abs(ex.calculateTrend(a,"high"))<.002*Math.max(...i))||!(ex.calculateTrend(a,"low")>.002*Math.max(...o)))return!1;let s=i[0]-o[0];if(!(i[i.length-1]-o[o.length-1]<.75*s))return!1;let c=Math.max(...i.slice(0,-1));return e.close>c},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!l||l.length<8)return 0;let a=.6,i=l.slice(-8),o=i.map(e=>e.high),s=i.map(e=>e.low);(Math.max(...o)-Math.min(...o))/(o.reduce((e,t)=>e+t,0)/o.length)<.01&&(a+=.1),ex.calculateTrend(i,"low")/Math.min(...s)>.005&&(a+=.1);let c=o[0]-s[0],d=(o[o.length-1]-s[s.length-1])/c;d<.5?a+=.15:d<.7&&(a+=.1);let m=Math.max(...o.slice(0,-1));return(e.close-m)/m>.02&&(a+=.1),ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"下降三角旗",enName:"Descending Pennant",type:G.CONTINUATION,strength:H.MODERATE,bullish:!1,description:"下降趨勢中的三角形整理，低點持平，高點下降",detail:"下降三角旗是看跌延續型態，出現在下降趨勢中。特徵是低點連線水平，高點連線下降，形成三角形收斂。通常在三角形底部附近向下跌破。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){arguments.length>4&&void 0!==arguments[4]&&arguments[4];let r=arguments.length>5?arguments[5]:void 0;if(!t||!n||!l||l.length<8||r&&r.trend!==Y.DOWNTREND)return!1;let a=l.slice(-8),i=a.map(e=>e.high),o=a.map(e=>e.low);if(!(Math.abs(ex.calculateTrend(a,"low"))<.002*Math.max(...o))||!(ex.calculateTrend(a,"high")<-(.002*Math.max(...i))))return!1;let s=i[0]-o[0];if(!(i[i.length-1]-o[o.length-1]<.75*s))return!1;let c=Math.min(...o.slice(0,-1));return e.close<c},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!l||l.length<8)return 0;let a=.6,i=l.slice(-8),o=i.map(e=>e.high),s=i.map(e=>e.low);(Math.max(...s)-Math.min(...s))/(s.reduce((e,t)=>e+t,0)/s.length)<.01&&(a+=.1),Math.abs(ex.calculateTrend(i,"high"))/Math.max(...o)>.005&&(a+=.1);let c=o[0]-s[0],d=(o[o.length-1]-s[s.length-1])/c;d<.5?a+=.15:d<.7&&(a+=.1);let m=Math.min(...s.slice(0,-1));return(m-e.close)/m>.02&&(a+=.1),ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"上升楔型",enName:"Rising Wedge",type:G.REVERSAL,strength:H.MODERATE,bullish:!1,description:"高點和低點都上升但收斂，通常是看跌反轉信號",detail:"上升楔型是看跌反轉型態。雖然價格持續上升，但上升幅度逐漸縮小，高點和低點連線都向上但逐漸收斂，顯示上升動能衰竭，通常向下跌破。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){arguments.length>4&&void 0!==arguments[4]&&arguments[4];let r=arguments.length>5?arguments[5]:void 0;if(!t||!n||!l||l.length<10||r&&r.trend===Y.DOWNTREND)return!1;let a=l.slice(-10),i=ex.calculateTrend(a,"high"),o=ex.calculateTrend(a,"low");if(!(i>0&&o>0)||!(o>1.2*i)||a.length>5&&!ex.hasVolumeDecrease(a))return!1;let s=a[0].low+o*(a.length-1);return e.close<.985*s},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!l||l.length<10)return 0;let a=.6,i=l.slice(-10),o=ex.calculateTrend(i,"high"),s=ex.calculateTrend(i,"low"),c=s/o;c>2?a+=.15:c>1.5&&(a+=.1),ex.hasVolumeDecrease(i)&&(a+=.1);let d=i[0].low+s*(i.length-1);return(d-e.close)/d>.02&&(a+=.1),eg.isInExtremeZone(e,l,r,"high")&&(a+=.1),Math.min(a,1)}},{name:"下降楔型",enName:"Falling Wedge",type:G.REVERSAL,strength:H.MODERATE,bullish:!0,description:"高點和低點都下降但收斂，通常是看漲反轉信號",detail:"下降楔型是看漲反轉型態。雖然價格持續下跌，但下跌幅度逐漸縮小，高點和低點連線都向下但逐漸收斂，顯示下跌動能衰竭，通常向上突破。",riskLevel:"medium",marketConditions:["trending"],check:function(e,t,n,l){arguments.length>4&&void 0!==arguments[4]&&arguments[4];let r=arguments.length>5?arguments[5]:void 0;if(!t||!n||!l||l.length<10||r&&r.trend===Y.UPTREND)return!1;let a=l.slice(-10),i=ex.calculateTrend(a,"high"),o=ex.calculateTrend(a,"low");if(!(i<0&&o<0)||!(Math.abs(i)>1.2*Math.abs(o))||a.length>5&&!ex.hasVolumeDecrease(a))return!1;let s=a[0].high+i*(a.length-1);return e.close>1.015*s},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!l||l.length<10)return 0;let a=.6,i=l.slice(-10),o=ex.calculateTrend(i,"high"),s=Math.abs(o)/Math.abs(ex.calculateTrend(i,"low"));s>2?a+=.15:s>1.5&&(a+=.1),ex.hasVolumeDecrease(i)&&(a+=.1);let c=i[0].high+o*(i.length-1);return(e.close-c)/c>.02&&(a+=.1),eg.isInExtremeZone(e,l,r,"low")&&(a+=.1),ed(e,l,r)&&(a+=.1),Math.min(a,1)}}],ef=[...ep,...ey,...eb,{name:"W底（雙重底）",enName:"Double Bottom",type:G.REVERSAL,strength:H.STRONG,bullish:!0,description:"兩個相近的低點形成W形，強烈看漲反轉信號",detail:"W底是經典的看漲反轉型態。兩個低點價位相近，中間有一個反彈高點。第二個低點通常成交量較小，突破中間高點時成交量放大，確認反轉成功。目標價位通常是型態高度加上突破點。",riskLevel:"low",marketConditions:["trending"],check:function(e,t,n,l){arguments.length>4&&void 0!==arguments[4]&&arguments[4];let r=arguments.length>5?arguments[5]:void 0;if(!l||l.length<20||r&&r.trend===Y.UPTREND)return!1;let a=ex.findLocalMinima(l,2);if(a.length<2||!ex.isDoublePattern(a,.025))return!1;let[i,o]=a.slice(-2),s=o.index-i.index;if(s<5||s>30)return!1;let c=Math.max(...l.slice(i.index,o.index+1).map(e=>e.high));if(!(e.close>1.005*c)||!(c-Math.min(i.value,o.value)>.045*i.value))return!1;let d=l.slice(Math.max(0,i.index-8),i.index);return d.length>3&&d[0].close>1.03*d[d.length-1].close},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!l||l.length<20)return 0;let a=.7,i=ex.findLocalMinima(l,2);if(i.length<2)return 0;let[o,s]=i.slice(-2),c=Math.max(...l.slice(o.index,s.index+1).map(e=>e.high)),d=Math.abs(o.value-s.value)/Math.min(o.value,s.value);d<.01?a+=.15:d<.02&&(a+=.1),(c-Math.min(o.value,s.value))/o.value>.08&&(a+=.1),(e.close-c)/c>.02&&(a+=.1);let m=l[o.index],h=l[s.index];return m.volume&&h.volume&&h.volume<.8*m.volume&&(a+=.1),ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"M頭（雙重頂）",enName:"Double Top",type:G.REVERSAL,strength:H.STRONG,bullish:!1,description:"兩個相近的高點形成M形，強烈看跌反轉信號",detail:"M頭是經典的看跌反轉型態。兩個高點價位相近，中間有一個回檔低點。第二個高點通常成交量較小，跌破中間低點時確認反轉。目標價位通常是型態高度從跌破點向下測量。",riskLevel:"low",marketConditions:["trending"],check:function(e,t,n,l){arguments.length>4&&void 0!==arguments[4]&&arguments[4];let r=arguments.length>5?arguments[5]:void 0;if(!l||l.length<20||r&&r.trend===Y.DOWNTREND)return!1;let a=ex.findLocalMaxima(l,2);if(a.length<2||!ex.isDoublePattern(a,.025))return!1;let[i,o]=a.slice(-2),s=o.index-i.index;if(s<5||s>30)return!1;let c=Math.min(...l.slice(i.index,o.index+1).map(e=>e.low));if(!(e.close<.995*c)||!(Math.max(i.value,o.value)-c>.045*c))return!1;let d=l.slice(Math.max(0,i.index-8),i.index);return d.length>3&&d[0].close<.97*d[d.length-1].close},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!l||l.length<20)return 0;let a=.7,i=ex.findLocalMaxima(l,2);if(i.length<2)return 0;let[o,s]=i.slice(-2),c=Math.min(...l.slice(o.index,s.index+1).map(e=>e.low)),d=Math.abs(o.value-s.value)/Math.max(o.value,s.value);d<.01?a+=.15:d<.02&&(a+=.1),(Math.max(o.value,s.value)-c)/c>.08&&(a+=.1),(c-e.close)/c>.02&&(a+=.1);let m=l[o.index],h=l[s.index];return m.volume&&h.volume&&h.volume<.8*m.volume&&(a+=.1),ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"頭肩頂",enName:"Head and Shoulders Top",type:G.REVERSAL,strength:H.STRONG,bullish:!1,description:"左肩、頭部、右肩形成的看跌反轉型態",detail:"頭肩頂是最可靠的看跌反轉型態之一。由三個高點組成：中間的頭部最高，兩側的肩膀高度相近且較低。頸線連接兩個肩膀間的低點，跌破頸線確認反轉。目標價位為頭部到頸線的距離從跌破點向下測量。",riskLevel:"low",marketConditions:["trending"],check:function(e,t,n,l){arguments.length>4&&void 0!==arguments[4]&&arguments[4];let r=arguments.length>5?arguments[5]:void 0;if(!l||l.length<30||r&&r.trend===Y.DOWNTREND)return!1;let a=ex.findLocalMaxima(l,2);if(a.length<3||!ex.isHeadAndShoulders(a))return!1;let[i,o,s]=a.slice(-3);if(o.index-i.index<4||s.index-o.index<4||s.index-i.index>30)return!1;let c=l.slice(i.index,o.index),d=l.slice(o.index,s.index+5),m=Math.max(Math.min(...c.map(e=>e.low)),Math.min(...d.map(e=>e.low)));if(!(e.close<.995*m)||!(o.value-m>.07*m))return!1;let h=l.slice(Math.max(0,i.index-8),i.index);return h.length>3&&h[0].close<.97*h[h.length-1].close},confidence:function(e,t,n,l){if(arguments.length>4&&void 0!==arguments[4]&&arguments[4],!l||l.length<30)return 0;let r=.8,a=ex.findLocalMaxima(l,2);if(a.length<3)return 0;let[i,o,s]=a.slice(-3),c=l.slice(i.index,o.index),d=l.slice(o.index,s.index+5),m=Math.min(...c.map(e=>e.low)),h=Math.min(...d.map(e=>e.low)),u=Math.max(m,h);Math.abs(i.value-s.value)/Math.max(i.value,s.value)<.02&&(r+=.1),Math.min((o.value-i.value)/i.value,(o.value-s.value)/s.value)>.05&&(r+=.1),Math.abs(m-h)/Math.max(m,h)<.03&&(r+=.05),(u-e.close)/u>.02&&(r+=.1);let g=l[o.index],x=l[s.index];return g.volume&&x.volume&&x.volume<.8*g.volume&&(r+=.1),Math.min(r,1)}},{name:"頭肩底",enName:"Head and Shoulders Bottom",type:G.REVERSAL,strength:H.STRONG,bullish:!0,description:"倒置的頭肩型態，強烈看漲反轉信號",detail:"頭肩底是頭肩頂的倒置版本，是強烈的看漲反轉型態。由三個低點組成：中間的頭部最低，兩側的肩膀高度相近且較高。頸線連接兩個肩膀間的高點，突破頸線確認反轉。目標價位為頭部到頸線的距離從突破點向上測量。",riskLevel:"low",marketConditions:["trending"],check:function(e,t,n,l){arguments.length>4&&void 0!==arguments[4]&&arguments[4];let r=arguments.length>5?arguments[5]:void 0;if(!l||l.length<30||r&&r.trend===Y.UPTREND)return!1;let a=ex.findLocalMinima(l,2);if(a.length<3||!ex.isInverseHeadAndShoulders(a))return!1;let[i,o,s]=a.slice(-3);if(o.index-i.index<4||s.index-o.index<4||s.index-i.index>30)return!1;let c=l.slice(i.index,o.index),d=l.slice(o.index,s.index+5),m=Math.min(Math.max(...c.map(e=>e.high)),Math.max(...d.map(e=>e.high)));if(!(e.close>1.005*m)||!(m-o.value>.07*o.value))return!1;let h=l.slice(Math.max(0,i.index-8),i.index);return h.length>3&&h[0].close>1.03*h[h.length-1].close},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$;if(!l||l.length<30)return 0;let a=.8,i=ex.findLocalMinima(l,2);if(i.length<3)return 0;let[o,s,c]=i.slice(-3),d=l.slice(o.index,s.index),m=l.slice(s.index,c.index+5),h=Math.max(...d.map(e=>e.high)),u=Math.max(...m.map(e=>e.high)),g=Math.min(h,u);Math.abs(o.value-c.value)/Math.min(o.value,c.value)<.02&&(a+=.1),Math.min((o.value-s.value)/s.value,(c.value-s.value)/s.value)>.05&&(a+=.1),Math.abs(h-u)/Math.min(h,u)<.03&&(a+=.05),(e.close-g)/g>.02&&(a+=.1);let x=l[s.index],p=l[c.index];return x.volume&&p.volume&&p.volume<.8*x.volume&&(a+=.05),ed(e,l,r)&&(a+=.1),Math.min(a,1)}},{name:"墓碑線",enName:"Gravestone Doji",type:G.REVERSAL,strength:H.STRONG,bullish:!1,description:"長上影線無下影線，強烈看跌訊號",detail:"墓碑線出現在高位時，代表多頭攻擊失敗，是強烈的反轉訊號。",riskLevel:"low",marketConditions:["trending"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0,i=q(e),o=X(e),s=Q(e),c=ee(e);return!!(i<.08*c)&&!!(o>.75*c)&&!!(s<.07*c)&&(!a||a.trend===Y.UPTREND||a.trend===Y.UNKNOWN)&&(!l||!(l.length>=r.trendPeriod)||!!eg.isInExtremeZone(e,l,r,"high"))&&!0},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=.7,i=q(e),o=X(e),s=Q(e),c=ee(e);a+=.15*(1-i/c);let d=o/c;return d>.85?a+=.15:d>.8&&(a+=.1),s/c<.03&&(a+=.1),l&&l.length>=5&&eg.analyzeTrend(l.slice(0,-1),5,r)===Y.UPTREND&&(a+=.1),l&&l.length>=r.trendPeriod&&eg.isInExtremeZone(e,l,r,"high")&&(a+=.1),Math.min(a,1)}},{name:"蜻蜓線",enName:"Dragonfly Doji",type:G.REVERSAL,strength:H.STRONG,bullish:!0,description:"長下影線無上影線，強烈看漲訊號",detail:"蜻蜓線是十字星的一種，具有長下影線而無上影線。出現在低位時，代表股價曾經大幅下跌但最終回升，顯示空頭攻擊失敗，是強烈的看漲反轉訊號。下影線越長，反轉力道越強。",riskLevel:"low",marketConditions:["trending","ranging"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0,i=q(e),o=X(e),s=Q(e),c=ee(e);return!!(i<.08*c)&&!!(s>.7*c)&&!!(o<.08*c)&&(!a||a.trend!==Y.UPTREND)&&(!l||!(l.length>=r.trendPeriod)||!!eg.isInExtremeZone(e,l,r,"low"))&&!0},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=.7,i=q(e),o=X(e),s=Q(e),c=ee(e);a+=.15*(1-i/c);let d=s/c;return d>.85?a+=.15:d>.8&&(a+=.1),o/c<.03&&(a+=.1),l&&l.length>=5&&eg.analyzeTrend(l.slice(0,-1),5,r)===Y.DOWNTREND&&(a+=.1),l&&l.length>=r.trendPeriod&&eg.isInExtremeZone(e,l,r,"low")&&(a+=.1),l&&ed(e,l,r)&&(a+=.05),Math.min(a,1)}},{name:"長陽線",enName:"Bullish Marubozu",type:G.CONTINUATION,strength:H.STRONG,bullish:!0,description:"幾乎無影線的長陽線，強烈看漲訊號",detail:"長陽線（光頭光腳陽線）代表多頭力量強勁，買方從開盤到收盤完全控制市場，幾乎沒有上下影線。是強烈的看漲信號，通常延續上漲趨勢或開啟新的上漲行情。配合放量出現效果更佳。",riskLevel:"low",marketConditions:["trending","volatile"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0,i=q(e),o=X(e),s=Q(e),c=ee(e);if(!en(e)||!(i>.85*c&&o<.08*c&&s<.08*c)||!el(e,r)||a&&a.trend===Y.DOWNTREND&&i<.9*c)return!1;if(l&&l.length>=5&&e.volume){let t=l.slice(-5).map(e=>e.volume||0),n=t.reduce((e,t)=>e+t,0)/t.length;if(e.volume<1.2*n)return!1}return!0},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=.75,i=q(e),o=X(e),s=Q(e),c=ee(e),d=i/c;if(d>.95?a+=.15:d>.9&&(a+=.1),(o+s)/c<.05&&(a+=.1),el(e,r)){let t=Math.abs(e.close-e.open)/e.open;t>.05?a+=.1:t>.03&&(a+=.05)}if(l&&l.length>=5){let e=eg.analyzeTrend(l.slice(0,-1),5,r);e===Y.UPTREND?a+=.1:e===Y.UNKNOWN&&(a+=.05)}if(l&&e.volume){let t=l.slice(-5).map(e=>e.volume||0),n=t.reduce((e,t)=>e+t,0)/t.length,r=e.volume/n;r>2?a+=.15:r>1.5?a+=.1:r>1.2&&(a+=.05)}return Math.min(a,1)}},{name:"長陰線",enName:"Bearish Marubozu",type:G.CONTINUATION,strength:H.STRONG,bullish:!1,description:"幾乎無影線的長陰線，強烈看跌訊號",detail:"長陰線（光頭光腳陰線）代表空頭力量強勁，賣方從開盤到收盤完全控制市場，幾乎沒有上下影線。是強烈的看跌信號，通常延續下跌趨勢或開始新的下跌行情。配合放量出現殺傷力更大。",riskLevel:"low",marketConditions:["trending","volatile"],check:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=arguments.length>5?arguments[5]:void 0,i=q(e),o=X(e),s=Q(e),c=ee(e);if(!et(e)||!(i>.85*c&&o<.08*c&&s<.08*c)||!el(e,r)||a&&a.trend===Y.UPTREND&&i<.9*c)return!1;if(l&&l.length>=5&&e.volume){let t=l.slice(-5).map(e=>e.volume||0),n=t.reduce((e,t)=>e+t,0)/t.length;if(e.volume<1.2*n)return!1}return!0},confidence:function(e,t,n,l){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:$,a=.75,i=q(e),o=X(e),s=Q(e),c=ee(e),d=i/c;if(d>.95?a+=.15:d>.9&&(a+=.1),(o+s)/c<.05&&(a+=.1),el(e,r)){let t=Math.abs(e.open-e.close)/e.open;t>.05?a+=.1:t>.03&&(a+=.05)}if(l&&l.length>=5){let e=eg.analyzeTrend(l.slice(0,-1),5,r);e===Y.DOWNTREND?a+=.1:e===Y.UNKNOWN&&(a+=.05)}if(l&&e.volume){let t=l.slice(-5).map(e=>e.volume||0),n=t.reduce((e,t)=>e+t,0)/t.length,r=e.volume/n;r>2?a+=.15:r>1.5?a+=.1:r>1.2&&(a+=.05)}return Math.min(a,1)}}];ef.length;var ev=n(9860);let eN=e=>{switch(e){case G.REVERSAL:return"bg-red-100 text-red-800";case G.CONTINUATION:return"bg-blue-100 text-blue-800";case G.INDECISION:default:return"bg-gray-100 text-gray-800"}},ew=e=>!0===e?"text-green-600":!1===e?"text-red-600":"text-gray-600",ek=e=>!0===e?(0,l.jsx)(x.A,{className:"h-5 w-5 text-green-600"}):!1===e?(0,l.jsx)(p.A,{className:"h-5 w-5 text-red-600"}):(0,l.jsx)(ev.A,{className:"h-5 w-5 text-gray-600"}),ej=e=>{switch(e){case H.STRONG:return(0,l.jsx)("div",{className:"h-1 w-16 bg-green-500 rounded-full",title:"強"});case H.MODERATE:return(0,l.jsx)("div",{className:"h-1 w-10 bg-yellow-400 rounded-full",title:"中"});case H.WEAK:return(0,l.jsx)("div",{className:"h-1 w-6 bg-gray-400 rounded-full",title:"弱"});default:return null}},eM=(0,r.memo)(e=>{let{pattern:t,highlight:n=!1,onClick:r}=e;return(0,l.jsxs)("div",{className:"p-4 rounded-lg border transition-all duration-200 cursor-pointer hover:scale-[1.02] ".concat(n?"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200 shadow-lg":"bg-gray-50 border-gray-200 hover:shadow-md hover:border-gray-300"),onClick:r,role:"button",tabIndex:0,onKeyDown:e=>"Enter"===e.key&&(null==r?void 0:r()),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("span",{className:"text-2xl ".concat(ew(t.bullish)),children:ek(t.bullish)}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-lg font-bold text-gray-800",children:t.name}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:t.enName})]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsxs)("div",{className:"inline-block px-2 py-1 rounded-full text-xs font-medium ".concat(eN(t.type)),children:[t.type===G.REVERSAL&&"反轉",t.type===G.CONTINUATION&&"延續",t.type===G.INDECISION&&"猶豫"]}),(0,l.jsx)("div",{className:"mt-1",children:ej(t.strength)})]})]}),(0,l.jsx)("p",{className:"text-gray-700 mb-2",children:t.description})]})}),eC=e=>{let{candlestickData:t,maxPatternsToShow:n=5,customPatterns:a=[],enableCache:i=!0,historicalDays:o=30,onPatternDetected:s}=e,[c,d]=(0,r.useState)(null),[m,h]=(0,r.useState)("all"),[u,g]=(0,r.useState)("strength"),x=(null==t?void 0:t.length)||0,p=x>0?t[x-1]:void 0,y=x>1?t[x-2]:void 0,b=x>2?t[x-3]:void 0,f=(0,r.useMemo)(()=>[...ef,...a],[a]),v=(0,r.useMemo)(()=>p?f.filter(e=>e.check(p,y,b,t)):[],[f,p,y,b,t]),N=(0,r.useMemo)(()=>{let e=v;return"all"!==m&&(e=e.filter(e=>e.type===m)),e.sort((e,t)=>{if("name"===u)return e.name.localeCompare(t.name);{let n={[H.VERY_STRONG]:4,[H.STRONG]:3,[H.MODERATE]:2,[H.WEAK]:1};return n[t.strength]-n[e.strength]}}),e.slice(0,n)},[v,m,u,n]);r.useEffect(()=>{s&&v.length>0&&s(v)},[v,s]);let w=(0,r.useMemo)(()=>{if(!t||0===t.length)return[];let e=new Date,n=864e5*o,l=[];for(let r=0;r<t.length;r++){let a=t[r];if(!a.date)continue;let i=new Date(a.date);if(isNaN(i.getTime())||e.getTime()-i.getTime()>n)continue;let o=r>0?t[r-1]:void 0,s=r>1?t[r-2]:void 0;f.forEach(e=>{e.check(a,o,s,t)&&l.push({date:a.date,index:r,pattern:e})})}return l.sort((e,t)=>t.index-e.index)},[t,f,o]),[k,j]=(0,r.useState)(1);w.length;let M=N[0],C=(0,r.useCallback)((e,t)=>{let n="<!DOCTYPE html>\n    <html lang='zh-TW'>\n    <head>\n      <meta charset='UTF-8' />\n      <title>K線歷史型態分析</title>\n      <style>\n        body { \n          font-family: system-ui, -apple-system, sans-serif; \n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          margin: 0; padding: 2rem; min-height: 100vh;\n        }\n        .container {\n          max-width: 1200px; margin: 0 auto; background: white;\n          border-radius: 12px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);\n          overflow: hidden;\n        }\n        .header {\n          background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);\n          color: white; padding: 2rem; text-align: center;\n        }\n        .stats {\n          display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n          gap: 1rem; padding: 1.5rem; background: #f8fafc;\n        }\n        .stat-card {\n          background: white; padding: 1rem; border-radius: 8px;\n          box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: center;\n        }\n        table { \n          border-collapse: collapse; width: 100%; \n          font-size: 0.9rem;\n        }\n        th, td { \n          border-bottom: 1px solid #e5e7eb; \n          padding: 0.75rem; text-align: left; \n        }\n        th { \n          background: #f9fafb; font-weight: 600;\n          position: sticky; top: 0; z-index: 10;\n        }\n        tr:hover { background: #f9fafb; }\n        .pagination { \n          padding: 1.5rem; display: flex; justify-content: center; \n          align-items: center; gap: 1rem; background: #f8fafc;\n        }\n        .btn { \n          padding: 0.5rem 1rem; border-radius: 6px; border: none; \n          background: #4f46e5; color: white; cursor: pointer;\n          font-size: 0.875rem; transition: all 0.2s;\n        }\n        .btn:disabled { opacity: 0.5; cursor: not-allowed; background: #9ca3af; }\n        .btn:hover:not(:disabled) { background: #4338ca; transform: translateY(-1px); }\n        .pattern-type { \n          padding: 0.25rem 0.5rem; border-radius: 4px; \n          font-size: 0.75rem; font-weight: 500;\n        }\n        .type-reversal { background: #fee2e2; color: #991b1b; }\n        .type-continuation { background: #dbeafe; color: #1e40af; }\n        .type-indecision { background: #f3f4f6; color: #374151; }\n      </style>\n    </head>\n    <body>\n      <div class='container'>\n        <div class='header'>\n          <h1>\uD83D\uDCCA K線歷史型態分析</h1>\n          <p>最近 ".concat(o," 天的型態統計</p>\n        </div>\n        \n        <div class='stats' id='stats-container'></div>\n        \n        <div id='table-container'></div>\n        \n        <div class='pagination' id='pagination-container'></div>\n      </div>\n      \n      <script>\n        const patterns = ").concat(JSON.stringify(e),";\n        const HISTORY_PAGE_SIZE = ").concat(t,";\n        let page = 1;\n        \n        // 統計數據\n        const stats = {\n          total: patterns.length,\n          reversal: patterns.filter(p => p.pattern.type === 'reversal').length,\n          continuation: patterns.filter(p => p.pattern.type === 'continuation').length,\n          indecision: patterns.filter(p => p.pattern.type === 'indecision').length,\n        };\n        \n        function renderStats() {\n          const container = document.getElementById('stats-container');\n          container.innerHTML = `\n            <div class='stat-card'>\n              <div style='font-size: 2rem; color: #4f46e5; margin-bottom: 0.5rem;'>\n                ${stats.total}\n              </div>\n              <div style='color: #6b7280; font-size: 0.875rem;'>總型態數</div>\n            </div>\n            <div class='stat-card'>\n              <div style='font-size: 2rem; color: #dc2626; margin-bottom: 0.5rem;'>\n                ${stats.reversal}\n              </div>\n              <div style='color: #6b7280; font-size: 0.875rem;'>反轉型態</div>\n            </div>\n            <div class='stat-card'>\n              <div style='font-size: 2rem; color: #2563eb; margin-bottom: 0.5rem;'>\n                ${stats.continuation}\n              </div>\n              <div style='color: #6b7280; font-size: 0.875rem;'>延續型態</div>\n            </div>\n            <div class='stat-card'>\n              <div style='font-size: 2rem; color: #6b7280; margin-bottom: 0.5rem;'>\n                ${stats.indecision}\n              </div>\n              <div style='color: #6b7280; font-size: 0.875rem;'>猶豫型態</div>\n            </div>\n          `;\n        }\n        \n        function getTypeText(type) {\n          return type === 'reversal' ? '反轉' : \n                 type === 'continuation' ? '延續' : '猶豫';\n        }\n        \n        function getTypeClass(type) {\n          return type === 'reversal' ? 'type-reversal' : \n                 type === 'continuation' ? 'type-continuation' : 'type-indecision';\n        }\n        \n        function getBullishIcon(bullish) {\n          return bullish === true ? \"\uD83D\uDCC8\" : \n                 bullish === false ? \"\uD83D\uDCC9\" : \"➖\";\n        }\n        \n        function renderTable() {\n          const start = (page - 1) * HISTORY_PAGE_SIZE;\n          const paged = patterns.slice(start, start + HISTORY_PAGE_SIZE);\n          \n          let html = `\n            <table>\n              <thead>\n                <tr>\n                  <th>#</th>\n                  <th>日期</th>\n                  <th>型態名稱</th>\n                  <th>型態類型</th>\n                  <th>多空</th>\n                </tr>\n              </thead>\n              <tbody>\n          `;\n          \n          if (paged.length === 0) {\n            html += `<tr><td colspan='5' style='text-align: center; padding: 2rem; color: #6b7280;'>\n              無歷史型態紀錄</td></tr>`;\n          } else {\n            paged.forEach((item, idx) => {\n              html += `\n                <tr>\n                  <td>${start + idx + 1}</td>\n                  <td>${item.date || ('#' + (item.index + 1))}</td>\n                  <td><strong>${item.pattern.name}</strong><br>\n                      <small style='color: #6b7280;'>${item.pattern.enName}</small></td>\n                  <td><span class='pattern-type ${getTypeClass(item.pattern.type)}'>\n                      ${getTypeText(item.pattern.type)}</span></td>\n                  <td style='font-size: 1.25rem;'>${getBullishIcon(item.pattern.bullish)}</td>\n                </tr>\n              `;\n            });\n          }\n          \n          html += `</tbody></table>`;\n          document.getElementById('table-container').innerHTML = html;\n        }\n        \n        function renderPagination() {\n          const totalPages = Math.ceil(patterns.length / HISTORY_PAGE_SIZE);\n          const container = document.getElementById('pagination-container');\n          \n          let html = `\n            <button class='btn' onclick='prevPage()' ${page === 1 ? 'disabled' : ''}>\n              ← 上一頁\n            </button>\n            <span style='color: #6b7280; font-size: 0.875rem;'>\n              第 ${page} / ${totalPages} 頁 (共 ${patterns.length} 筆)\n            </span>\n            <button class='btn' onclick='nextPage()' ${page === totalPages ? 'disabled' : ''}>\n              下一頁 →\n            </button>\n          `;\n          \n          container.innerHTML = html;\n        }\n        \n        function prevPage() { \n          if (page > 1) { \n            page--; \n            renderTable(); \n            renderPagination(); \n          } \n        }\n        \n        function nextPage() { \n          const totalPages = Math.ceil(patterns.length / HISTORY_PAGE_SIZE);\n          if (page < totalPages) { \n            page++; \n            renderTable(); \n            renderPagination(); \n          } \n        }\n        \n        // 初始化\n        renderStats();\n        renderTable();\n        renderPagination();\n      <\/script>\n    </body>\n    </html>"),l=window.open("","_blank");l&&(l.document.write(n),l.document.close())},[o]),[E,T]=(0,r.useState)(null);return(0,r.useCallback)(e=>t=>{t.stopPropagation(),T({pattern:e,x:t.clientX,y:t.clientY})},[]),r.useEffect(()=>{if(!E)return;let e=()=>T(null);return window.addEventListener("mousedown",e),window.addEventListener("scroll",e,!0),()=>{window.removeEventListener("mousedown",e),window.removeEventListener("scroll",e,!0)}},[E]),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 border border-gray-200 mt-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:"K線型態分析"}),i&&(0,l.jsx)("span",{className:"text-xs px-2 py-1 bg-green-100 text-green-700 rounded",children:"快取已啟用"})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)("select",{value:m,onChange:e=>h(e.target.value),className:"text-sm px-2 py-1 border rounded",children:[(0,l.jsx)("option",{value:"all",children:"所有型態"}),(0,l.jsx)("option",{value:G.REVERSAL,children:"反轉型態"}),(0,l.jsx)("option",{value:G.CONTINUATION,children:"延續型態"}),(0,l.jsx)("option",{value:G.INDECISION,children:"猶豫型態"})]}),(0,l.jsxs)("select",{value:u,onChange:e=>g(e.target.value),className:"text-sm px-2 py-1 border rounded",children:[(0,l.jsx)("option",{value:"strength",children:"信號強度"}),(0,l.jsx)("option",{value:"name",children:"名稱"})]}),(0,l.jsxs)("button",{className:"px-3 py-1 bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 transition",onClick:()=>C(w,10),children:["查看最近 ",o," 天的歷史型態 (",w.length,")"]})]})]}),p?M?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("span",{className:"text-2xl ".concat(ew(M.bullish)),children:ek(M.bullish)}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-lg font-bold text-gray-800",children:M.name}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:M.enName})]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsxs)("div",{className:"inline-block px-2 py-1 rounded-full text-xs font-medium ".concat(eN(M.type)),children:[M.type===G.REVERSAL&&"反轉",M.type===G.CONTINUATION&&"延續",M.type===G.INDECISION&&"猶豫"]}),(0,l.jsx)("div",{className:"mt-1",children:ej(M.strength)})]})]}),(0,l.jsx)("p",{className:"text-gray-700 mb-2",children:M.description})]}),N.length>1&&(0,l.jsxs)("div",{className:"mt-6",children:[(0,l.jsxs)("h4",{className:"text-md font-semibold text-gray-700 mb-3",children:["其他檢測型態 (",N.length-1," 個)"]}),(0,l.jsx)("div",{className:"grid gap-3 md:grid-cols-2",children:N.slice(1).map((e,t)=>(0,l.jsx)(eM,{pattern:e,onClick:()=>d(e)},t))})]})]}):(0,l.jsxs)("div",{className:"text-center py-8",children:[(0,l.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDD0D"}),(0,l.jsx)("p",{className:"text-gray-500 mb-1",children:"未發現明顯型態"}),(0,l.jsx)("p",{className:"text-xs text-gray-400",children:"當前K線數據不符合任何已知的技術分析型態"}),p&&(0,l.jsx)("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg max-w-md mx-auto",children:(0,l.jsxs)("div",{className:"text-xs text-gray-600 grid grid-cols-2 gap-2",children:[(0,l.jsxs)("div",{children:["開盤: ",p.open.toFixed(2)]}),(0,l.jsxs)("div",{children:["收盤: ",p.close.toFixed(2)]}),(0,l.jsxs)("div",{children:["最高: ",p.high.toFixed(2)]}),(0,l.jsxs)("div",{children:["最低: ",p.low.toFixed(2)]})]})})]}):(0,l.jsx)("div",{className:"text-center py-8",children:(0,l.jsx)("p",{className:"text-gray-500",children:"暫無K線數據"})})]})};eC.displayName="KLinePattern",eM.displayName="PatternCard";let eE=(0,r.memo)(eC),eT=[{key:"chart",label:"圖表",icon:(0,l.jsx)(f.A,{className:"h-5 w-5 inline-block align-text-bottom"})},{key:"table",label:"數據",icon:(0,l.jsx)(j.A,{className:"h-5 w-5 inline-block align-text-bottom"})}],eR=()=>{let[e,t]=(0,r.useState)({symbol:"",market:"market_stock_tw"}),[n,i]=(0,r.useState)("chart"),[o,s]=(0,r.useState)("1d"),[c,d]=(0,r.useState)("1Y"),{data:m,loading:h,error:u,stats:x,candlestickData:p,technicalData:b,refetch:f,clearError:v}=U(e.symbol,o,e.market),N=(0,r.useCallback)(e=>{t(t=>({...t,symbol:e}))},[]),w=(0,r.useCallback)(e=>{t(t=>({...t,market:e}))},[]),j=(0,r.useCallback)((e,n)=>{t({symbol:e,market:n})},[]),M=(0,r.useCallback)(e=>{s(e)},[]),C=(0,r.useCallback)(e=>{d(e)},[]),E=(0,r.useMemo)(()=>null==p?void 0:p.slice(-1)[0],[p]),T=(0,r.useCallback)(()=>(0,l.jsxs)(l.Fragment,{children:[E&&(0,l.jsx)(eE,{candlestickData:p,enableCache:!0,historicalDays:30,onPatternDetected:e=>{console.log("檢測到型態:",e)}}),(0,l.jsx)(B,{technicalData:b,symbol:e.symbol,timeframe:o,open_price:null==E?void 0:E.open,high_price:null==E?void 0:E.high,low_price:null==E?void 0:E.low,close_price:null==E?void 0:E.close,volume:null==E?void 0:E.volume,loading:h,candlestickData:p})]}),[E,p,b,e.symbol,o,h]),R=(0,r.useCallback)(()=>{if(h)return(0,l.jsx)(A,{});if(u)return(0,l.jsx)(L,{error:u,onRetry:f,onClear:v});if(!m||0===m.length)return(0,l.jsx)(I,{onQuickSelect:N});switch(n){case"chart":return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(k,{data:p,technicalData:b,symbol:e.symbol,timeframe:o}),T()]});case"table":return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(D,{data:m,timeframe:o,symbol:e.symbol}),T()]});default:return null}},[h,u,m,n,p,b,e.symbol,o,f,v,N,T]);return(0,l.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6 space-y-6",children:[(0,l.jsx)(a.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:(0,l.jsx)(g,{symbol:e.symbol,onSymbolChange:N,timeframe:o,onTimeframeChange:M,loading:h,dataPeriod:c,onDataPeriodChange:C,market:e.market,onMarketChange:w,onSymbolAndMarketChange:j})}),m&&m.length>0&&(0,l.jsx)(a.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"flex justify-center mb-6",children:(0,l.jsx)("div",{className:"bg-white rounded-lg p-1 shadow-sm border border-gray-200",children:(0,l.jsx)("div",{className:"flex space-x-1",children:eT.map(e=>(0,l.jsxs)(a.P.button,{onClick:()=>i(e.key),className:"px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 ".concat(n===e.key?"bg-gray-900 text-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"),children:[(0,l.jsx)("span",{className:"mr-2",children:e.icon}),e.label]},e.key))})})}),x&&m&&m.length>0&&!h&&!u?(0,l.jsx)(a.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:(0,l.jsx)(y,{symbol:e.symbol,stats:x,timeframe:o})}):null,R()]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[637,636,593,792],()=>t(3956)),_N_E=e.O()}]);