(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[672],{3956:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/test/stock-query",function(){return a(7807)}])},7807:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>L});var r=a(7876),l=a(4232),s=a(2579),n=a(7212),i=a(3362),o=a(1151),c=a(5395),d=a(9694);let m=[{value:"market_stock_tw",label:"台股",color:"bg-blue-100 text-blue-700 border-blue-200"},{value:"market_stock_us",label:"美股",color:"bg-red-100 text-red-700 border-red-200"},{value:"market_etf",label:"ETF",color:"bg-green-100 text-green-700 border-green-200"},{value:"market_index",label:"指數",color:"bg-orange-100 text-orange-700 border-orange-200"},{value:"market_forex",label:"外匯",color:"bg-purple-100 text-purple-700 border-purple-200"},{value:"market_crypto",label:"加密貨幣",color:"bg-yellow-100 text-yellow-700 border-yellow-200"},{value:"market_futures",label:"期貨",color:"bg-pink-100 text-pink-700 border-pink-200"}],x=[{symbol:"2330",name:"台積電",type:"上市",market:"market_stock_tw"},{symbol:"9950",name:"萬國通",type:"上櫃",market:"market_stock_tw"},{symbol:"AAPL",name:"Apple",type:"US",market:"market_stock_us"},{symbol:"TSLA",name:"Tesla",type:"US",market:"market_stock_us"},{symbol:"000001.SS",name:"上證綜合指數",type:"CN",market:"market_index"},{symbol:"^DJI",name:"道瓊工業指數",type:"US",market:"market_index"},{symbol:"^GSPC",name:"標普500指數",type:"US",market:"market_index"},{symbol:"^N225",name:"日經225指數",type:"JP",market:"market_index"},{symbol:"^TWII",name:"台灣加權指數",type:"TW",market:"market_index"},{symbol:"^TWOII",name:"台灣櫃買指數",type:"TWO",market:"market_index"},{symbol:"0050",name:"元大台灣50",type:"ETF",market:"market_etf"},{symbol:"00878",name:"國泰永續高股息",type:"ETF",market:"market_etf"},{symbol:"TWD=X",name:"美元/台幣",type:"外匯",market:"market_forex"},{symbol:"JPYTWD=X",name:"日圓/台幣",type:"外匯",market:"market_forex"},{symbol:"CL=F",name:"原油",type:"期貨",market:"market_futures"},{symbol:"GC=F",name:"黃金",type:"期貨",market:"market_futures"},{symbol:"BTC-USD",name:"Bitcoin",type:"Crypto",market:"market_crypto"},{symbol:"ETH-USD",name:"Ethereum",type:"Crypto",market:"market_crypto"}],u=e=>{let{symbol:t,onSymbolChange:a,timeframe:u,onTimeframeChange:h,loading:g=!1,onSearch:y,market:p,onMarketChange:b}=e,[f,v]=(0,l.useState)(!1),[w,j]=(0,l.useState)(!1),[N,k]=(0,l.useState)(-1),[_,C]=(0,l.useState)(t),S=(0,l.useRef)(null),M=function(e,t){let[a,r]=(0,l.useState)(e);return(0,l.useEffect)(()=>{let t=setTimeout(()=>r(e),300);return()=>clearTimeout(t)},[e,300]),a}(_,300),A=(0,l.useMemo)(()=>M.trim()?x.filter(e=>e.symbol.toLowerCase().includes(M.toLowerCase())||e.name.toLowerCase().includes(M.toLowerCase())):[],[M]);function T(e,t){C(e),t&&t!==p&&b(t),a(e),j(!1),k(-1)}return(0,l.useEffect)(()=>{C(t)},[t]),(0,r.jsx)("div",{className:"w-full",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mt-4",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-6 xl:flex-row xl:gap-4 xl:items-end",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-[220px]",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,r.jsx)(i.A,{className:"w-4 h-4 inline mr-1"}),"金融代號"]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",value:_,onChange:function(e){let t=e.target.value.toUpperCase();C(t),j(!!t.trim()),k(-1)},onKeyDown:function(e){if(!w||0===A.length){"Enter"===e.key&&(e.preventDefault(),!g&&_.trim()&&(a(_),y()));return}"ArrowDown"===e.key?(e.preventDefault(),k(e=>e<A.length-1?e+1:0)):"ArrowUp"===e.key?(e.preventDefault(),k(e=>e>0?e-1:A.length-1)):"Enter"===e.key?(e.preventDefault(),N>=0?T(A[N].symbol):!g&&_.trim()&&(a(_),y(),j(!1))):"Escape"===e.key&&(j(!1),k(-1))},onFocus:function(){v(!0),_.trim()&&A.length>0&&j(!0)},onBlur:function(){v(!1),setTimeout(()=>j(!1),150)},placeholder:"輸入金融代號 (例: 2330, AAPL, 0050, CL=F)",className:"w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-gray-900 focus:border-gray-900 transition-colors",disabled:g,"aria-autocomplete":"list","aria-controls":"stock-suggestions","aria-activedescendant":N>=0?"suggestion-".concat(N):void 0}),g&&(0,r.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,r.jsx)(o.A,{className:"w-5 h-5 text-gray-500 animate-spin"})}),(0,r.jsx)(n.N,{children:w&&A.length>0&&(0,r.jsx)(s.P.div,{ref:S,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute z-20 left-0 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-48 overflow-y-auto",id:"stock-suggestions",role:"listbox",children:A.map((e,t)=>(0,r.jsxs)("button",{id:"suggestion-".concat(t),onClick:()=>{T(e.symbol)},className:"w-full px-4 py-3 text-left hover:bg-gray-50 focus:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0 ".concat(t===N?"bg-gray-50":""),role:"option","aria-selected":t===N,children:[(0,r.jsxs)("div",{className:"font-medium text-gray-900",children:[e.symbol,(0,r.jsx)("span",{className:"ml-2 px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded",children:e.type})]}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.name})]},e.symbol))})})]})]}),(0,r.jsx)("div",{className:"max-w-[320px] flex flex-col items-start",children:(0,r.jsxs)("div",{className:"flex flex-wrap w-full",children:[(0,r.jsx)("div",{className:"flex w-full gap-2 mb-2",children:m.slice(0,4).map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>b(e.value),className:"flex-1 flex items-center gap-1 px-3 py-1 rounded-md font-medium text-sm border transition-all duration-150\n                    ".concat(p===e.value?"".concat(e.color," shadow"):"bg-white text-gray-600 border-gray-300 hover:bg-gray-50","\n                  "),disabled:g,"aria-pressed":p===e.value,children:e.label},e.value))}),(0,r.jsx)("div",{className:"flex w-full gap-2",children:m.slice(4).map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>b(e.value),className:"flex-1 flex items-center gap-1 px-3 py-1 rounded-md font-medium text-sm border transition-all duration-150\n                    ".concat(p===e.value?"".concat(e.color," shadow"):"bg-white text-gray-600 border-gray-300 hover:bg-gray-50","\n                  "),disabled:g,"aria-pressed":p===e.value,children:e.label},e.value))})]})}),(0,r.jsxs)("div",{className:"min-w-[140px] flex flex-col items-start",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,r.jsx)(c.A,{className:"w-4 h-4 inline mr-1"}),"時間週期"]}),(0,r.jsx)("div",{className:"flex bg-gray-100 p-1 rounded-md w-full",children:[{value:"1d",label:"日線"},{value:"1h",label:"小時線"}].map(e=>(0,r.jsx)("button",{onClick:()=>h(e.value),className:"flex-1 px-3 py-2 text-sm font-medium rounded transition-all duration-200 ".concat(u===e.value?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),type:"button",children:e.label},e.value))})]}),(0,r.jsx)("div",{className:"w-[120px] flex flex-col items-end justify-end",children:(0,r.jsx)(s.P.button,{whileHover:{scale:g?1:1.02},whileTap:{scale:g?1:.98},onClick:()=>{a(_),y()},disabled:g||!_.trim(),className:"px-4 py-3 bg-gray-900 text-white rounded-md hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium w-full",type:"button",children:g?(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[(0,r.jsx)(o.A,{className:"w-4 h-4 mr-2 animate-spin"}),"查詢中"]}):"查詢"})})]}),(0,r.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-600 mb-3 flex items-center",children:[(0,r.jsx)(d.A,{className:"w-4 h-4 mr-1"}),"熱門股票"]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:x.map(e=>(0,r.jsxs)(s.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onMouseDown:()=>{C(e.symbol)},onClick:()=>T(e.symbol,e.market),className:"px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md transition-colors flex items-center gap-1",type:"button",children:[(0,r.jsx)("span",{className:"font-medium",children:e.symbol}),(0,r.jsx)("span",{className:"text-gray-500",children:e.name}),(0,r.jsx)("span",{className:"px-1 py-0.5 text-xs bg-gray-200 text-gray-600 rounded",children:e.type})]},e.symbol))})]})]})})};var h=a(5364),g=a(365);let y=e=>{let{symbol:t,stats:a,timeframe:l}=e,s=e=>e?e.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","):"--",n=a.change>=0;return(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-100 p-6 shadow-sm hover:shadow-lg transition-shadow duration-200",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"p-3 bg-gray-50 rounded-xl flex items-center justify-center",children:(0,r.jsx)(h.A,{className:"h-7 w-7 text-gray-500"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-extrabold text-gray-900 tracking-tight leading-tight mb-1",children:t}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-gray-500",children:[(0,r.jsx)("span",{className:"font-medium",children:"1d"===l?"日線":"小時線"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"|"}),(0,r.jsxs)("span",{children:["最後更新：",(e=>{if(!e)return"--";try{let t=new Date(e);if(isNaN(t.getTime())){let a=e.replace("T"," ").replace("Z","");t=new Date(a)}if(isNaN(t.getTime()))return e;let a=t.getUTCFullYear(),r=String(t.getUTCMonth()+1).padStart(2,"0"),s=String(t.getUTCDate()).padStart(2,"0");if("1d"===l)return"".concat(a,"/").concat(r,"/").concat(s);{let e=String(t.getUTCHours()).padStart(2,"0"),l=String(t.getUTCMinutes()).padStart(2,"0");return"".concat(a,"/").concat(r,"/").concat(s," ").concat(e,":").concat(l)}}catch(t){return e}})(a.datetime)]})]})]})]}),(0,r.jsxs)("div",{className:"text-right min-w-[120px] flex flex-col items-end justify-center",children:[(0,r.jsx)("div",{className:"text-3xl font-extrabold mb-1 ".concat(n?"text-red-600":"text-green-600"),children:s(a.latest)}),(0,r.jsxs)("div",{className:"flex items-center text-base font-semibold ".concat(n?"text-red-600":"text-green-600"),children:[n?(0,r.jsx)(h.A,{className:"h-4 w-4 mr-1"}):(0,r.jsx)(g.A,{className:"h-4 w-4 mr-1"}),n?"+":"",a.change?a.change.toFixed(2):"0.00"," (",n?"+":"",a.changePercent?a.changePercent.toFixed(2):"0.00","% )"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center p-3 bg-gray-50 rounded-xl",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"開盤 (O)"}),(0,r.jsx)("span",{className:"text-lg font-bold text-gray-900",children:s(a.open_price||a.open)})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center p-3 bg-gray-50 rounded-xl",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"最高 (H)"}),(0,r.jsx)("span",{className:"text-lg font-bold text-gray-900",children:s(a.high)})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center p-3 bg-gray-50 rounded-xl",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"最低 (L)"}),(0,r.jsx)("span",{className:"text-lg font-bold text-gray-900",children:s(a.low)})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center p-3 bg-gray-50 rounded-xl",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"收盤 (C)"}),(0,r.jsx)("span",{className:"text-lg font-bold ".concat(n?"text-red-600":"text-green-600"),children:s(a.latest)})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center p-3 bg-gray-50 rounded-xl",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"成交量 (V)"}),(0,r.jsx)("span",{className:"text-lg font-bold text-gray-900",children:(e=>e?e>=1e9?"".concat((e/1e9).toFixed(1),"B"):e>=1e6?"".concat((e/1e6).toFixed(1),"M"):e>=1e3?"".concat((e/1e3).toFixed(1),"K"):e.toLocaleString():"N/A")(a.volume)})]})]})]})};var p=a(7178),b=a(9252),f=a(3394),v=a(8621);let w=e=>{var t;let{data:a,technicalData:i,title:o="K線圖",height:c=500,showVolume:d=!0,theme:m="light",timeframe:x="1d"}=e,u=(0,l.useRef)(null),h=(0,l.useRef)(null),g=(0,l.useRef)(null),y=(0,l.useRef)(null),w=(0,l.useRef)(new Map),[j,N]=(0,l.useState)(!1),[k,_]=(0,l.useState)(!1),[C,S]=(0,l.useState)("移動平均"),[M,A]=(0,l.useState)(null),[T,D]=(0,l.useState)(null),E=(0,l.useMemo)(()=>[{key:"ma5",name:"MA5",color:"#3b82f6",enabled:!0,lineWidth:2,category:"移動平均",description:"5日移動平均線",overlay:!0},{key:"ma10",name:"MA10",color:"#f59e0b",enabled:!0,lineWidth:2,category:"移動平均",description:"10日移動平均線",overlay:!0},{key:"ma20",name:"MA20",color:"#ef4444",enabled:!1,lineWidth:2,category:"移動平均",description:"20日移動平均線",overlay:!0},{key:"ma60",name:"MA60",color:"#8b5cf6",enabled:!1,lineWidth:2,category:"移動平均",description:"60日移動平均線",overlay:!0},{key:"ema12",name:"EMA12",color:"#06b6d4",enabled:!1,lineWidth:2,category:"移動平均",description:"12日指數移動平均",overlay:!0},{key:"ema26",name:"EMA26",color:"#84cc16",enabled:!1,lineWidth:2,category:"移動平均",description:"26日指數移動平均",overlay:!0},{key:"bb_upper",name:"布林上軌",color:"#f87171",enabled:!1,lineWidth:1,category:"布林通道",description:"布林帶上軌",overlay:!0},{key:"bb_middle",name:"布林中軌",color:"#fbbf24",enabled:!1,lineWidth:2,category:"布林通道",description:"布林帶中軌",overlay:!0},{key:"bb_lower",name:"布林下軌",color:"#34d399",enabled:!1,lineWidth:1,category:"布林通道",description:"布林帶下軌",overlay:!0},{key:"rsi_5",name:"RSI(5)",color:"#ef4444",enabled:!1,lineWidth:2,category:"震盪指標",description:"5日相對強弱指標",overlay:!1},{key:"rsi_7",name:"RSI(7)",color:"#f59e0b",enabled:!1,lineWidth:2,category:"震盪指標",description:"7日相對強弱指標",overlay:!1},{key:"rsi_14",name:"RSI(14)",color:"#8b5cf6",enabled:!1,lineWidth:2,category:"震盪指標",description:"14日相對強弱指標",overlay:!1},{key:"rsi_21",name:"RSI(21)",color:"#06b6d4",enabled:!1,lineWidth:2,category:"震盪指標",description:"21日相對強弱指標",overlay:!1},{key:"macd",name:"MACD",color:"#3b82f6",enabled:!1,lineWidth:2,category:"趨勢指標",description:"MACD快線",overlay:!1},{key:"dif",name:"DIF",color:"#ef4444",enabled:!1,lineWidth:2,category:"趨勢指標",description:"MACD慢線",overlay:!1},{key:"k_value",name:"K值",color:"#3b82f6",enabled:!1,lineWidth:2,category:"隨機指標",description:"隨機指標K值",overlay:!1},{key:"d_value",name:"D值",color:"#ef4444",enabled:!1,lineWidth:2,category:"隨機指標",description:"隨機指標D值",overlay:!1},{key:"j_value",name:"J值",color:"#f59e0b",enabled:!1,lineWidth:2,category:"隨機指標",description:"隨機指標J值",overlay:!1},{key:"atr",name:"ATR",color:"#84cc16",enabled:!1,lineWidth:2,category:"其他指標",description:"平均真實波幅",overlay:!1},{key:"cci",name:"CCI",color:"#06b6d4",enabled:!1,lineWidth:2,category:"其他指標",description:"順勢指標",overlay:!1},{key:"willr",name:"WillR",color:"#8b5cf6",enabled:!1,lineWidth:2,category:"其他指標",description:"威廉指標",overlay:!1},{key:"mom",name:"MOM",color:"#f87171",enabled:!1,lineWidth:2,category:"其他指標",description:"動量指標",overlay:!1}],[]),[W,R]=(0,l.useState)(E),F=(0,l.useMemo)(()=>{let e={};return W.forEach(t=>{e[t.category]||(e[t.category]=[]),e[t.category].push(t)}),e},[W]),P=(0,l.useMemo)(()=>{if(!(null==a?void 0:a.length))return null;try{let e=a.map(e=>({time:Math.floor(new Date(e.date).getTime()/1e3),open:Number(e.open)||0,high:Number(e.high)||0,low:Number(e.low)||0,close:Number(e.close)||0})).filter(e=>e.open>0&&e.high>0&&e.low>0&&e.close>0),t=a.filter(e=>e.volume&&Number(e.volume)>0).map(e=>({time:Math.floor(new Date(e.date).getTime()/1e3),value:Number(e.volume),color:e.close>=e.open?"#ef444460":"#10b98160"}));return{candleData:e,volumeData:t}}catch(e){return console.error("Chart data conversion error:",e),null}},[a]),U=(0,l.useMemo)(()=>{if(!i||!(null==a?void 0:a.length))return{overlay:{},separate:{}};let e={},t={};return W.filter(e=>e.enabled).forEach(r=>{let l=i[r.key];if(!(null==l?void 0:l.length))return void console.warn("No data found for indicator: ".concat(r.key));console.log("Processing indicator: ".concat(r.key,", values length: ").concat(l.length,", data length: ").concat(a.length));try{let s=[],n=a.length,i=l.length;for(let e=0;e<Math.min(n,i);e++){let t=l[e],r=a[e];if(null!=t&&!isNaN(Number(t))&&r&&r.date){let e=Math.floor(new Date(r.date).getTime()/1e3);s.push({time:e,value:Number(t)})}}s.sort((e,t)=>e.time-t.time),s.length>0?r.overlay?(e[r.key]=s,console.log("Added overlay indicator: ".concat(r.key,", data points: ").concat(s.length))):(t[r.key]=s,console.log("Added separate indicator: ".concat(r.key,", data points: ").concat(s.length))):console.warn("No valid data points for indicator: ".concat(r.key))}catch(e){console.error("Error processing indicator ".concat(r.key,":"),e)}}),{overlay:e,separate:t}},[i,a,W]);(0,l.useMemo)(()=>{if(!(null==a?void 0:a.length))return null;try{let e=a[a.length-1],t=a.length>1?a[a.length-2]:e,r=Number(e.close)-Number(t.close),l=r/Number(t.close)*100;return{latest:e,change:r,changePercent:l,isRising:r>=0,high:Math.max(...a.map(e=>Number(e.high))),low:Math.min(...a.map(e=>Number(e.low)))}}catch(e){return console.error("Stats calculation error:",e),null}},[a]),(0,l.useEffect)(()=>{if(!u.current||!P)return;let e="dark"===m;try{h.current&&h.current.remove(),w.current.clear();let t=(0,p.R9)(u.current,{layout:{background:{type:p.mE.Solid,color:e?"#1f2937":"#ffffff"},textColor:e?"#e5e7eb":"#374151"},width:u.current.clientWidth,height:j?window.innerHeight-200:c,grid:{vertLines:{color:e?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},horzLines:{color:e?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}},crosshair:{mode:1},rightPriceScale:{borderColor:e?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)",scaleMargins:{top:.1,bottom:d?.3:.1}},timeScale:{borderColor:e?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)",timeVisible:"1h"===x,secondsVisible:!1},localization:{locale:"zh-TW"}});h.current=t;let r=t.addCandlestickSeries({upColor:"#ef4444",downColor:"#10b981",borderUpColor:"#dc2626",borderDownColor:"#059669",wickUpColor:"#dc2626",wickDownColor:"#059669",priceLineVisible:!0,lastValueVisible:!0});if(g.current=r,r.setData(P.candleData),d&&P.volumeData.length>0){let e=t.addHistogramSeries({color:"#26a69a",priceFormat:{type:"volume"},priceScaleId:"volume"});t.priceScale("volume").applyOptions({scaleMargins:{top:.8,bottom:0},borderVisible:!1}),y.current=e,e.setData(P.volumeData)}let l=Object.keys(U.overlay);if(l.length>0){let e=new Map;l.forEach(a=>{let r=U.overlay[a],l=W.find(e=>e.key===a);if(l&&r&&r.length>0){console.log("Creating overlay series for ".concat(l.name," with ").concat(r.length," data points"));let s=t.addLineSeries({color:l.color,lineWidth:l.lineWidth||2,title:l.name,priceLineVisible:!1,lastValueVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4});try{s.setData(r),e.set(a,s),console.log("Successfully added overlay indicator: ".concat(l.name))}catch(e){console.error("Error setting data for overlay indicator ".concat(l.name,":"),e)}}}),w.current=e}let s=Object.keys(U.separate);s.length>0&&s.forEach(e=>{let a=U.separate[e],r=W.find(t=>t.key===e);if(r&&a&&a.length>0){console.log("Creating separate indicator series for ".concat(r.name," with ").concat(a.length," data points"));let l="indicator_".concat(e),s=t.addLineSeries({color:r.color,lineWidth:r.lineWidth||2,title:r.name,priceLineVisible:!1,lastValueVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,priceScaleId:l});t.priceScale(l).applyOptions({scaleMargins:{top:.7,bottom:.1},borderVisible:!1});try{s.setData(a),w.current||(w.current=new Map),w.current.set(e,s),console.log("Successfully added separate indicator: ".concat(r.name))}catch(e){console.error("Error setting data for separate indicator ".concat(r.name,":"),e)}}}),t.subscribeCrosshairMove(e=>{if(e&&e.time&&e.point)if(P.candleData.find(t=>t.time===e.time)){let t=a[P.candleData.findIndex(t=>t.time===e.time)];A(t||null),D({x:e.point.x,y:e.point.y})}else A(null),D(null);else A(null),D(null)}),console.log("Chart initialized with ".concat(l.length," overlay and ").concat(s.length," separate indicators"))}catch(e){console.error("Chart initialization error:",e)}return()=>{h.current&&(h.current.remove(),h.current=null),g.current=null,y.current=null,w.current.clear()}},[P,U,d,m,c,j,x,W]),(0,l.useEffect)(()=>{j&&window.scrollTo({top:0,behavior:"smooth"})},[j]),(0,l.useEffect)(()=>{let e=()=>{h.current&&u.current&&h.current.applyOptions({width:u.current.clientWidth,height:j?window.innerHeight-180:c})};if(j)return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[j,c]);let L=(0,l.useCallback)(e=>{R(t=>t.map(t=>t.key===e?{...t,enabled:!t.enabled}:t))},[]),I=(0,l.useCallback)(e=>{let t={基礎分析:["ma5","ma10","ma20"],短線交易:["ma5","ma10","rsi_14","k_value","d_value"],趨勢分析:["ma20","ma60","macd","dif","bb_upper","bb_middle","bb_lower"],全面分析:["ma5","ma10","ma20","rsi_14","macd","k_value","d_value"]}[e]||[];R(e=>e.map(e=>({...e,enabled:t.includes(e.key)})))},[]),V=(0,l.useCallback)(()=>{R(e=>e.map(e=>({...e,enabled:!1})))},[]);return P?(0,r.jsxs)("div",{className:"relative bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden ".concat(j?"fixed inset-0 z-[9999] m-0 rounded-none shadow-lg":""),children:[(0,r.jsx)("div",{className:"bg-gray-50 border-b border-gray-200 px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"p-2 bg-gray-100 rounded-lg",children:(0,r.jsx)(b.A,{className:"h-5 w-5 text-gray-600"})}),(0,r.jsx)("h3",{className:"pt-2 text-2xl font-semibold text-gray-900",children:o}),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["1d"===x?"日線":"小時線"," • ",a.length," 筆數據 •"," ",(e=>{if(!e||0===e.length)return"--";let t=e=>{if(!e)return"--";let t=new Date(e.datetime||e.date);if(isNaN(t.getTime()))return"--";let a=t.getUTCFullYear(),r=String(t.getUTCMonth()+1).padStart(2,"0"),l=String(t.getUTCDate()).padStart(2,"0");if("1d"===x)return"".concat(a,"-").concat(r,"-").concat(l);{let e=String(t.getUTCHours()).padStart(2,"0"),s=String(t.getUTCMinutes()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(l," ").concat(e,":").concat(s)}};return"".concat(t(e[0])," ~ ").concat(t(e[e.length-1]))})(a)]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>_(!k),className:"px-3 py-2 text-sm font-medium rounded-md transition-colors ".concat(k?"bg-gray-900 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:"技術指標設定"}),(0,r.jsx)("button",{onClick:()=>N(!j),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors",title:j?"退出全屏":"進入全屏",children:j?(0,r.jsx)(f.A,{className:"h-4 w-4"}):(0,r.jsx)(v.A,{className:"h-4 w-4"})})]})]})}),(0,r.jsx)(n.N,{children:k&&(0,r.jsx)(s.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"border-b border-gray-200 bg-white",children:(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"快速設定:"}),["基礎分析","短線交易","趨勢分析","全面分析"].map(e=>(0,r.jsx)("button",{onClick:()=>I(e),className:"px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md transition-colors",children:e},e)),(0,r.jsx)("button",{onClick:V,className:"px-3 py-1 text-xs bg-red-100 hover:bg-red-200 text-red-700 rounded-md transition-colors",children:"全部關閉"})]})}),(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)("div",{className:"flex gap-2",children:Object.keys(F).map(e=>(0,r.jsx)("button",{onClick:()=>S(e),className:"px-3 py-1 text-sm rounded-md transition-colors ".concat(C===e?"bg-gray-900 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e},e))})}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:null==(t=F[C])?void 0:t.map(e=>(0,r.jsxs)("label",{className:"flex flex-col items-start p-3 rounded-md border cursor-pointer transition-colors ".concat(e.enabled?"border-gray-900 bg-gray-50":"border-gray-200 bg-white hover:border-gray-300"),children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:e.enabled,onChange:()=>L(e.key),className:"sr-only"}),(0,r.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.name})]}),e.description&&(0,r.jsx)("span",{className:"mt-1 text-xs text-gray-500",children:e.description})]},e.key))})]})})}),(0,r.jsxs)("div",{className:"p-4 relative",children:[M&&T&&(0,r.jsxs)("div",{className:"absolute z-10 bg-white/90 border border-gray-200 rounded shadow px-4 py-2 text-xs text-gray-800 pointer-events-none min-w-[140px]",style:{left:"calc(".concat(T.x,"px + 24px)"),top:"calc(".concat(T.y,"px + 12px)"),maxWidth:"220px"},children:[(0,r.jsxs)("div",{children:["日期: ",function(e,t){let a=new Date(e);if(isNaN(a.getTime()))return e;let r=e=>e.toString().padStart(2,"0"),l=a.getFullYear(),s=r(a.getMonth()+1),n=r(a.getDate());if("1d"===t)return"".concat(l,"-").concat(s,"-").concat(n);{let e=r(a.getHours()),t=r(a.getMinutes()),i=r(a.getSeconds());return"".concat(l,"-").concat(s,"-").concat(n," ").concat(e,":").concat(t,":").concat(i)}}(M.date,x)]}),(0,r.jsxs)("div",{children:["開盤: ",M.open]}),(0,r.jsxs)("div",{children:["最高: ",M.high]}),(0,r.jsxs)("div",{children:["最低: ",M.low]}),(0,r.jsxs)("div",{children:["收盤: ",M.close]}),void 0!==M.volume&&(0,r.jsxs)("div",{children:["成交量: ",M.volume]}),i&&W.filter(e=>e.enabled).length>0&&(0,r.jsxs)("div",{className:"mt-2 border-t pt-1 border-gray-200",children:[(0,r.jsx)("div",{className:"font-semibold text-gray-700 mb-1",children:"技術指標"}),(()=>{let e=a.findIndex(e=>e.date===M.date);return W.filter(e=>e.enabled).map(t=>{let a=i[t.key],l=a&&null!=a[e]?a[e]:void 0;return(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"inline-block w-2 h-2 rounded-full",style:{background:t.color}}),(0,r.jsxs)("span",{children:[t.name,":"]}),(0,r.jsx)("span",{children:void 0!==l?Number(l).toFixed(2):"--"})]},t.key)})})()]})]}),(0,r.jsx)("div",{ref:u,style:{height:j?"calc(100vh - 150px)":"".concat(c,"px"),width:"100%"},className:"bg-white rounded border border-gray-100"})]}),(0,r.jsx)("div",{className:"bg-gray-50 px-6 py-2 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,r.jsxs)("span",{children:["數據點: ",a.length," | 週期:"," ","1d"===x?"日線":"小時線"]}),(0,r.jsx)("div",{className:"text-center text-[12px] select-none",children:"Charting By TradingView Lightweight Charts"}),W.filter(e=>e.enabled).length>0&&(0,r.jsxs)("span",{children:["啟用指標:"," ",W.filter(e=>e.enabled).length]})]})})]}):(0,r.jsx)("div",{className:"flex items-center justify-center bg-white rounded-lg border border-gray-200 shadow-sm",style:{height:"".concat(c,"px")},children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(b.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-700 mb-1",children:"暫無圖表數據"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"請提供有效的價格數據"})]})})},j=e=>{let{data:t,technicalData:a,symbol:l,timeframe:s}=e;return(0,r.jsx)(w,{data:t,technicalData:a,title:"".concat(l),height:600,showVolume:!0,timeframe:s,theme:"light"})};var N=a(2988),k=a(4717),_=a(2719),C=a(2077),S=a(3680);let M=[{key:"datetime",name:"時間",type:"datetime",width:"w-40"},{key:"open_price",name:"開盤",type:"price",width:"w-24"},{key:"high_price",name:"最高",type:"price_high",width:"w-24"},{key:"low_price",name:"最低",type:"price_low",width:"w-24"},{key:"close_price",name:"收盤",type:"price_close",width:"w-24"},{key:"volume",name:"成交量",type:"volume",width:"w-32"},{key:"rsi_5",name:"RSI(5)",type:"indicator",width:"w-20"},{key:"rsi_7",name:"RSI(7)",type:"indicator",width:"w-20"},{key:"rsi_10",name:"RSI(10)",type:"indicator",width:"w-20"},{key:"rsi_14",name:"RSI(14)",type:"indicator",width:"w-20"},{key:"rsi_21",name:"RSI(21)",type:"indicator",width:"w-20"},{key:"dif",name:"DIF",type:"indicator",width:"w-20"},{key:"macd",name:"MACD",type:"indicator",width:"w-20"},{key:"macd_histogram",name:"MACD Histogram",type:"indicator",width:"w-20"},{key:"rsv",name:"RSV",type:"indicator",width:"w-20"},{key:"k_value",name:"K值",type:"indicator",width:"w-20"},{key:"d_value",name:"D值",type:"indicator",width:"w-20"},{key:"j_value",name:"J值",type:"indicator",width:"w-20"},{key:"ma5",name:"MA5",type:"indicator",width:"w-20"},{key:"ma10",name:"MA10",type:"indicator",width:"w-20"},{key:"ma20",name:"MA20",type:"indicator",width:"w-20"},{key:"ma60",name:"MA60",type:"indicator",width:"w-20"},{key:"ema12",name:"EMA12",type:"indicator",width:"w-20"},{key:"ema26",name:"EMA26",type:"indicator",width:"w-20"},{key:"bb_upper",name:"布林上軌",type:"indicator",width:"w-20"},{key:"bb_middle",name:"布林中軌",type:"indicator",width:"w-20"},{key:"bb_lower",name:"布林下軌",type:"indicator",width:"w-20"},{key:"atr",name:"ATR平均真實波幅",type:"indicator",width:"w-20"},{key:"cci",name:"CCI商品通道指標",type:"indicator",width:"w-20"},{key:"willr",name:"威廉指標",type:"indicator",width:"w-20"},{key:"mom",name:"動量指標",type:"indicator",width:"w-20"}],A=e=>{let{data:t,timeframe:a,symbol:i}=e,[o,c]=(0,l.useState)("datetime"),[d,m]=(0,l.useState)("desc"),[x,u]=(0,l.useState)(1),[h,g]=(0,l.useState)(20),[y,p]=(0,l.useState)(!1),[b,f]=(0,l.useState)(["datetime","open_price","high_price","low_price","close_price","volume","rsi_14","ma5","macd","k_value","d_value"]),v=(e,t)=>{if(null==e||""===e)return"—";switch(t.type){case"datetime":return w(e);case"volume":return j(e);case"price":case"price_high":case"price_low":case"price_close":return Number(e).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",");case"indicator":return Number(e).toFixed(3).replace(/\B(?=(\d{3})+(?!\d))/g,",");default:return String(e)}},w=e=>{try{let t=new Date(e);if(isNaN(t.getTime()))return e;let r=t.getUTCFullYear(),l=String(t.getUTCMonth()+1).padStart(2,"0"),s=String(t.getUTCDate()).padStart(2,"0"),n=String(t.getUTCHours()).padStart(2,"0"),i=String(t.getUTCMinutes()).padStart(2,"0");return"1h"===a?"".concat(r,"/").concat(l,"/").concat(s," ").concat(n,":").concat(i):"".concat(r,"/").concat(l,"/").concat(s)}catch(t){return e}},j=e=>{let t=Number(e);return isNaN(t)?"—":t>=1e9?"".concat((t/1e9).toFixed(1),"B"):t>=1e6?"".concat((t/1e6).toFixed(1),"M"):t>=1e3?"".concat((t/1e3).toFixed(1),"K"):t.toLocaleString()},A=(0,l.useMemo)(()=>[...t].sort((e,t)=>{let a=e[o],r=t[o];if(null==a)return 1;if(null==r)return -1;let l=a>r?1:-1;return"asc"===d?l:-l}),[t,o,d]),T=(0,l.useMemo)(()=>{let e=(x-1)*h;return A.slice(e,e+h)},[A,x,h]),D=Math.ceil(A.length/h),E=e=>{o===e?m("asc"===d?"desc":"asc"):(c(e),m("desc")),u(1)},W=e=>{f(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},R=e=>{if(null==e)return"";let t=String(e);return/[",\n]/.test(t)?'"'+t.replace(/"/g,'""')+'"':t};return t&&0!==t.length?(0,r.jsxs)(s.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden",children:[(0,r.jsxs)("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"p-2 bg-gray-100 rounded-lg",children:(0,r.jsx)(N.A,{className:"h-5 w-5 text-gray-600"})}),(0,r.jsx)("h3",{className:"pt-2 text-2xl font-semibold text-gray-900",children:i}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["1d"===a?"日線":"小時線"," • ",t.length," 筆數據 •"," ",w(t[t.length-1].datetime)," ~"," ",w(t[0].datetime)]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("button",{onClick:()=>p(!y),className:"p-2 rounded-lg transition-all duration-200 flex items-center ".concat(y?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-500 hover:bg-gray-200"),title:"顯示/隱藏篩選器",children:[(0,r.jsx)(k.A,{className:"h-4 w-4 mr-1"}),(0,r.jsx)("span",{className:"text-sm font-normal",children:"篩選"})]}),(0,r.jsxs)("button",{onClick:()=>{let e=M.filter(e=>b.includes(e.key)).map(e=>R(e.name)).join(","),t=A.map(e=>M.filter(e=>b.includes(e.key)).map(t=>R(v(e[t.key],t))).join(",")).join("\n"),a=new Blob(["\uFEFF".concat(e,"\n").concat(t)],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download="stock_data_".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r)},className:"p-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200 transition-all duration-200 flex items-center",title:"匯出 CSV",children:[(0,r.jsx)(_.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"text-sm font-normal",children:"下載 CSV"})]})]})]}),(0,r.jsx)(n.N,{children:y&&(0,r.jsx)(s.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 pt-4 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"每頁顯示:"}),(0,r.jsxs)("select",{value:h,onChange:e=>{g(Number(e.target.value)),u(1)},className:"px-3 py-1 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:10,children:"10"}),(0,r.jsx)("option",{value:20,children:"20"}),(0,r.jsx)("option",{value:50,children:"50"}),(0,r.jsx)("option",{value:100,children:"100"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"顯示欄位:"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:M.map(e=>(0,r.jsx)("button",{onClick:()=>W(e.key),className:"px-2 py-1 text-xs rounded transition-colors ".concat(b.includes(e.key)?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-500"),children:e.name},e.key))})]})]})})})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,r.jsx)("tr",{children:M.filter(e=>b.includes(e.key)).map(e=>(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors ".concat(e.width||""),onClick:()=>E(e.key),children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{children:e.name}),o===e.key&&(0,r.jsx)(s.P.div,{initial:{scale:0},animate:{scale:1},className:"text-blue-500",children:"asc"===d?(0,r.jsx)(C.A,{className:"h-3 w-3"}):(0,r.jsx)(S.A,{className:"h-3 w-3"})})]})},e.key))})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-100",children:T.map((e,t)=>(0,r.jsx)(s.P.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.02*t},className:"hover:bg-blue-50 transition-colors",children:M.filter(e=>b.includes(e.key)).map(t=>(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm ".concat("datetime"===t.type?"text-gray-700 font-medium":"indicator"===t.type?"text-blue-600 font-mono":"text-gray-700"),children:v(e[t.key],t)},t.key))},t))})]})}),D>1&&(0,r.jsx)("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["顯示 ",(x-1)*h+1," -"," ",Math.min(x*h,A.length)," 筆， 共"," ",A.length," 筆記錄"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>u(1),disabled:1===x,className:"px-3 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:"首頁"}),(0,r.jsx)("button",{onClick:()=>u(Math.max(1,x-1)),disabled:1===x,className:"px-3 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:"上一頁"}),(0,r.jsxs)("span",{className:"px-3 py-1 text-sm",children:["第 ",x," / ",D," 頁"]}),(0,r.jsx)("button",{onClick:()=>u(Math.min(D,x+1)),disabled:x===D,className:"px-3 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:"下一頁"}),(0,r.jsx)("button",{onClick:()=>u(D),disabled:x===D,className:"px-3 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:"末頁"})]})]})})]}):(0,r.jsx)(s.P.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-8",children:(0,r.jsxs)("div",{className:"text-center py-20",children:[(0,r.jsx)(N.A,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-500 mb-2",children:"無可顯示的數據"}),(0,r.jsx)("p",{className:"text-gray-400",children:"請先查詢股票數據"})]})})},T=()=>(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"w-12 h-12 border-3 border-gray-300 border-t-gray-900 rounded-full animate-spin mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"正在載入數據"}),(0,r.jsx)("p",{className:"text-gray-500",children:"請稍候，正在處理股票資訊..."})]})});var D=a(3294),E=a(3532);let W=[{symbol:"2330",name:"台積電"},{symbol:"2454",name:"聯發科"},{symbol:"2317",name:"鴻海"},{symbol:"AAPL",name:"Apple"},{symbol:"TSLA",name:"Tesla"},{symbol:"NVDA",name:"NVIDIA"}],R=e=>{let{onQuickSelect:t}=e;return(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:(0,r.jsxs)("div",{className:"px-8 py-16 text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,r.jsx)(D.A,{className:"h-8 w-8 text-gray-600"})}),(0,r.jsx)("h2",{className:"text-2xl font-semibold text-gray-900 mb-3",children:"開始股票分析"}),(0,r.jsx)("p",{className:"text-gray-600 mb-8 max-w-md mx-auto",children:"輸入股票代號，獲得專業的技術分析和投資建議"}),(0,r.jsxs)("div",{className:"max-w-lg mx-auto",children:[(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-4",children:"熱門股票："}),(0,r.jsx)("div",{className:"flex flex-wrap justify-center gap-2",children:W.map(e=>(0,r.jsxs)("button",{onClick:()=>t(e.symbol),className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md text-sm transition-colors",children:[e.symbol," ",e.name]},e.symbol))})]})]})})},F=e=>{let{error:t,onRetry:a,onClear:l}=e;return(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:(0,r.jsx)("div",{className:"p-8",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,r.jsx)(E.A,{className:"h-8 w-8 text-red-500"})}),(0,r.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"查詢遇到問題"}),(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6 max-w-md mx-auto",children:(0,r.jsx)("p",{className:"text-red-700 text-sm",children:t})}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,r.jsx)("button",{onClick:a,className:"px-6 py-3 bg-gray-900 hover:bg-gray-800 text-white font-medium rounded-lg transition-colors",children:"重新查詢"}),(0,r.jsx)("button",{onClick:l,className:"px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg transition-colors",children:"清除錯誤"})]})]})})})},P={"1d":{name:"日線",table:"stock_data_1d"},"1h":{name:"時線",table:"stock_data_1h"}},U=(e,t,a)=>{let[r,s]=(0,l.useState)([]),[n,i]=(0,l.useState)(!1),[o,c]=(0,l.useState)(null),d=(0,l.useRef)(e);(0,l.useEffect)(()=>{d.current=e},[e]);let m=(0,l.useMemo)(()=>({server:"localhost",user:"testuser",password:"testuserPass123!",database:a,port:"1433"}),[a]),x=(0,l.useCallback)(async()=>{if(!e.trim())return;i(!0),c(null);let a=P[t].table;try{let t=await fetch("/api/database/execute-query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:m,query:"\n        SELECT\n          symbol, datetime, open_price, high_price, low_price, close_price, volume,\n          rsi_5, rsi_7, rsi_10, rsi_14, rsi_21,\n          dif, macd, macd_histogram,\n          rsv, k_value, d_value, j_value,\n          ma5, ma10, ma20, ma60, ema12, ema26,\n          bb_upper, bb_middle, bb_lower,\n          atr, cci, willr, mom\n        FROM ".concat(a,"\n        WHERE symbol = @symbol\n        ORDER BY datetime DESC\n      ").trim(),params:{symbol:e.toUpperCase()}})});if(d.current!==e)return;if(!t.ok)throw Error("查詢失敗: ".concat(t.status));let r=await t.json();if(r.success)s(r.data||[]),r.data&&0!==r.data.length||c("查無資料");else throw s([]),Error(r.error||"查詢失敗")}catch(t){if(d.current!==e)return;s([]),c(t instanceof Error?t.message:"未知錯誤")}finally{d.current===e&&i(!1)}},[e,t,a,m]),u=(0,l.useMemo)(()=>r.length?r.slice().reverse().filter(e=>void 0!==e.open_price&&void 0!==e.high_price&&void 0!==e.low_price&&void 0!==e.close_price&&e.datetime).map(e=>({date:e.datetime,open:Number(e.open_price),high:Number(e.high_price),low:Number(e.low_price),close:Number(e.close_price),volume:e.volume?Number(e.volume):void 0})):[],[r]),h=(0,l.useMemo)(()=>{if(!r.length)return;let e=r.slice().reverse(),t={};return["rsi_5","rsi_7","rsi_10","rsi_14","rsi_21","dif","macd","macd_histogram","k_value","d_value","j_value","ma5","ma10","ma20","ma60","ema12","ema26","bb_upper","bb_middle","bb_lower","atr","cci","willr","mom"].forEach(a=>{let r=e.map(e=>{let t=e[a];return null==t||isNaN(Number(t))?null:Number(t)});r.some(e=>null!==e)&&(t[a]=r)}),t},[r]),g=(0,l.useMemo)(()=>{if(!u.length||!r.length)return null;let e=u[u.length-1],t=r[0],a=u.length>1?u[u.length-2]:e,l=e.close-a.close,s=l/a.close*100;return{latest:e.close,change:l,changePercent:s,isRising:l>=0,high:e.high,low:e.low,volume:e.volume,open_price:e.open,open:e.open,datetime:(null==t?void 0:t.datetime)||e.date}},[u,r]),y=(0,l.useCallback)(()=>{x()},[x]),p=(0,l.useCallback)(()=>{c(null)},[]);return(0,l.useEffect)(()=>{x()},[x]),(0,l.useEffect)(()=>{s([]),c(null)},[e,t]),{data:r,loading:n,error:o,stats:g,candlestickData:u,technicalData:h,refetch:y,clearError:p}},L=()=>{let[e,t]=(0,l.useState)(""),[a,i]=(0,l.useState)("chart"),[o,c]=(0,l.useState)("1d"),[d,m]=(0,l.useState)("1Y"),[x,h]=(0,l.useState)("market_stock_tw"),{data:g,loading:p,error:f,stats:v,candlestickData:w,technicalData:k,refetch:_,clearError:C}=U(e,o,x),S=(0,l.useCallback)(e=>{t(e)},[]),M=(0,l.useCallback)(e=>{c(e)},[]),D=(0,l.useMemo)(()=>[{key:"chart",label:"圖表",icon:(0,r.jsx)(b.A,{className:"h-5 w-5 inline-block align-text-bottom"})},{key:"table",label:"數據",icon:(0,r.jsx)(N.A,{className:"h-5 w-5 inline-block align-text-bottom"})}],[]),E=(0,l.useMemo)(()=>{if(p)return(0,r.jsx)(T,{});if(f)return(0,r.jsx)(F,{error:f,onRetry:_,onClear:C});if(!g||0===g.length)return(0,r.jsx)(R,{onQuickSelect:S});switch(a){case"chart":return(0,r.jsx)(j,{data:w,technicalData:k,symbol:e,timeframe:o});case"table":return(0,r.jsx)(A,{data:g,timeframe:o,symbol:e});default:return null}},[p,f,g,a,w,k,e,o,_,C,S]);return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6 space-y-6",children:[(0,r.jsx)(s.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:(0,r.jsx)(u,{symbol:e,onSymbolChange:S,timeframe:o,onTimeframeChange:M,loading:p,onSearch:_,dataPeriod:d,onDataPeriodChange:m,market:x,onMarketChange:h})}),g&&g.length>0&&(0,r.jsx)(s.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"flex justify-center mb-6",children:(0,r.jsx)("div",{className:"bg-white rounded-lg p-1 shadow-sm border border-gray-200",children:(0,r.jsx)("div",{className:"flex space-x-1",children:D.map(e=>(0,r.jsxs)(s.P.button,{onClick:()=>i(e.key),className:"px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 ".concat(a===e.key?"bg-gray-900 text-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"),children:[(0,r.jsx)("span",{className:"mr-2",children:e.icon}),e.label]},e.key))})})}),v&&g&&g.length>0&&!p&&!f?(0,r.jsx)(s.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:(0,r.jsx)(y,{symbol:e,stats:v,timeframe:o})}):null,(0,r.jsx)(n.N,{mode:"wait",children:(0,r.jsx)(s.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:E},a)})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[755,636,593,792],()=>t(3956)),_N_E=e.O()}]);