(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{228:(e,l,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/test/run-python",function(){return t(2135)}])},2135:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>i});var s=t(7876),r=t(4232);let n=e=>{let{loading:l,setSymbol:t}=e;return(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:Object.entries({"--help":"顯示說明","--indicators-only":"重新計算技術指標","--expand-history":"獲取歷史資料","--show-all-stats":"顯示統計資訊"}).map(e=>{let[r,n]=e;return(0,s.jsxs)("button",{type:"button",className:"px-3 py-1.5 rounded-lg bg-blue-100 text-blue-700 font-medium border border-blue-300 hover:bg-blue-200 transition text-xs shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-200",onClick:()=>t(r),disabled:l,children:[r," ",(0,s.jsxs)("span",{className:"text-[10px] text-blue-400 ml-1",children:["(",n,")"]})]},r)})})},a=e=>{let{loading:l,setSymbol:t}=e,r=[{param:"--tw",label:"台股"},{param:"--us",label:"美股"},{param:"--etf",label:"ETF"},{param:"--index",label:"指數"},{param:"--forex",label:"外匯"},{param:"--crypto",label:"加密貨幣"},{param:"--futures",label:"期貨"}];return(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map(e=>{let{param:n,label:a}=e;return(0,s.jsxs)("button",{type:"button",className:"px-3 py-1.5 rounded-lg bg-green-100 text-green-700 font-medium border border-green-300 hover:bg-green-200 transition text-xs shadow-sm focus:outline-none focus:ring-2 focus:ring-green-200",onClick:()=>{t(e=>{let l=r.map(e=>e.param),t=e.split(/\s+/).filter(e=>!l.includes(e)&&""!==e).join(" ");return t?t+" "+n:n})},disabled:l,children:[n," ",(0,s.jsxs)("span",{className:"text-[10px] text-green-400 ml-1",children:["(",a,")"]})]},n)})})},o=r.forwardRef((e,l)=>{let{logs:t,error:r,loading:n}=e;return(0,s.jsxs)("div",{ref:l,className:"bg-slate-900 rounded-2xl p-5 min-h-[320px] max-h-[600px] h-[540px] overflow-y-auto text-green-200 font-mono text-base whitespace-pre-wrap shadow-lg border-2 border-slate-700 outline-none relative scrollbar-hide",tabIndex:-1,style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[(0,s.jsx)("style",{children:"\n      .scrollbar-hide::-webkit-scrollbar { display: none; }\n    "}),0===t.length&&!r&&!n&&(0,s.jsx)("span",{className:"text-slate-500",children:"輸出結果將顯示於此處..."}),t.map((e,l)=>(0,s.jsx)("div",{className:"break-all",children:e},l)),n&&(0,s.jsx)("div",{className:"absolute left-0 right-0 bottom-2 flex justify-center animate-pulse",children:(0,s.jsx)("span",{className:"text-blue-300 text-sm",children:"執行中，請稍候..."})}),r&&(0,s.jsxs)("div",{className:"text-red-400 font-bold mt-2 animate-pulse",children:["錯誤：",r]})]})});o.displayName="LogBox";let i=()=>{let[e,l]=(0,r.useState)(""),[t,i]=(0,r.useState)([]),[c,d]=(0,r.useState)(!1),[u,x]=(0,r.useState)(""),b=(0,r.useRef)(null),m=(0,r.useRef)(null),h=(0,r.useRef)(null),p=()=>{i([]),x(""),d(!0),b.current&&b.current.close();let l=new EventSource("/api/test/run-python?symbol=".concat(encodeURIComponent(e)));b.current=l,l.onmessage=e=>{i(l=>[...l,e.data])},l.onerror=()=>{x("串流連線錯誤或執行失敗"),d(!1),l.close()},l.addEventListener("end",e=>{i(l=>[...l,e.data]),d(!1),l.close()})},f=()=>{var e;l(""),x(""),d(!1),b.current&&b.current.close(),null==(e=h.current)||e.focus()};return(0,r.useEffect)(()=>{m.current&&(m.current.scrollTop=m.current.scrollHeight)},[t,u,c]),(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center pt-8 pb-20",children:(0,s.jsxs)("div",{className:"w-full max-w-6xl flex flex-col lg:flex-row gap-10 items-stretch",children:[(0,s.jsxs)("div",{className:"flex-1 w-full max-w-2xl bg-white rounded-2xl shadow-xl p-8 border border-blue-100 mb-8 lg:mb-0 min-h-[540px] h-[540px] flex flex-col",children:[(0,s.jsx)("h2",{className:"text-3xl font-extrabold text-blue-700 mb-2 text-center lg:text-left tracking-tight drop-shadow-sm",children:"金融數據手動獲取 / 更新"}),(0,s.jsxs)("p",{className:"text-blue-500 text-center lg:text-left mb-6 text-base font-medium",children:["抓取金融數據並存入 SQL SERVER。",(0,s.jsx)("a",{href:"https://github.com/HaoXun97/technical-indicators",className:"text-blue-600 underline hover:text-blue-800",target:"_blank",rel:"noopener noreferrer",children:"查看程式碼"})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-blue-700 font-semibold mb-1",htmlFor:"symbol-input",children:"輸入金融代號或參數"}),(0,s.jsxs)("div",{className:"relative flex items-center",children:[(0,s.jsx)("input",{ref:h,id:"symbol-input",type:"text",value:e,onChange:e=>l(e.target.value),onKeyDown:l=>{"Enter"===l.key&&e&&!c&&p()},placeholder:"請輸入金融代號或參數 (可複合)",className:"w-full px-5 py-3 rounded-xl border-2 border-blue-200 focus:ring-4 focus:ring-blue-200 focus:outline-none text-lg bg-blue-50 placeholder-blue-300 text-blue-900 shadow-md pr-12 transition-all duration-200",disabled:c,autoFocus:!0}),e&&!c&&(0,s.jsx)("button",{type:"button",onClick:f,className:"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 rounded-full hover:bg-blue-100 focus:outline-none",tabIndex:-1,"aria-label":"清除輸入",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 8.586l4.95-4.95a1 1 0 111.414 1.414L11.414 10l4.95 4.95a1 1 0 01-1.414 1.414L10 11.414l-4.95 4.95a1 1 0 01-1.414-1.414L8.586 10l-4.95-4.95A1 1 0 115.05 3.636L10 8.586z",clipRule:"evenodd"})})})]})]}),(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("span",{className:"block text-xs text-slate-400 mb-1",children:"參數"}),(0,s.jsx)(n,{loading:c,setSymbol:l})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("span",{className:"block text-xs text-slate-400 mb-1",children:"市場選項"}),(0,s.jsx)(a,{loading:c,setSymbol:l})]}),(0,s.jsxs)("div",{className:"flex gap-4 mt-auto",children:[(0,s.jsx)("button",{onClick:p,disabled:c||!e,className:"flex-1 px-7 py-3 rounded-xl font-bold text-white text-lg transition-all duration-200 shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-300 items-center ".concat(c||!e?"bg-blue-200 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:c?"執行中...":"執行"}),(0,s.jsx)("button",{onClick:f,disabled:c&&!e,className:"px-7 py-3 rounded-xl font-bold text-blue-700 border border-blue-300 bg-white hover:bg-blue-50 transition-all duration-200 shadow focus:outline-none focus:ring-2 focus:ring-blue-200",children:"清除"})]})]}),(0,s.jsx)("div",{className:"w-full lg:w-[640px] flex-shrink-0 min-h-[540px] h-[540px]",children:(0,s.jsx)(o,{ref:m,logs:t,error:u,loading:c})})]})})}}},e=>{var l=l=>e(e.s=l);e.O(0,[636,593,792],()=>l(228)),_N_E=e.O()}]);