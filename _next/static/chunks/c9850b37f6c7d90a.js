(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,76217,e=>{"use strict";var t=e.i(91398),s=e.i(91788),a=e.i(83721),r=e.i(86129),l=e.i(48033),i=e.i(57748),n=e.i(7654),d=e.i(3812),o=e.i(98634);function c({data:e,symbol:a,timeframe:c,nCandles:x=40,model:m="FinCoach",onComplete:h}){let[g,u]=(0,s.useState)(null),[b,p]=(0,s.useState)(!1),[f,y]=(0,s.useState)(null),j=(0,s.useRef)(null),v=(0,s.useRef)(!1),[N,w]=(0,s.useState)(0),[S,k]=(0,s.useState)(!1),_=(0,s.useRef)(null),C=(0,s.useMemo)(()=>{var t;let s,r,l,i;return t={symbol:a,timeframe:c,nCandles:x},s=`你是一位專業的金融分析 AI 助手，擅長技術分析、量化交易與市場情緒判斷，能以清晰、專業且簡潔的方式撰寫交易訊號分析報告。根據提供的交易訊號資料，請撰寫一份簡短但具洞察力的交易分析報告，內容僅包含：買賣建議：根據訊號，提供明確的「買入、持有或賣出或觀望」建議。請使用清晰分段或條列格式，語氣應專業、客觀且易於理解。`,r=(()=>{if(!e)return"未提供資料。";if(Array.isArray(e)){let t=e.slice(0,40).map(e=>{let t=e.datetime??e.date??e.time??"-",s=e.close_price??e.close??e.price??"-",a=e.Trade_Signal??e.signal??"-";return`${t} close=${s} signal=${a}`}).join("\n");return`最近 ${Math.min(e.length,40)} 筆交易訊號（最近 -> 最遠）：
${t}`}return`資料： ${JSON.stringify(e)}`})(),l=t?.symbol?`標的：${t.symbol}`:"",i=t?.nCandles?`包含最近 ${t.nCandles} 筆 K 線摘要（若有）`:"",`${s}
${l}

${r}

${i}

請用繁體中文回答，條列式且易讀。篇幅控制在 200 字內。`},[e,a,c,x]);(0,s.useEffect)(()=>{if(!e){u(null),y(null),p(!1);return}let t=new AbortController;j.current=t;let s=!0;async function a(){C&&C.length>2e4&&console.warn("AIInsights: prompt truncated for safety"),p(!0),k(!1),y(null);let e={model:m,messages:[{role:"user",content:C}]};try{let a=await fetch("/api/ollama-proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:t.signal});if(!a.ok)try{a=await fetch("http://localhost:11434/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:t.signal})}catch{}if(!a.ok){let e=await a.text().catch(()=>"(no body)");throw Error(`分析請求失敗：${a.status} ${a.statusText} ${e}`)}if(a.body){let e=a.body.getReader(),t=new TextDecoder,r="",l="",i=!0,n=e=>{if(e&&"object"==typeof e){if(e.message&&"object"==typeof e.message){let t=e.message;if("string"==typeof t.content)return t.content}if(Array.isArray(e.choices)&&e.choices.length>0){let t=e.choices[0];if(t&&t.message&&"object"==typeof t.message){let e=t.message;if("string"==typeof e.content)return e.content}}return"string"==typeof e.result?e.result:"string"==typeof e.text?e.text:"string"==typeof e.output?e.output:void 0}};try{for(;;){let{value:a,done:d}=await e.read();if(d)break;if(!a)continue;let o=(r+=t.decode(a,{stream:!0})).split("\n");for(let e of(r=o.pop()||"",o)){let t,a=e.trim();if(a){try{t=JSON.parse(a)}catch{if(a.startsWith("data:")){let e=a.replace(/^data:\s*/i,"");try{t=JSON.parse(e)}catch{t=void 0}}}if(t){let e=n(t);if("string"==typeof e&&e.length>0){if(l+=e,!s)return;i&&(p(!1),k(!0),i=!1),u(l)}}else{let e=a.replace(/^data:\s*/i,"");if(e&&!e.startsWith("{")){if(l+=e,!s)return;i&&(p(!1),k(!0),i=!1),u(l)}}}}}if(r.trim()){let e,t=r.trim();try{e=JSON.parse(t)}catch{if(t.startsWith("data:")){let s=t.replace(/^data:\s*/i,"");try{e=JSON.parse(s)}catch{e=void 0}}}if(e){let t=n(e);"string"==typeof t&&(l+=t)}else{let e=t.replace(/^data:\s*/i,"");l+=e}}if(!s)return;u(l||""),p(!1),k(!1),h&&!v.current&&(h(l||""),v.current=!0)}finally{try{await e.cancel()}catch{}}}else{let e=await a.text();if(!s)return;u(e),p(!1),k(!1),h&&!v.current&&(h(e),v.current=!0)}}catch(e){if(!s)return;if(e instanceof DOMException&&"AbortError"===e.name)return void p(!1);y(e instanceof Error?e.message:String(e)),p(!1)}}return _.current&&(clearTimeout(_.current),_.current=null),_.current=window.setTimeout(()=>{a()},250),()=>{s=!1,t.abort()}},[e,m,C,h,x,N]);let O=(0,s.useCallback)(()=>{v.current=!1,j.current?.abort(),u(null),y(null),p(!0),w(e=>e+1)},[]),$=(0,s.useCallback)(async()=>{if(g)try{await navigator.clipboard.writeText(g)}catch{}},[g]);return(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 border border-gray-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("div",{className:"flex items-center space-x-4",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"shrink-0",children:(0,t.jsx)("div",{className:"h-10 w-10 rounded-lg bg-gray-100 flex items-center justify-center",children:(0,t.jsx)(i.SparklesIcon,{className:"h-5 w-5 text-gray-700"})})}),(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"text-md font-semibold",children:"AI 分析與見解"})})]})}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"text-sm text-gray-500",children:b?"連線中...":S?"正在接收...":f?"錯誤":"AI"}),(0,t.jsx)("span",{className:"inline-block text-xs bg-gray-100 text-gray-700 px-2 py-0.5 rounded",children:m}),(0,t.jsxs)("button",{onClick:O,className:"flex items-center px-2 py-1 bg-white rounded-md text-sm hover:bg-gray-50 border",disabled:b,title:"重新分析",children:[(0,t.jsx)(r.ArrowPathIcon,{className:`h-4 w-4 mr-2 text-gray-600 ${b||S?"animate-spin":""}`}),(0,t.jsx)("span",{children:b||S?"重新發送...":"重新分析"})]}),(0,t.jsxs)("button",{onClick:$,disabled:!g||b,className:"flex items-center px-2 py-1 bg-white rounded-md text-sm hover:bg-gray-50 border disabled:opacity-50",children:[(0,t.jsx)(l.ClipboardDocumentIcon,{className:"h-4 w-4 mr-2 text-gray-600"}),(0,t.jsx)("span",{children:"複製"})]})]})]}),b&&(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"正在連接 AI 模型…"}),f&&(0,t.jsxs)("div",{className:"text-sm text-red-600",children:["分析失敗：",f]}),g&&!b&&(0,t.jsx)("div",{className:"prose max-w-full text-gray-800 leading-relaxed space-y-4",children:(0,t.jsx)(n.default,{remarkPlugins:[d.default],rehypePlugins:[o.default],components:{table:({children:e})=>(0,t.jsx)("div",{className:"overflow-auto rounded-md border border-gray-100 my-4",children:(0,t.jsx)("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:e})}),thead:({children:e})=>(0,t.jsx)("thead",{className:"bg-gray-50",children:e}),tbody:({children:e})=>(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-100",children:e}),tr:({children:e})=>(0,t.jsx)("tr",{className:"hover:bg-gray-50",children:e}),th:({children:e})=>(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e}),td:({children:e})=>(0,t.jsx)("td",{className:"px-4 py-3 align-top whitespace-normal text-sm",children:e})},children:g})}),(0,t.jsx)("div",{className:"mt-3 text-xs text-gray-400",children:"提示：AI 回覆僅供參考，不構成投資建議。"})]})}var x=e.i(97680),m=e.i(6845);function h(e){return(0,m.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"},child:[]},{tag:"polyline",attr:{points:"7 10 12 15 17 10"},child:[]},{tag:"line",attr:{x1:"12",y1:"15",x2:"12",y2:"3"},child:[]}]})(e)}var g=e.i(81406),u=e.i(42248),b=e.i(7432),p=e.i(48953);function f(e){if(!e)return"";let t=new Date(String(e));return isNaN(t.getTime())?String(e):t.toLocaleString()}function y(e){return e?e.includes("買")?{text:e,cls:"border-green-200 text-green-700 bg-white"}:e.includes("賣")?{text:e,cls:"border-red-200 text-red-700 bg-white"}:{text:e,cls:"border-gray-200 text-gray-700 bg-white"}:{text:"無訊號",cls:"border-gray-200 text-gray-600 bg-white"}}function j(e){if(null==e||""===e)return"-";let t=Number(e);return isNaN(t)?String(e):t.toLocaleString()}let v=()=>(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 space-y-6",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"}),(0,t.jsx)("div",{className:"absolute inset-0 w-16 h-16 border-4 border-transparent border-t-indigo-400 rounded-full animate-spin",style:{animationDelay:"0.3s",animationDuration:"1.2s"}})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-xl font-semibold text-gray-700 mb-2",children:"查詢中..."}),(0,t.jsx)("p",{className:"text-gray-500",children:"正在搜尋交易訊號資料"})]})]}),N=({signal:e})=>{let s=y(e);return(0,t.jsx)("span",{className:`inline-block px-3 py-1 text-sm rounded-full border ${s.cls}`,children:s.text})},w=({children:e,className:s=""})=>(0,t.jsxs)("div",{className:`relative ${s}`,children:[e,(0,t.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,t.jsx)("svg",{className:"w-4 h-4 text-white/70 transition-all duration-300 group-hover:text-white group-focus-within:text-white group-focus-within:rotate-180",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),S=({className:e="",children:s,...a})=>(0,t.jsx)(w,{children:(0,t.jsx)("select",{...a,className:`${e} appearance-none cursor-pointer pr-10`,children:s})});e.s(["default",0,()=>{let[e,r]=(0,s.useState)(""),[l,i]=(0,s.useState)("1d"),[n,d]=(0,s.useState)("market_stock_tw"),[o,m]=(0,s.useState)(!1),[w,k]=(0,s.useState)(""),[_,C]=(0,s.useState)({}),[O,$]=(0,s.useState)({}),[E,T]=(0,s.useState)(null),[L,A]=(0,s.useState)("desc");(0,s.useEffect)(()=>{let e=Object.keys(_);$(t=>{let s={...t};return e.forEach(e=>{s[e]||(s[e]={visible:!0,search:"",page:1,pageSize:10})}),Object.keys(s).forEach(t=>{e.includes(t)||delete s[t]}),s})},[_]);let R=e=>O[e]??{visible:!0,search:"",page:1,pageSize:10},I=(e,t)=>{$(s=>({...s,[e]:{...R(e),...t}}))},M=(0,s.useCallback)(e=>"market_futures"===n||"market_forex"===n||"market_index"===n||"market_etf"===n||"market_stock_us"===n||"market_stock_tw"===n||"market_crypto"===n?e.replace(RegExp("[^0-9A-Za-z_/.\\-=^]","g"),"").toUpperCase():e.replace(/[^0-9A-Za-z]/g,"").toUpperCase(),[n]),D=(0,s.useCallback)(async()=>{let t=M(e);if(!t)return void k("請輸入股票代號，例如 2330 或 0050");m(!0),k(""),C({});try{let e=x.DatabaseService.getInstance(),s={user:"",password:"",server:"",database:n},a=[];("1d"===l||"both"===l)&&a.push({key:"1d",sql:"SELECT TOP (500) * FROM trade_signals_1d WHERE symbol = @symbol ORDER BY [datetime] DESC"}),("1h"===l||"both"===l)&&a.push({key:"1h",sql:"SELECT TOP (500) * FROM trade_signals_1h WHERE symbol = @symbol ORDER BY [datetime] DESC"});let r={};for(let l of a){let a=await e.executeQuery(s,l.sql,{symbol:t});if(!a.success){k(a.error||"查詢失敗"),m(!1);return}r[l.key]=a.data||[]}C(r)}catch(e){k(e instanceof Error?e.message:"未知錯誤")}finally{m(!1)}},[e,l,M]),F=(0,s.useCallback)(e=>{let t={},s={},a=[],r=["MA_Cross","BB_Signal","MACD_Cross","MACD_Div","RSI_Signal","KD_Signal","SR_Signal","Volume_Anomaly","EMA_Cross","CCI_Signal","WILLR_Signal","MOM_Signal","Anomaly"];for(let l of e.slice(0,200)){let e=String(l.Trade_Signal??l.signal??"");e&&(t[e]=(t[e]||0)+1),r.forEach(e=>{let t=l[e];null!=t&&""!==String(t)&&"0"!==String(t)&&(s[e]=(s[e]||0)+1)}),a.push({date:f(l.datetime??l.date),price:j(l.close_price??l.close),signal:String(l.Trade_Signal??l.signal??""),strength:String(l.Signal_Strength??l.strength??"")})}return{counts:t,indicatorsSorted:Object.entries(s).sort((e,t)=>t[1]-e[1]),timeline:a}},[]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("section",{className:"relative bg-linear-to-br from-slate-900 via-blue-900 to-indigo-900 flex items-center overflow-hidden shadow-2xl",children:[(0,t.jsx)("div",{className:"absolute inset-0 opacity-20",children:(0,t.jsx)("div",{className:"absolute inset-0",style:{backgroundImage:`
                linear-gradient(rgba(59, 130, 246, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59, 130, 246, 0.1) 1px, transparent 1px)
              `,backgroundSize:"50px 50px"}})}),(0,t.jsxs)("div",{className:"absolute top-0 left-0 w-full h-full",children:[(0,t.jsx)("div",{className:"absolute top-12 left-12 w-24 h-24 bg-white opacity-5 rounded-full animate-pulse"}),(0,t.jsx)("div",{className:"absolute bottom-12 right-24 w-36 h-36 bg-white opacity-5 rounded-full animate-pulse",style:{animationDelay:"1s"}}),(0,t.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-72 h-72 bg-gradient-radial from-white/10 to-transparent rounded-full"}),(0,t.jsx)("div",{className:"absolute top-24 right-12 w-4 h-4 bg-white opacity-20 rounded-full animate-bounce"}),(0,t.jsx)("div",{className:"absolute bottom-24 left-24 w-3 h-3 bg-white opacity-30 rounded-full animate-pulse",style:{animationDelay:"1.5s"}}),(0,t.jsx)("div",{className:"absolute top-48 left-1/4 w-5 h-5 bg-white opacity-15 rounded-full animate-bounce",style:{animationDelay:"2s"}}),(0,t.jsx)("div",{className:"absolute top-32 right-1/3 w-2 h-2 bg-white opacity-25 rounded-full animate-pulse",style:{animationDelay:"0.5s"}})]}),(0,t.jsx)("div",{className:"relative max-w-7xl mx-auto px-6 sm:px-8 lg:px-12 py-16 z-10 w-full",children:(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-8",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center mb-6",children:[(0,t.jsx)("div",{className:"p-4 bg-white/10 rounded-3xl backdrop-blur-sm mr-6 group hover:bg-white/20 transition-all duration-300 shadow-lg",children:(0,t.jsx)("div",{className:"w-10 h-10 flex items-center justify-center",children:(0,t.jsx)(g.SignalIcon,{className:"h-8 w-8 text-white"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-4xl lg:text-5xl font-bold text-white tracking-tight leading-tight",children:"進階交易訊號分析"}),(0,t.jsx)("p",{className:"text-blue-200 mt-3 text-xl font-medium",children:"提供股票與加密貨幣等等的交易訊號查詢與分析工具。"})]})]}),(0,t.jsx)("p",{className:"text-blue-200 text-xl max-w-3xl leading-relaxed mb-8",children:"查詢並分析技術指標產生的交易訊號，協助投資人做出更明智的交易決策。"}),(0,t.jsxs)("form",{className:"flex flex-col xl:flex-row gap-4 max-w-5xl",onSubmit:e=>{e.preventDefault(),o||D()},children:[(0,t.jsx)("div",{className:"flex-1 min-w-0 relative",children:(0,t.jsx)("input",{type:"text",className:"w-full px-6 py-4 bg-white/10 backdrop-blur-sm border-2 border-white/20 rounded-2xl text-white placeholder-blue-200 focus:outline-none focus:border-white/40 transition-all duration-300 text-lg min-w-80",placeholder:"輸入市場代號...",value:e,onChange:e=>r(e.target.value),maxLength:15,autoFocus:!0})}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 shrink-0",children:[(0,t.jsxs)(S,{value:l,onChange:e=>i(e.target.value),className:"px-5 py-4 border-2 border-white/20 rounded-2xl bg-white/10 backdrop-blur-sm text-white focus:outline-none focus:border-white/40 transition-all duration-300 hover:border-white/30 min-w-32",children:[(0,t.jsx)("option",{value:"1d",className:"bg-white text-gray-900 py-2",children:"📊 日線"}),(0,t.jsx)("option",{value:"1h",className:"bg-white text-gray-900 py-2",children:"⏰ 小時線"}),(0,t.jsx)("option",{value:"both",className:"bg-white text-gray-900 py-2",children:"📈 日線&小時線"})]}),(0,t.jsxs)(S,{value:n,onChange:e=>d(e.target.value),className:"px-5 py-4 border-2 border-white/20 rounded-2xl bg-white/10 backdrop-blur-sm text-white focus:outline-none focus:border-white/40 transition-all duration-300 hover:border-white/30 min-w-48",children:[(0,t.jsx)("option",{value:"market_stock_tw",className:"bg-white text-gray-900 py-2",children:"🇹🇼 台股"}),(0,t.jsx)("option",{value:"market_stock_us",className:"bg-white text-gray-900 py-2",children:"🇺🇸 美股"}),(0,t.jsx)("option",{value:"market_crypto",className:"bg-white text-gray-900 py-2",children:"🌐 加密貨幣"}),(0,t.jsx)("option",{value:"market_forex",className:"bg-white text-gray-900 py-2",children:"💱 外匯"}),(0,t.jsx)("option",{value:"market_etf",className:"bg-white text-gray-900 py-2",children:"📊 ETF"}),(0,t.jsx)("option",{value:"market_futures",className:"bg-white text-gray-900 py-2",children:"📈 期貨"}),(0,t.jsx)("option",{value:"market_index",className:"bg-white text-gray-900 py-2",children:"📉 指數"})]}),(0,t.jsxs)("button",{type:"submit",className:"px-8 py-4 bg-white text-blue-900 font-bold rounded-2xl hover:bg-blue-50 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 relative overflow-hidden group flex items-center gap-2 min-w-28 justify-center",disabled:o||!e,children:[(0,t.jsx)("span",{className:"absolute inset-0 bg-linear-to-r from-blue-500 to-indigo-500 opacity-0 group-hover:opacity-10 transition-opacity"}),o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("svg",{className:"animate-spin h-5 w-5 relative",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,t.jsx)("span",{className:"relative",children:"查詢中..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.MagnifyingGlassIcon,{className:"h-5 w-5 relative"}),(0,t.jsx)("span",{className:"relative",children:"查詢"})]})]})]})]})]}),(0,t.jsx)("div",{className:"flex flex-col lg:items-end space-y-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-6 lg:gap-8",children:[(0,t.jsxs)("div",{className:"text-center bg-white/10 backdrop-blur-sm rounded-2xl p-4 border border-white/20 shadow-lg",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-white",children:Object.values(_).reduce((e,t)=>e+t.length,0)}),(0,t.jsx)("div",{className:"text-blue-200 text-sm font-medium",children:"資料筆數"})]}),(0,t.jsxs)("div",{className:"text-center bg-white/10 backdrop-blur-sm rounded-2xl p-4 border border-white/20 shadow-lg",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-white",children:"多市場"}),(0,t.jsx)("div",{className:"text-blue-200 text-sm font-medium",children:"支援類型"})]})]})})]})})]}),(0,t.jsxs)("div",{className:"relative bg-linear-to-br from-gray-50 via-blue-50 to-indigo-50 min-h-screen",children:[(0,t.jsxs)("div",{className:"absolute inset-0 overflow-hidden",children:[(0,t.jsx)("div",{className:"absolute top-20 left-20 w-64 h-64 bg-linear-to-br from-blue-100 to-indigo-100 rounded-full opacity-30 blur-3xl"}),(0,t.jsx)("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-linear-to-br from-indigo-100 to-purple-100 rounded-full opacity-20 blur-3xl"})]}),(0,t.jsx)("div",{className:"relative max-w-7xl mx-auto px-6 sm:px-8 lg:px-12 py-16",children:(0,t.jsxs)("div",{className:"grid gap-6",id:"signalsList",children:[w&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 mb-8",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"text-red-500 text-xl",children:"⚠️"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-red-800 font-semibold text-lg mb-1",children:"查詢錯誤"}),(0,t.jsx)("div",{className:"text-red-700",children:w})]})]})}),o&&(0,t.jsx)(v,{}),0===Object.keys(_).length&&!o&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 space-y-6",children:[(0,t.jsx)("div",{className:"w-24 h-24 bg-linear-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center shadow-lg",children:(0,t.jsx)(g.SignalIcon,{className:"w-12 h-12 text-blue-600"})}),(0,t.jsxs)("div",{className:"text-center bg-white/80 backdrop-blur-sm rounded-3xl p-8 shadow-xl border border-blue-200/50 max-w-md",children:[(0,t.jsx)("h3",{className:"text-2xl font-bold text-gray-800 mb-3",children:"開始分析交易訊號"}),(0,t.jsx)("p",{className:"text-gray-600 leading-relaxed",children:"請輸入股票代號，獲取交易訊號與投資建議"})]})]}),!o&&Object.entries(_).map(([s,a])=>{let r,l,i,d,o,x,m,g,u,v,w,S,k,C,O,$,M,D,z,B,P,W,U;return(0,t.jsxs)("div",{className:"bg-white/90 rounded-2xl shadow-lg border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"border-b border-gray-100 p-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"p-3 bg-blue-50 rounded-lg",children:"1d"===s?(0,t.jsx)(b.ChartBarIcon,{className:"h-6 w-6 text-blue-600"}):(0,t.jsx)(p.ClockIcon,{className:"h-6 w-6 text-blue-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"1d"===s?"日線交易訊號":"小時線交易訊號"}),(0,t.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:"1d"===s?"trade_signals_1d":"trade_signals_1h"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-sm font-medium",children:["共 ",a.length.toLocaleString()," 筆"]}),(0,t.jsxs)("button",{type:"button",className:"px-4 py-2 bg-green-50 hover:bg-green-100 border border-green-200 rounded-lg text-sm inline-flex items-center gap-2 text-green-700 font-medium transition-colors",onClick:()=>(t=>{let s=function(e){if(!e||0===e.length)return"";let t=Object.keys(e[0]),s=[t.join(",")];for(let a of e){let e=t.map(e=>{let t=a[e];if(null==t)return"";let s=String(t).replace(/"/g,'""');return`"${s}"`}).join(",");s.push(e)}return s.join("\n")}(_[t]||[]);if(!s)return;let a=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download=`${e||"symbol"}_${n}_${t}_trade_signals.csv`,document.body.appendChild(l),l.click(),l.remove(),URL.revokeObjectURL(r)})(s),children:[(0,t.jsx)(h,{className:"text-base"}),"匯出 CSV"]}),(0,t.jsx)("button",{type:"button",className:"px-4 py-2 bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded-lg text-sm font-medium transition-colors",onClick:()=>I(s,{visible:!R(s).visible}),children:R(s).visible?"👁️ 隱藏":"👁️ 顯示"})]})]})}),(0,t.jsxs)("div",{className:"p-6",children:[a.length>0&&(r=a.length,i=(l=a[0])&&(l.datetime||l.date)||"",d=l&&(l.close_price||l.close)||"",o=l?l.Trade_Signal:void 0,m=(x=a.slice(0,40).map(e=>Number(e.close_price??e.close)||0).filter(e=>e>0)).length>0?x[x.length-1]:0,g=x.length>0?x[0]:0,u=m?(g-m)/m*100:0,(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,t.jsxs)("div",{className:"bg-white/90 rounded-2xl shadow-lg border border-blue-100 p-6 hover:shadow-xl transition-all duration-300",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,t.jsx)("div",{className:"p-2 bg-blue-50 rounded-lg",children:(0,t.jsx)("div",{className:"w-5 h-5 bg-blue-500 rounded"})})}),(0,t.jsx)("div",{className:"text-sm text-gray-600 font-medium mb-1",children:"總筆數"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:r.toLocaleString()})]}),(0,t.jsxs)("div",{className:"bg-white/90 rounded-2xl shadow-lg border border-green-100 p-6 hover:shadow-xl transition-all duration-300",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,t.jsx)("div",{className:"p-2 bg-green-50 rounded-lg",children:(0,t.jsx)("div",{className:"w-5 h-5 bg-green-500 rounded"})})}),(0,t.jsx)("div",{className:"text-sm text-gray-600 font-medium mb-1",children:"最新時間"}),(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:f(i)})]}),(0,t.jsxs)("div",{className:"bg-white/90 rounded-2xl shadow-lg border border-purple-100 p-6 hover:shadow-xl transition-all duration-300",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,t.jsx)("div",{className:"p-2 bg-purple-50 rounded-lg",children:(0,t.jsx)("div",{className:"w-5 h-5 bg-purple-500 rounded"})})}),(0,t.jsx)("div",{className:"text-sm text-gray-600 font-medium mb-1",children:"當前訊號"}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(N,{signal:o})})]}),(0,t.jsxs)("div",{className:"bg-white/90 rounded-2xl shadow-lg border border-orange-100 p-6 hover:shadow-xl transition-all duration-300",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,t.jsx)("div",{className:"p-2 bg-orange-50 rounded-lg",children:(0,t.jsx)("div",{className:"w-5 h-5 bg-orange-500 rounded"})})}),(0,t.jsx)("div",{className:"text-sm text-gray-600 font-medium mb-1",children:"最新收盤價"}),(0,t.jsx)("div",{className:"text-lg font-bold text-gray-900",children:d?`NT$ ${j(d)}`:"-"}),(0,t.jsx)("div",{className:`text-sm font-medium mt-1 ${u>=0?"text-green-600":"text-red-600"}`,children:u?`${u>0?"+":""}${u.toFixed(2)}%`:"-"})]})]})),a.length>0&&(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)(c,{data:a.slice(0,100),symbol:e,timeframe:s,nCandles:50,model:"FinCoach"})}),a.length>0&&(w=Object.entries((v=F(a)).counts).sort((e,t)=>t[1]-e[1]),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[(0,t.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-700",children:"訊號分布"})]}),0===w.length?(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"無資料"}):(0,t.jsx)("div",{className:"space-y-2",children:w.map(([e,s])=>{let a=y(String(e));return(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg",children:[(0,t.jsx)("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${a.cls}`,children:a.text}),(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-600",children:s})]},e)})})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6 lg:col-span-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-700",children:"熱門指標 (前200筆)"})]}),0===v.indicatorsSorted.length?(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"無資料"}):(0,t.jsx)("div",{className:"grid grid-cols-2 gap-3",children:v.indicatorsSorted.slice(0,12).map(([e,s])=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[(0,t.jsx)("div",{className:"text-sm text-gray-700 font-medium",children:e}),(0,t.jsx)("div",{className:"text-sm font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded",children:s})]},e))})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6 lg:col-span-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-700",children:"最近訊號時間線"})]}),0===v.timeline.length?(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"無資料"}):(0,t.jsx)("div",{className:"space-y-3 max-h-64 overflow-auto",children:v.timeline.slice(0,8).map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[(0,t.jsx)("div",{className:"text-xs text-gray-600 font-medium w-48 truncate",children:e.date}),(0,t.jsx)("div",{className:"flex-1 text-sm text-gray-800 font-semibold mx-4",children:e.price}),(0,t.jsx)("div",{children:(0,t.jsx)(N,{signal:e.signal})})]},s))})]})]})),0===a.length?(0,t.jsx)("div",{className:"text-center py-12 text-gray-500",children:"查無資料"}):R(s).visible&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-6 p-4 bg-gray-50 rounded-xl",children:[(0,t.jsx)("input",{type:"search",placeholder:"搜尋列（含 signal / datetime / price）",className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 flex-1 max-w-79",value:R(s).search,onChange:e=>I(s,{search:e.target.value,page:1})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"每頁"}),(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("select",{value:R(s).pageSize,className:"px-3 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white backdrop-blur-sm transition-all duration-300 appearance-none cursor-pointer hover:border-blue-400",onChange:e=>I(s,{pageSize:Number(e.target.value),page:1}),children:[10,20,50,100].map(e=>(0,t.jsx)("option",{value:e,className:"py-2",children:e},e))}),(0,t.jsx)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,t.jsx)("svg",{className:"w-3 h-3 text-gray-400 transition-all duration-300 group-hover:text-blue-500 group-focus-within:text-blue-500 group-focus-within:rotate-180",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]})]}),(0,t.jsx)("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden",children:(C=(k=(S=R(s)).search.trim().toLowerCase())?a.filter(e=>Object.values(e).some(e=>String(e??"").toLowerCase().includes(k))):a,$=Math.max(1,Math.ceil((O=E?[...C].sort((e,t)=>{let s=e[E],a=t[E],r=Number(s),l=Number(a);if(!isNaN(r)&&!isNaN(l))return"asc"===L?r-l:l-r;let i=String(s??"").toLowerCase(),n=String(a??"").toLowerCase();return i<n?"asc"===L?-1:1:i>n?"asc"===L?1:-1:0}):C).length/S.pageSize)),z=Math.min((D=((M=Math.min(Math.max(1,S.page),$))-1)*S.pageSize)+S.pageSize,O.length),B=O.slice(D,z),P=Object.keys(a[0]||{}),U=[...(W=["datetime","date","signal","strength","price","close"]).filter(e=>P.includes(e)),...P.filter(e=>!W.includes(e))],(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsx)("tr",{className:"bg-gray-50 border-b border-gray-200",children:U.map(e=>(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>{E===e?A("asc"===L?"desc":"asc"):(T(e),A("desc"))},children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:e}),E===e&&(0,t.jsx)("span",{className:"text-blue-500",children:"asc"===L?"↑":"↓"})]})},e))})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-200",children:B.map((e,s)=>(0,t.jsx)("tr",{className:"hover:bg-gray-50 transition-colors",children:U.map(s=>{let a=e[s];if("datetime"===s||"date"===s)return(0,t.jsx)("td",{className:"px-4 py-3 text-gray-700 font-medium",children:f(a)},s);if("signal"===s||"Trade_Signal"===s){let e=y(String(a||""));return(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${e.cls}`,children:e.text})},s)}return"price"===s||"close"===s||"close_price"===s?(0,t.jsx)("td",{className:"px-4 py-3 font-semibold text-gray-900",children:a?`NT$ ${j(a)}`:"-"},s):(0,t.jsx)("td",{className:"px-4 py-3 text-gray-700",children:(e=>{let s=null==e?"":String(e);if(!k)return s||"-";let a=s.toLowerCase().indexOf(k);return -1===a?s||"-":(0,t.jsxs)(t.Fragment,{children:[s.substring(0,a),(0,t.jsx)("mark",{className:"bg-yellow-200 px-1 rounded",children:s.substring(a,a+k.length)}),s.substring(a+k.length)]})})(a)},s)})},s))})]})}),O.length>S.pageSize&&(0,t.jsx)("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["顯示 ",D+1," - ",z," /"," ",O.length," 筆結果"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{type:"button",className:"px-4 py-2 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",disabled:1===M,onClick:()=>I(s,{page:M-1}),children:"上一頁"}),(0,t.jsxs)("span",{className:"px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-300 rounded-lg",children:["第 ",M," / ",$," 頁"]}),(0,t.jsx)("button",{type:"button",className:"px-4 py-2 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",disabled:M===$,onClick:()=>I(s,{page:M+1}),children:"下一頁"})]})]})})]}))})]})]})]},s)})]})})]}),(0,t.jsx)(a.default,{})]})}],76217)},77887,(e,t,s)=>{let a="/market-analysis/trade-signals";(window.__NEXT_P=window.__NEXT_P||[]).push([a,()=>e.r(76217)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([a])})}]);